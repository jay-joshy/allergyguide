"use strict";(()=>{var un=Object.create;var ht=Object.defineProperty,fn=Object.defineProperties,cn=Object.getOwnPropertyDescriptor,mn=Object.getOwnPropertyDescriptors,gn=Object.getOwnPropertyNames,Mt=Object.getOwnPropertySymbols,pn=Object.getPrototypeOf,_t=Object.prototype.hasOwnProperty,hn=Object.prototype.propertyIsEnumerable;var Dt=(e,t,n)=>t in e?ht(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,vt=(e,t)=>{for(var n in t||(t={}))_t.call(t,n)&&Dt(e,n,t[n]);if(Mt)for(var n of Mt(t))hn.call(t,n)&&Dt(e,n,t[n]);return e},yt=(e,t)=>fn(e,mn(t));var vn=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var yn=(e,t,n,i)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of gn(t))!_t.call(e,o)&&o!==n&&ht(e,o,{get:()=>t[o],enumerable:!(i=cn(t,o))||i.enumerable});return e};var wn=(e,t,n)=>(n=e!=null?un(pn(e)):{},yn(t||!e||!e.__esModule?ht(n,"default",{value:e,enumerable:!0}):n,e));var Yt=vn((zt,at)=>{((e,t)=>{typeof define=="function"&&define.amd?define([],t):typeof at=="object"&&at.exports?at.exports=t():e.fuzzysort=t()})(zt,e=>{"use strict";var t=(h,g)=>{if(!h||!g)return K;var v=y(h);Z(g)||(g=m(g));var A=v.bitflags;return(A&g._bitflags)!==A?K:T(v,g)},n=(h,g,v)=>{if(!h)return v!=null&&v.all?F(g,v):gt;var A=y(h),S=A.bitflags,I=A.containsSpace,w=f((v==null?void 0:v.threshold)||0),x=(v==null?void 0:v.limit)||$,L=0,B=0,U=g.length;function de(Ce){L<x?(je.add(Ce),++L):(++B,Ce._score>je.peek()._score&&je.replaceTop(Ce))}if(v!=null&&v.key)for(var ne=v.key,O=0;O<U;++O){var se=g[O],H=De(se,ne);if(H&&(Z(H)||(H=m(H)),(S&H._bitflags)===S)){var q=T(A,H);q!==K&&(q._score<w||(q.obj=se,de(q)))}}else if(v!=null&&v.keys){var _e=v.keys,he=_e.length;e:for(var O=0;O<U;++O){var se=g[O];{for(var oe=0,P=0;P<he;++P){var ne=_e[P],H=De(se,ne);if(!H){Me[P]=Ze;continue}Z(H)||(H=m(H)),Me[P]=H,oe|=H._bitflags}if((S&oe)!==S)continue}if(I)for(let R=0;R<A.spaceSearches.length;R++)me[R]=ge;for(var P=0;P<he;++P){if(H=Me[P],H===Ze){ye[P]=Ze;continue}if(ye[P]=T(A,H,!1,I),ye[P]===K){ye[P]=Ze;continue}if(I)for(let W=0;W<A.spaceSearches.length;W++){if(Q[W]>-1e3&&me[W]>ge){var ee=(me[W]+Q[W])/4;ee>me[W]&&(me[W]=ee)}Q[W]>me[W]&&(me[W]=Q[W])}}if(I){for(let R=0;R<A.spaceSearches.length;R++)if(me[R]===ge)continue e}else{var _=!1;for(let R=0;R<he;R++)if(ye[R]._score!==ge){_=!0;break}if(!_)continue}var pe=new a(he);for(let R=0;R<he;R++)pe[R]=ye[R];if(I){var G=0;for(let R=0;R<A.spaceSearches.length;R++)G+=me[R]}else{var G=ge;for(let W=0;W<he;W++){var q=pe[W];if(q._score>-1e3&&G>ge){var ee=(G+q._score)/4;ee>G&&(G=ee)}q._score>G&&(G=q._score)}}if(pe.obj=se,pe._score=G,v!=null&&v.scoreFn){if(G=v.scoreFn(pe),!G)continue;G=f(G),pe._score=G}G<w||de(pe)}}else for(var O=0;O<U;++O){var H=g[O];if(H&&(Z(H)||(H=m(H)),(S&H._bitflags)===S)){var q=T(A,H);q!==K&&(q._score<w||de(q))}}if(L===0)return gt;for(var Be=new Array(L),O=L-1;O>=0;--O)Be[O]=je.poll();return Be.total=L+B,Be},i=(h,g="<b>",v="</b>")=>{for(var A=typeof g=="function"?g:void 0,S=h.target,I=S.length,w=h.indexes,x="",L=0,B=0,U=!1,de=[],ne=0;ne<I;++ne){var O=S[ne];if(w[B]===ne){if(++B,U||(U=!0,A?(de.push(x),x=""):x+=g),B===w.length){A?(x+=O,de.push(A(x,L++)),x="",de.push(S.substr(ne+1))):x+=O+v+S.substr(ne+1);break}}else U&&(U=!1,A?(de.push(A(x,L++)),x=""):x+=v);x+=O}return A?de:x},o=h=>{typeof h=="number"?h=""+h:typeof h!="string"&&(h="");var g=Y(h);return l(h,{_targetLower:g._lower,_targetLowerCodes:g.lowerCodes,_bitflags:g.bitflags})},r=()=>{Fe.clear(),fe.clear()};class s{get indexes(){return this._indexes.slice(0,this._indexes.len).sort((g,v)=>g-v)}set indexes(g){return this._indexes=g}highlight(g,v){return i(this,g,v)}get score(){return d(this._score)}set score(g){this._score=f(g)}}class a extends Array{get score(){return d(this._score)}set score(g){this._score=f(g)}}var l=(h,g)=>{var A,S,I,w,x,L,B;let v=new s;return v.target=h,v.obj=(A=g.obj)!=null?A:K,v._score=(S=g._score)!=null?S:ge,v._indexes=(I=g._indexes)!=null?I:[],v._targetLower=(w=g._targetLower)!=null?w:"",v._targetLowerCodes=(x=g._targetLowerCodes)!=null?x:K,v._nextBeginningIndexes=(L=g._nextBeginningIndexes)!=null?L:K,v._bitflags=(B=g._bitflags)!=null?B:0,v},d=h=>h===ge?0:h>1?h:Math.E**(((-h+1)**.04307-1)*-2),f=h=>h===0?ge:h>1?h:1-Math.pow(Math.log(h)/-2+1,1/.04307),u=h=>{typeof h=="number"?h=""+h:typeof h!="string"&&(h=""),h=h.trim();var g=Y(h),v=[];if(g.containsSpace){var A=h.split(/\s+/);A=[...new Set(A)];for(var S=0;S<A.length;S++)if(A[S]!==""){var I=Y(A[S]);v.push({lowerCodes:I.lowerCodes,_lower:A[S].toLowerCase(),containsSpace:!1})}}return{lowerCodes:g.lowerCodes,_lower:g._lower,containsSpace:g.containsSpace,bitflags:g.bitflags,spaceSearches:v}},m=h=>{if(h.length>999)return o(h);var g=Fe.get(h);return g!==void 0||(g=o(h),Fe.set(h,g)),g},y=h=>{if(h.length>999)return u(h);var g=fe.get(h);return g!==void 0||(g=u(h),fe.set(h,g)),g},F=(h,g)=>{var v=[];v.total=h.length;var A=(g==null?void 0:g.limit)||$;if(g!=null&&g.key)for(var S=0;S<h.length;S++){var I=h[S],w=De(I,g.key);if(w!=K){Z(w)||(w=m(w));var x=l(w.target,{_score:w._score,obj:I});if(v.push(x),v.length>=A)return v}}else if(g!=null&&g.keys)for(var S=0;S<h.length;S++){for(var I=h[S],L=new a(g.keys.length),B=g.keys.length-1;B>=0;--B){var w=De(I,g.keys[B]);if(!w){L[B]=Ze;continue}Z(w)||(w=m(w)),w._score=ge,w._indexes.len=0,L[B]=w}if(L.obj=I,L._score=ge,v.push(L),v.length>=A)return v}else for(var S=0;S<h.length;S++){var w=h[S];if(w!=K&&(Z(w)||(w=m(w)),w._score=ge,w._indexes.len=0,v.push(w),v.length>=A))return v}return v},T=(h,g,v=!1,A=!1)=>{if(v===!1&&h.containsSpace)return z(h,g,A);for(var S=h._lower,I=h.lowerCodes,w=I[0],x=g._targetLowerCodes,L=I.length,B=x.length,O=0,U=0,de=0;;){var ne=w===x[U];if(ne){if(ce[de++]=U,++O,O===L)break;w=I[O]}if(++U,U>=B)return K}var O=0,se=!1,H=0,q=g._nextBeginningIndexes;q===K&&(q=g._nextBeginningIndexes=j(g.target)),U=ce[0]===0?0:q[ce[0]-1];var _e=0;if(U!==B)for(;;)if(U>=B){if(O<=0||(++_e,_e>200))break;--O;var he=be[--H];U=q[he]}else{var ne=I[O]===x[U];if(ne){if(be[H++]=U,++O,O===L){se=!0;break}++U}else U=q[U]}var oe=L<=1?-1:g._targetLower.indexOf(S,ce[0]),P=!!~oe,ee=P?oe===0||g._nextBeginningIndexes[oe-1]===oe:!1;if(P&&!ee){for(var _=0;_<q.length;_=q[_])if(!(_<=oe)){for(var pe=0;pe<L&&I[pe]===g._targetLowerCodes[_+pe];pe++);if(pe===L){oe=_,ee=!0;break}}}var G=R=>{for(var W=0,Ft=0,Ee=1;Ee<L;++Ee)R[Ee]-R[Ee-1]!==1&&(W-=R[Ee],++Ft);var ln=R[L-1]-R[0]-(L-1);if(W-=(12+ln)*Ft,R[0]!==0&&(W-=R[0]*R[0]*.2),!se)W*=1e3;else{for(var pt=1,Ee=q[0];Ee<B;Ee=q[Ee])++pt;pt>24&&(W*=(pt-24)*10)}return W-=(B-L)/2,P&&(W/=1+L*L*1),ee&&(W/=1+L*L*1),W-=(B-L)/2,W};if(se)if(ee){for(var _=0;_<L;++_)ce[_]=oe+_;var Be=ce,Ce=G(ce)}else var Be=be,Ce=G(be);else{if(P)for(var _=0;_<L;++_)ce[_]=oe+_;var Be=ce,Ce=G(Be)}g._score=Ce;for(var _=0;_<L;++_)g._indexes[_]=Be[_];g._indexes.len=L;let Ke=new s;return Ke.target=g.target,Ke._score=g._score,Ke._indexes=g._indexes,Ke},z=(h,g,v)=>{for(var A=new Set,S=0,I=K,w=0,x=h.spaceSearches,L=x.length,B=0,U=()=>{for(let ee=B-1;ee>=0;ee--)g._nextBeginningIndexes[Te[ee*2+0]]=Te[ee*2+1]},de=!1,P=0;P<L;++P){Q[P]=ge;var ne=x[P];if(I=T(ne,g),v){if(I===K)continue;de=!0}else if(I===K)return U(),K;var O=P===L-1;if(!O){var se=I._indexes,H=!0;for(let _=0;_<se.len-1;_++)if(se[_+1]-se[_]!==1){H=!1;break}if(H){var q=se[se.len-1]+1,_e=g._nextBeginningIndexes[q-1];for(let _=q-1;_>=0&&_e===g._nextBeginningIndexes[_];_--)g._nextBeginningIndexes[_]=q,Te[B*2+0]=_,Te[B*2+1]=_e,B++}}S+=I._score/L,Q[P]=I._score/L,I._indexes[0]<w&&(S-=(w-I._indexes[0])*2),w=I._indexes[0];for(var he=0;he<I._indexes.len;++he)A.add(I._indexes[he])}if(v&&!de)return K;U();var oe=T(h,g,!0);if(oe!==K&&oe._score>S){if(v)for(var P=0;P<L;++P)Q[P]=oe._score/L;return oe}v&&(I=g),I._score=S;var P=0;for(let ee of A)I._indexes[P++]=ee;return I._indexes.len=P,I},k=h=>h.replace(new RegExp("\\p{Script=Latin}+","gu"),g=>g.normalize("NFD")).replace(/[\u0300-\u036f]/g,""),Y=h=>{h=k(h);for(var g=h.length,v=h.toLowerCase(),A=[],S=0,I=!1,w=0;w<g;++w){var x=A[w]=v.charCodeAt(w);if(x===32){I=!0;continue}var L=x>=97&&x<=122?x-97:x>=48&&x<=57?26:x<=127?30:31;S|=1<<L}return{lowerCodes:A,bitflags:S,containsSpace:I,_lower:v}},N=h=>{for(var g=h.length,v=[],A=0,S=!1,I=!1,w=0;w<g;++w){var x=h.charCodeAt(w),L=x>=65&&x<=90,B=L||x>=97&&x<=122||x>=48&&x<=57,U=L&&!S||!I||!B;S=L,I=B,U&&(v[A++]=w)}return v},j=h=>{h=k(h);for(var g=h.length,v=N(h),A=[],S=v[0],I=0,w=0;w<g;++w)S>w?A[w]=S:(S=v[++I],A[w]=S===void 0?g:S);return A},Fe=new Map,fe=new Map,ce=[],be=[],Te=[],me=[],Q=[],Me=[],ye=[],De=(h,g)=>{var v=h[g];if(v!==void 0)return v;if(typeof g=="function")return g(h);var A=g;Array.isArray(g)||(A=g.split("."));for(var S=A.length,I=-1;h&&++I<S;)h=h[A[I]];return h},Z=h=>typeof h=="object"&&typeof h._bitflags=="number",$=1/0,ge=-$,gt=[];gt.total=0;var K=null,Ze=o(""),dn=h=>{var g=[],v=0,A={},S=I=>{for(var w=0,x=g[w],L=1;L<v;){var B=L+1;w=L,B<v&&g[B]._score<g[L]._score&&(w=B),g[w-1>>1]=g[w],L=1+(w<<1)}for(var U=w-1>>1;w>0&&x._score<g[U]._score;U=(w=U)-1>>1)g[w]=g[U];g[w]=x};return A.add=(I=>{var w=v;g[v++]=I;for(var x=w-1>>1;w>0&&I._score<g[x]._score;x=(w=x)-1>>1)g[w]=g[x];g[w]=I}),A.poll=(I=>{if(v!==0){var w=g[0];return g[0]=g[--v],S(),w}}),A.peek=(I=>{if(v!==0)return g[0]}),A.replaceTop=(I=>{g[0]=I,S()}),A},je=dn();return{single:t,go:n,prepare:o,cleanup:r}})});var He=9e15,Oe=1e9,wt="0123456789abcdef",tt="2.3025850929940456840179914546843642076011014886287729760333279009675726096773524802359972050895982983419677840422862486334095254650828067566662873690987816894829072083255546808437998948262331985283935053089653777326288461633662222876982198867465436674744042432743651550489343149393914796194044002221051017141748003688084012647080685567743216228355220114804663715659121373450747856947683463616792101806445070648000277502684916746550586856935673420670581136429224554405758925724208241314695689016758940256776311356919292033376587141660230105703089634572075440370847469940168269282808481184289314848524948644871927809676271275775397027668605952496716674183485704422507197965004714951050492214776567636938662976979522110718264549734772662425709429322582798502585509785265383207606726317164309505995087807523710333101197857547331541421808427543863591778117054309827482385045648019095610299291824318237525357709750539565187697510374970888692180205189339507238539205144634197265287286965110862571492198849978748873771345686209167058",nt="3.1415926535897932384626433832795028841971693993751058209749445923078164062862089986280348253421170679821480865132823066470938446095505822317253594081284811174502841027019385211055596446229489549303819644288109756659334461284756482337867831652712019091456485669234603486104543266482133936072602491412737245870066063155881748815209209628292540917153643678925903600113305305488204665213841469519415116094330572703657595919530921861173819326117931051185480744623799627495673518857527248912279381830119491298336733624406566430860213949463952247371907021798609437027705392171762931767523846748184676694051320005681271452635608277857713427577896091736371787214684409012249534301465495853710507922796892589235420199561121290219608640344181598136297747713099605187072113499999983729780499510597317328160963185950244594553469083026425223082533446850352619311881710100031378387528865875332083814206171776691473035982534904287554687311595628638823537875937519577818577805321712268066130019278766111959092164201989380952572010654858632789",Tt={precision:20,rounding:4,modulo:1,toExpNeg:-7,toExpPos:21,minE:-He,maxE:He,crypto:!1},Pt,xe,M=!0,it="[DecimalError] ",Pe=it+"Invalid argument: ",Ot=it+"Precision limit exceeded",$t=it+"crypto unavailable",Ct="[object Decimal]",ie=Math.floor,X=Math.pow,Tn=/^0b([01]+(\.[01]*)?|\.[01]+)(p[+-]?\d+)?$/i,In=/^0x([0-9a-f]+(\.[0-9a-f]*)?|\.[0-9a-f]+)(p[+-]?\d+)?$/i,An=/^0o([0-7]+(\.[0-7]*)?|\.[0-7]+)(p[+-]?\d+)?$/i,kt=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,we=1e7,E=7,Sn=9007199254740991,Ln=tt.length-1,It=nt.length-1,p={toStringTag:Ct};p.absoluteValue=p.abs=function(){var e=new this.constructor(this);return e.s<0&&(e.s=1),b(e)};p.ceil=function(){return b(new this.constructor(this),this.e+1,2)};p.clampedTo=p.clamp=function(e,t){var n,i=this,o=i.constructor;if(e=new o(e),t=new o(t),!e.s||!t.s)return new o(NaN);if(e.gt(t))throw Error(Pe+t);return n=i.cmp(e),n<0?e:i.cmp(t)>0?t:new o(i)};p.comparedTo=p.cmp=function(e){var t,n,i,o,r=this,s=r.d,a=(e=new r.constructor(e)).d,l=r.s,d=e.s;if(!s||!a)return!l||!d?NaN:l!==d?l:s===a?0:!s^l<0?1:-1;if(!s[0]||!a[0])return s[0]?l:a[0]?-d:0;if(l!==d)return l;if(r.e!==e.e)return r.e>e.e^l<0?1:-1;for(i=s.length,o=a.length,t=0,n=i<o?i:o;t<n;++t)if(s[t]!==a[t])return s[t]>a[t]^l<0?1:-1;return i===o?0:i>o^l<0?1:-1};p.cosine=p.cos=function(){var e,t,n=this,i=n.constructor;return n.d?n.d[0]?(e=i.precision,t=i.rounding,i.precision=e+Math.max(n.e,n.sd())+E,i.rounding=1,n=bn(i,Vt(i,n)),i.precision=e,i.rounding=t,b(xe==2||xe==3?n.neg():n,e,t,!0)):new i(1):new i(NaN)};p.cubeRoot=p.cbrt=function(){var e,t,n,i,o,r,s,a,l,d,f=this,u=f.constructor;if(!f.isFinite()||f.isZero())return new u(f);for(M=!1,r=f.s*X(f.s*f,1/3),!r||Math.abs(r)==1/0?(n=te(f.d),e=f.e,(r=(e-n.length+1)%3)&&(n+=r==1||r==-2?"0":"00"),r=X(n,1/3),e=ie((e+1)/3)-(e%3==(e<0?-1:2)),r==1/0?n="5e"+e:(n=r.toExponential(),n=n.slice(0,n.indexOf("e")+1)+e),i=new u(n),i.s=f.s):i=new u(r.toString()),s=(e=u.precision)+3;;)if(a=i,l=a.times(a).times(a),d=l.plus(f),i=V(d.plus(f).times(a),d.plus(l),s+2,1),te(a.d).slice(0,s)===(n=te(i.d)).slice(0,s))if(n=n.slice(s-3,s+1),n=="9999"||!o&&n=="4999"){if(!o&&(b(a,e+1,0),a.times(a).times(a).eq(f))){i=a;break}s+=4,o=1}else{(!+n||!+n.slice(1)&&n.charAt(0)=="5")&&(b(i,e+1,1),t=!i.times(i).times(i).eq(f));break}return M=!0,b(i,e,u.rounding,t)};p.decimalPlaces=p.dp=function(){var e,t=this.d,n=NaN;if(t){if(e=t.length-1,n=(e-ie(this.e/E))*E,e=t[e],e)for(;e%10==0;e/=10)n--;n<0&&(n=0)}return n};p.dividedBy=p.div=function(e){return V(this,new this.constructor(e))};p.dividedToIntegerBy=p.divToInt=function(e){var t=this,n=t.constructor;return b(V(t,new n(e),0,1,1),n.precision,n.rounding)};p.equals=p.eq=function(e){return this.cmp(e)===0};p.floor=function(){return b(new this.constructor(this),this.e+1,3)};p.greaterThan=p.gt=function(e){return this.cmp(e)>0};p.greaterThanOrEqualTo=p.gte=function(e){var t=this.cmp(e);return t==1||t===0};p.hyperbolicCosine=p.cosh=function(){var e,t,n,i,o,r=this,s=r.constructor,a=new s(1);if(!r.isFinite())return new s(r.s?1/0:NaN);if(r.isZero())return a;n=s.precision,i=s.rounding,s.precision=n+Math.max(r.e,r.sd())+4,s.rounding=1,o=r.d.length,o<32?(e=Math.ceil(o/3),t=(1/st(4,e)).toString()):(e=16,t="2.3283064365386962890625e-10"),r=Re(s,1,r.times(t),new s(1),!0);for(var l,d=e,f=new s(8);d--;)l=r.times(r),r=a.minus(l.times(f.minus(l.times(f))));return b(r,s.precision=n,s.rounding=i,!0)};p.hyperbolicSine=p.sinh=function(){var e,t,n,i,o=this,r=o.constructor;if(!o.isFinite()||o.isZero())return new r(o);if(t=r.precision,n=r.rounding,r.precision=t+Math.max(o.e,o.sd())+4,r.rounding=1,i=o.d.length,i<3)o=Re(r,2,o,o,!0);else{e=1.4*Math.sqrt(i),e=e>16?16:e|0,o=o.times(1/st(5,e)),o=Re(r,2,o,o,!0);for(var s,a=new r(5),l=new r(16),d=new r(20);e--;)s=o.times(o),o=o.times(a.plus(s.times(l.times(s).plus(d))))}return r.precision=t,r.rounding=n,b(o,t,n,!0)};p.hyperbolicTangent=p.tanh=function(){var e,t,n=this,i=n.constructor;return n.isFinite()?n.isZero()?new i(n):(e=i.precision,t=i.rounding,i.precision=e+7,i.rounding=1,V(n.sinh(),n.cosh(),i.precision=e,i.rounding=t)):new i(n.s)};p.inverseCosine=p.acos=function(){var e=this,t=e.constructor,n=e.abs().cmp(1),i=t.precision,o=t.rounding;return n!==-1?n===0?e.isNeg()?Ie(t,i,o):new t(0):new t(NaN):e.isZero()?Ie(t,i+4,o).times(.5):(t.precision=i+6,t.rounding=1,e=new t(1).minus(e).div(e.plus(1)).sqrt().atan(),t.precision=i,t.rounding=o,e.times(2))};p.inverseHyperbolicCosine=p.acosh=function(){var e,t,n=this,i=n.constructor;return n.lte(1)?new i(n.eq(1)?0:NaN):n.isFinite()?(e=i.precision,t=i.rounding,i.precision=e+Math.max(Math.abs(n.e),n.sd())+4,i.rounding=1,M=!1,n=n.times(n).minus(1).sqrt().plus(n),M=!0,i.precision=e,i.rounding=t,n.ln()):new i(n)};p.inverseHyperbolicSine=p.asinh=function(){var e,t,n=this,i=n.constructor;return!n.isFinite()||n.isZero()?new i(n):(e=i.precision,t=i.rounding,i.precision=e+2*Math.max(Math.abs(n.e),n.sd())+6,i.rounding=1,M=!1,n=n.times(n).plus(1).sqrt().plus(n),M=!0,i.precision=e,i.rounding=t,n.ln())};p.inverseHyperbolicTangent=p.atanh=function(){var e,t,n,i,o=this,r=o.constructor;return o.isFinite()?o.e>=0?new r(o.abs().eq(1)?o.s/0:o.isZero()?o:NaN):(e=r.precision,t=r.rounding,i=o.sd(),Math.max(i,e)<2*-o.e-1?b(new r(o),e,t,!0):(r.precision=n=i-o.e,o=V(o.plus(1),new r(1).minus(o),n+e,1),r.precision=e+4,r.rounding=1,o=o.ln(),r.precision=e,r.rounding=t,o.times(.5))):new r(NaN)};p.inverseSine=p.asin=function(){var e,t,n,i,o=this,r=o.constructor;return o.isZero()?new r(o):(t=o.abs().cmp(1),n=r.precision,i=r.rounding,t!==-1?t===0?(e=Ie(r,n+4,i).times(.5),e.s=o.s,e):new r(NaN):(r.precision=n+6,r.rounding=1,o=o.div(new r(1).minus(o.times(o)).sqrt().plus(1)).atan(),r.precision=n,r.rounding=i,o.times(2)))};p.inverseTangent=p.atan=function(){var e,t,n,i,o,r,s,a,l,d=this,f=d.constructor,u=f.precision,m=f.rounding;if(d.isFinite()){if(d.isZero())return new f(d);if(d.abs().eq(1)&&u+4<=It)return s=Ie(f,u+4,m).times(.25),s.s=d.s,s}else{if(!d.s)return new f(NaN);if(u+4<=It)return s=Ie(f,u+4,m).times(.5),s.s=d.s,s}for(f.precision=a=u+10,f.rounding=1,n=Math.min(28,a/E+2|0),e=n;e;--e)d=d.div(d.times(d).plus(1).sqrt().plus(1));for(M=!1,t=Math.ceil(a/E),i=1,l=d.times(d),s=new f(d),o=d;e!==-1;)if(o=o.times(l),r=s.minus(o.div(i+=2)),o=o.times(l),s=r.plus(o.div(i+=2)),s.d[t]!==void 0)for(e=t;s.d[e]===r.d[e]&&e--;);return n&&(s=s.times(2<<n-1)),M=!0,b(s,f.precision=u,f.rounding=m,!0)};p.isFinite=function(){return!!this.d};p.isInteger=p.isInt=function(){return!!this.d&&ie(this.e/E)>this.d.length-2};p.isNaN=function(){return!this.s};p.isNegative=p.isNeg=function(){return this.s<0};p.isPositive=p.isPos=function(){return this.s>0};p.isZero=function(){return!!this.d&&this.d[0]===0};p.lessThan=p.lt=function(e){return this.cmp(e)<0};p.lessThanOrEqualTo=p.lte=function(e){return this.cmp(e)<1};p.logarithm=p.log=function(e){var t,n,i,o,r,s,a,l,d=this,f=d.constructor,u=f.precision,m=f.rounding,y=5;if(e==null)e=new f(10),t=!0;else{if(e=new f(e),n=e.d,e.s<0||!n||!n[0]||e.eq(1))return new f(NaN);t=e.eq(10)}if(n=d.d,d.s<0||!n||!n[0]||d.eq(1))return new f(n&&!n[0]?-1/0:d.s!=1?NaN:n?0:1/0);if(t)if(n.length>1)r=!0;else{for(o=n[0];o%10===0;)o/=10;r=o!==1}if(M=!1,a=u+y,s=Ue(d,a),i=t?ot(f,a+10):Ue(e,a),l=V(s,i,a,1),ze(l.d,o=u,m))do if(a+=10,s=Ue(d,a),i=t?ot(f,a+10):Ue(e,a),l=V(s,i,a,1),!r){+te(l.d).slice(o+1,o+15)+1==1e14&&(l=b(l,u+1,0));break}while(ze(l.d,o+=10,m));return M=!0,b(l,u,m)};p.minus=p.sub=function(e){var t,n,i,o,r,s,a,l,d,f,u,m,y=this,F=y.constructor;if(e=new F(e),!y.d||!e.d)return!y.s||!e.s?e=new F(NaN):y.d?e.s=-e.s:e=new F(e.d||y.s!==e.s?y:NaN),e;if(y.s!=e.s)return e.s=-e.s,y.plus(e);if(d=y.d,m=e.d,a=F.precision,l=F.rounding,!d[0]||!m[0]){if(m[0])e.s=-e.s;else if(d[0])e=new F(y);else return new F(l===3?-0:0);return M?b(e,a,l):e}if(n=ie(e.e/E),f=ie(y.e/E),d=d.slice(),r=f-n,r){for(u=r<0,u?(t=d,r=-r,s=m.length):(t=m,n=f,s=d.length),i=Math.max(Math.ceil(a/E),s)+2,r>i&&(r=i,t.length=1),t.reverse(),i=r;i--;)t.push(0);t.reverse()}else{for(i=d.length,s=m.length,u=i<s,u&&(s=i),i=0;i<s;i++)if(d[i]!=m[i]){u=d[i]<m[i];break}r=0}for(u&&(t=d,d=m,m=t,e.s=-e.s),s=d.length,i=m.length-s;i>0;--i)d[s++]=0;for(i=m.length;i>r;){if(d[--i]<m[i]){for(o=i;o&&d[--o]===0;)d[o]=we-1;--d[o],d[i]+=we}d[i]-=m[i]}for(;d[--s]===0;)d.pop();for(;d[0]===0;d.shift())--n;return d[0]?(e.d=d,e.e=rt(d,n),M?b(e,a,l):e):new F(l===3?-0:0)};p.modulo=p.mod=function(e){var t,n=this,i=n.constructor;return e=new i(e),!n.d||!e.s||e.d&&!e.d[0]?new i(NaN):!e.d||n.d&&!n.d[0]?b(new i(n),i.precision,i.rounding):(M=!1,i.modulo==9?(t=V(n,e.abs(),0,3,1),t.s*=e.s):t=V(n,e,0,i.modulo,1),t=t.times(e),M=!0,n.minus(t))};p.naturalExponential=p.exp=function(){return At(this)};p.naturalLogarithm=p.ln=function(){return Ue(this)};p.negated=p.neg=function(){var e=new this.constructor(this);return e.s=-e.s,b(e)};p.plus=p.add=function(e){var t,n,i,o,r,s,a,l,d,f,u=this,m=u.constructor;if(e=new m(e),!u.d||!e.d)return!u.s||!e.s?e=new m(NaN):u.d||(e=new m(e.d||u.s===e.s?u:NaN)),e;if(u.s!=e.s)return e.s=-e.s,u.minus(e);if(d=u.d,f=e.d,a=m.precision,l=m.rounding,!d[0]||!f[0])return f[0]||(e=new m(u)),M?b(e,a,l):e;if(r=ie(u.e/E),i=ie(e.e/E),d=d.slice(),o=r-i,o){for(o<0?(n=d,o=-o,s=f.length):(n=f,i=r,s=d.length),r=Math.ceil(a/E),s=r>s?r+1:s+1,o>s&&(o=s,n.length=1),n.reverse();o--;)n.push(0);n.reverse()}for(s=d.length,o=f.length,s-o<0&&(o=s,n=f,f=d,d=n),t=0;o;)t=(d[--o]=d[o]+f[o]+t)/we|0,d[o]%=we;for(t&&(d.unshift(t),++i),s=d.length;d[--s]==0;)d.pop();return e.d=d,e.e=rt(d,i),M?b(e,a,l):e};p.precision=p.sd=function(e){var t,n=this;if(e!==void 0&&e!==!!e&&e!==1&&e!==0)throw Error(Pe+e);return n.d?(t=Ht(n.d),e&&n.e+1>t&&(t=n.e+1)):t=NaN,t};p.round=function(){var e=this,t=e.constructor;return b(new t(e),e.e+1,t.rounding)};p.sine=p.sin=function(){var e,t,n=this,i=n.constructor;return n.isFinite()?n.isZero()?new i(n):(e=i.precision,t=i.rounding,i.precision=e+Math.max(n.e,n.sd())+E,i.rounding=1,n=xn(i,Vt(i,n)),i.precision=e,i.rounding=t,b(xe>2?n.neg():n,e,t,!0)):new i(NaN)};p.squareRoot=p.sqrt=function(){var e,t,n,i,o,r,s=this,a=s.d,l=s.e,d=s.s,f=s.constructor;if(d!==1||!a||!a[0])return new f(!d||d<0&&(!a||a[0])?NaN:a?s:1/0);for(M=!1,d=Math.sqrt(+s),d==0||d==1/0?(t=te(a),(t.length+l)%2==0&&(t+="0"),d=Math.sqrt(t),l=ie((l+1)/2)-(l<0||l%2),d==1/0?t="5e"+l:(t=d.toExponential(),t=t.slice(0,t.indexOf("e")+1)+l),i=new f(t)):i=new f(d.toString()),n=(l=f.precision)+3;;)if(r=i,i=r.plus(V(s,r,n+2,1)).times(.5),te(r.d).slice(0,n)===(t=te(i.d)).slice(0,n))if(t=t.slice(n-3,n+1),t=="9999"||!o&&t=="4999"){if(!o&&(b(r,l+1,0),r.times(r).eq(s))){i=r;break}n+=4,o=1}else{(!+t||!+t.slice(1)&&t.charAt(0)=="5")&&(b(i,l+1,1),e=!i.times(i).eq(s));break}return M=!0,b(i,l,f.rounding,e)};p.tangent=p.tan=function(){var e,t,n=this,i=n.constructor;return n.isFinite()?n.isZero()?new i(n):(e=i.precision,t=i.rounding,i.precision=e+10,i.rounding=1,n=n.sin(),n.s=1,n=V(n,new i(1).minus(n.times(n)).sqrt(),e+10,0),i.precision=e,i.rounding=t,b(xe==2||xe==4?n.neg():n,e,t,!0)):new i(NaN)};p.times=p.mul=function(e){var t,n,i,o,r,s,a,l,d,f=this,u=f.constructor,m=f.d,y=(e=new u(e)).d;if(e.s*=f.s,!m||!m[0]||!y||!y[0])return new u(!e.s||m&&!m[0]&&!y||y&&!y[0]&&!m?NaN:!m||!y?e.s/0:e.s*0);for(n=ie(f.e/E)+ie(e.e/E),l=m.length,d=y.length,l<d&&(r=m,m=y,y=r,s=l,l=d,d=s),r=[],s=l+d,i=s;i--;)r.push(0);for(i=d;--i>=0;){for(t=0,o=l+i;o>i;)a=r[o]+y[i]*m[o-i-1]+t,r[o--]=a%we|0,t=a/we|0;r[o]=(r[o]+t)%we|0}for(;!r[--s];)r.pop();return t?++n:r.shift(),e.d=r,e.e=rt(r,n),M?b(e,u.precision,u.rounding):e};p.toBinary=function(e,t){return St(this,2,e,t)};p.toDecimalPlaces=p.toDP=function(e,t){var n=this,i=n.constructor;return n=new i(n),e===void 0?n:(le(e,0,Oe),t===void 0?t=i.rounding:le(t,0,8),b(n,e+n.e+1,t))};p.toExponential=function(e,t){var n,i=this,o=i.constructor;return e===void 0?n=Ae(i,!0):(le(e,0,Oe),t===void 0?t=o.rounding:le(t,0,8),i=b(new o(i),e+1,t),n=Ae(i,!0,e+1)),i.isNeg()&&!i.isZero()?"-"+n:n};p.toFixed=function(e,t){var n,i,o=this,r=o.constructor;return e===void 0?n=Ae(o):(le(e,0,Oe),t===void 0?t=r.rounding:le(t,0,8),i=b(new r(o),e+o.e+1,t),n=Ae(i,!1,e+i.e+1)),o.isNeg()&&!o.isZero()?"-"+n:n};p.toFraction=function(e){var t,n,i,o,r,s,a,l,d,f,u,m,y=this,F=y.d,T=y.constructor;if(!F)return new T(y);if(d=n=new T(1),i=l=new T(0),t=new T(i),r=t.e=Ht(F)-y.e-1,s=r%E,t.d[0]=X(10,s<0?E+s:s),e==null)e=r>0?t:d;else{if(a=new T(e),!a.isInt()||a.lt(d))throw Error(Pe+a);e=a.gt(t)?r>0?t:d:a}for(M=!1,a=new T(te(F)),f=T.precision,T.precision=r=F.length*E*2;u=V(a,t,0,1,1),o=n.plus(u.times(i)),o.cmp(e)!=1;)n=i,i=o,o=d,d=l.plus(u.times(o)),l=o,o=t,t=a.minus(u.times(o)),a=o;return o=V(e.minus(n),i,0,1,1),l=l.plus(o.times(d)),n=n.plus(o.times(i)),l.s=d.s=y.s,m=V(d,i,r,1).minus(y).abs().cmp(V(l,n,r,1).minus(y).abs())<1?[d,i]:[l,n],T.precision=f,M=!0,m};p.toHexadecimal=p.toHex=function(e,t){return St(this,16,e,t)};p.toNearest=function(e,t){var n=this,i=n.constructor;if(n=new i(n),e==null){if(!n.d)return n;e=new i(1),t=i.rounding}else{if(e=new i(e),t===void 0?t=i.rounding:le(t,0,8),!n.d)return e.s?n:e;if(!e.d)return e.s&&(e.s=n.s),e}return e.d[0]?(M=!1,n=V(n,e,0,t,1).times(e),M=!0,b(n)):(e.s=n.s,n=e),n};p.toNumber=function(){return+this};p.toOctal=function(e,t){return St(this,8,e,t)};p.toPower=p.pow=function(e){var t,n,i,o,r,s,a=this,l=a.constructor,d=+(e=new l(e));if(!a.d||!e.d||!a.d[0]||!e.d[0])return new l(X(+a,d));if(a=new l(a),a.eq(1))return a;if(i=l.precision,r=l.rounding,e.eq(1))return b(a,i,r);if(t=ie(e.e/E),t>=e.d.length-1&&(n=d<0?-d:d)<=Sn)return o=Rt(l,a,n,i),e.s<0?new l(1).div(o):b(o,i,r);if(s=a.s,s<0){if(t<e.d.length-1)return new l(NaN);if((e.d[t]&1)==0&&(s=1),a.e==0&&a.d[0]==1&&a.d.length==1)return a.s=s,a}return n=X(+a,d),t=n==0||!isFinite(n)?ie(d*(Math.log("0."+te(a.d))/Math.LN10+a.e+1)):new l(n+"").e,t>l.maxE+1||t<l.minE-1?new l(t>0?s/0:0):(M=!1,l.rounding=a.s=1,n=Math.min(12,(t+"").length),o=At(e.times(Ue(a,i+n)),i),o.d&&(o=b(o,i+5,1),ze(o.d,i,r)&&(t=i+10,o=b(At(e.times(Ue(a,t+n)),t),t+5,1),+te(o.d).slice(i+1,i+15)+1==1e14&&(o=b(o,i+1,0)))),o.s=s,M=!0,l.rounding=r,b(o,i,r))};p.toPrecision=function(e,t){var n,i=this,o=i.constructor;return e===void 0?n=Ae(i,i.e<=o.toExpNeg||i.e>=o.toExpPos):(le(e,1,Oe),t===void 0?t=o.rounding:le(t,0,8),i=b(new o(i),e,t),n=Ae(i,e<=i.e||i.e<=o.toExpNeg,e)),i.isNeg()&&!i.isZero()?"-"+n:n};p.toSignificantDigits=p.toSD=function(e,t){var n=this,i=n.constructor;return e===void 0?(e=i.precision,t=i.rounding):(le(e,1,Oe),t===void 0?t=i.rounding:le(t,0,8)),b(new i(n),e,t)};p.toString=function(){var e=this,t=e.constructor,n=Ae(e,e.e<=t.toExpNeg||e.e>=t.toExpPos);return e.isNeg()&&!e.isZero()?"-"+n:n};p.truncated=p.trunc=function(){return b(new this.constructor(this),this.e+1,1)};p.valueOf=p.toJSON=function(){var e=this,t=e.constructor,n=Ae(e,e.e<=t.toExpNeg||e.e>=t.toExpPos);return e.isNeg()?"-"+n:n};function te(e){var t,n,i,o=e.length-1,r="",s=e[0];if(o>0){for(r+=s,t=1;t<o;t++)i=e[t]+"",n=E-i.length,n&&(r+=Ne(n)),r+=i;s=e[t],i=s+"",n=E-i.length,n&&(r+=Ne(n))}else if(s===0)return"0";for(;s%10===0;)s/=10;return r+s}function le(e,t,n){if(e!==~~e||e<t||e>n)throw Error(Pe+e)}function ze(e,t,n,i){var o,r,s,a;for(r=e[0];r>=10;r/=10)--t;return--t<0?(t+=E,o=0):(o=Math.ceil((t+1)/E),t%=E),r=X(10,E-t),a=e[o]%r|0,i==null?t<3?(t==0?a=a/100|0:t==1&&(a=a/10|0),s=n<4&&a==99999||n>3&&a==49999||a==5e4||a==0):s=(n<4&&a+1==r||n>3&&a+1==r/2)&&(e[o+1]/r/100|0)==X(10,t-2)-1||(a==r/2||a==0)&&(e[o+1]/r/100|0)==0:t<4?(t==0?a=a/1e3|0:t==1?a=a/100|0:t==2&&(a=a/10|0),s=(i||n<4)&&a==9999||!i&&n>3&&a==4999):s=((i||n<4)&&a+1==r||!i&&n>3&&a+1==r/2)&&(e[o+1]/r/1e3|0)==X(10,t-3)-1,s}function Je(e,t,n){for(var i,o=[0],r,s=0,a=e.length;s<a;){for(r=o.length;r--;)o[r]*=t;for(o[0]+=wt.indexOf(e.charAt(s++)),i=0;i<o.length;i++)o[i]>n-1&&(o[i+1]===void 0&&(o[i+1]=0),o[i+1]+=o[i]/n|0,o[i]%=n)}return o.reverse()}function bn(e,t){var n,i,o;if(t.isZero())return t;i=t.d.length,i<32?(n=Math.ceil(i/3),o=(1/st(4,n)).toString()):(n=16,o="2.3283064365386962890625e-10"),e.precision+=n,t=Re(e,1,t.times(o),new e(1));for(var r=n;r--;){var s=t.times(t);t=s.times(s).minus(s).times(8).plus(1)}return e.precision-=n,t}var V=(function(){function e(i,o,r){var s,a=0,l=i.length;for(i=i.slice();l--;)s=i[l]*o+a,i[l]=s%r|0,a=s/r|0;return a&&i.unshift(a),i}function t(i,o,r,s){var a,l;if(r!=s)l=r>s?1:-1;else for(a=l=0;a<r;a++)if(i[a]!=o[a]){l=i[a]>o[a]?1:-1;break}return l}function n(i,o,r,s){for(var a=0;r--;)i[r]-=a,a=i[r]<o[r]?1:0,i[r]=a*s+i[r]-o[r];for(;!i[0]&&i.length>1;)i.shift()}return function(i,o,r,s,a,l){var d,f,u,m,y,F,T,z,k,Y,N,j,Fe,fe,ce,be,Te,me,Q,Me,ye=i.constructor,De=i.s==o.s?1:-1,Z=i.d,$=o.d;if(!Z||!Z[0]||!$||!$[0])return new ye(!i.s||!o.s||(Z?$&&Z[0]==$[0]:!$)?NaN:Z&&Z[0]==0||!$?De*0:De/0);for(l?(y=1,f=i.e-o.e):(l=we,y=E,f=ie(i.e/y)-ie(o.e/y)),Q=$.length,Te=Z.length,k=new ye(De),Y=k.d=[],u=0;$[u]==(Z[u]||0);u++);if($[u]>(Z[u]||0)&&f--,r==null?(fe=r=ye.precision,s=ye.rounding):a?fe=r+(i.e-o.e)+1:fe=r,fe<0)Y.push(1),F=!0;else{if(fe=fe/y+2|0,u=0,Q==1){for(m=0,$=$[0],fe++;(u<Te||m)&&fe--;u++)ce=m*l+(Z[u]||0),Y[u]=ce/$|0,m=ce%$|0;F=m||u<Te}else{for(m=l/($[0]+1)|0,m>1&&($=e($,m,l),Z=e(Z,m,l),Q=$.length,Te=Z.length),be=Q,N=Z.slice(0,Q),j=N.length;j<Q;)N[j++]=0;Me=$.slice(),Me.unshift(0),me=$[0],$[1]>=l/2&&++me;do m=0,d=t($,N,Q,j),d<0?(Fe=N[0],Q!=j&&(Fe=Fe*l+(N[1]||0)),m=Fe/me|0,m>1?(m>=l&&(m=l-1),T=e($,m,l),z=T.length,j=N.length,d=t(T,N,z,j),d==1&&(m--,n(T,Q<z?Me:$,z,l))):(m==0&&(d=m=1),T=$.slice()),z=T.length,z<j&&T.unshift(0),n(N,T,j,l),d==-1&&(j=N.length,d=t($,N,Q,j),d<1&&(m++,n(N,Q<j?Me:$,j,l))),j=N.length):d===0&&(m++,N=[0]),Y[u++]=m,d&&N[0]?N[j++]=Z[be]||0:(N=[Z[be]],j=1);while((be++<Te||N[0]!==void 0)&&fe--);F=N[0]!==void 0}Y[0]||Y.shift()}if(y==1)k.e=f,Pt=F;else{for(u=1,m=Y[0];m>=10;m/=10)u++;k.e=u+f*y-1,b(k,a?r+k.e+1:r,s,F)}return k}})();function b(e,t,n,i){var o,r,s,a,l,d,f,u,m,y=e.constructor;e:if(t!=null){if(u=e.d,!u)return e;for(o=1,a=u[0];a>=10;a/=10)o++;if(r=t-o,r<0)r+=E,s=t,f=u[m=0],l=f/X(10,o-s-1)%10|0;else if(m=Math.ceil((r+1)/E),a=u.length,m>=a)if(i){for(;a++<=m;)u.push(0);f=l=0,o=1,r%=E,s=r-E+1}else break e;else{for(f=a=u[m],o=1;a>=10;a/=10)o++;r%=E,s=r-E+o,l=s<0?0:f/X(10,o-s-1)%10|0}if(i=i||t<0||u[m+1]!==void 0||(s<0?f:f%X(10,o-s-1)),d=n<4?(l||i)&&(n==0||n==(e.s<0?3:2)):l>5||l==5&&(n==4||i||n==6&&(r>0?s>0?f/X(10,o-s):0:u[m-1])%10&1||n==(e.s<0?8:7)),t<1||!u[0])return u.length=0,d?(t-=e.e+1,u[0]=X(10,(E-t%E)%E),e.e=-t||0):u[0]=e.e=0,e;if(r==0?(u.length=m,a=1,m--):(u.length=m+1,a=X(10,E-r),u[m]=s>0?(f/X(10,o-s)%X(10,s)|0)*a:0),d)for(;;)if(m==0){for(r=1,s=u[0];s>=10;s/=10)r++;for(s=u[0]+=a,a=1;s>=10;s/=10)a++;r!=a&&(e.e++,u[0]==we&&(u[0]=1));break}else{if(u[m]+=a,u[m]!=we)break;u[m--]=0,a=1}for(r=u.length;u[--r]===0;)u.pop()}return M&&(e.e>y.maxE?(e.d=null,e.e=NaN):e.e<y.minE&&(e.e=0,e.d=[0])),e}function Ae(e,t,n){if(!e.isFinite())return Wt(e);var i,o=e.e,r=te(e.d),s=r.length;return t?(n&&(i=n-s)>0?r=r.charAt(0)+"."+r.slice(1)+Ne(i):s>1&&(r=r.charAt(0)+"."+r.slice(1)),r=r+(e.e<0?"e":"e+")+e.e):o<0?(r="0."+Ne(-o-1)+r,n&&(i=n-s)>0&&(r+=Ne(i))):o>=s?(r+=Ne(o+1-s),n&&(i=n-o-1)>0&&(r=r+"."+Ne(i))):((i=o+1)<s&&(r=r.slice(0,i)+"."+r.slice(i)),n&&(i=n-s)>0&&(o+1===s&&(r+="."),r+=Ne(i))),r}function rt(e,t){var n=e[0];for(t*=E;n>=10;n/=10)t++;return t}function ot(e,t,n){if(t>Ln)throw M=!0,n&&(e.precision=n),Error(Ot);return b(new e(tt),t,1,!0)}function Ie(e,t,n){if(t>It)throw Error(Ot);return b(new e(nt),t,n,!0)}function Ht(e){var t=e.length-1,n=t*E+1;if(t=e[t],t){for(;t%10==0;t/=10)n--;for(t=e[0];t>=10;t/=10)n++}return n}function Ne(e){for(var t="";e--;)t+="0";return t}function Rt(e,t,n,i){var o,r=new e(1),s=Math.ceil(i/E+4);for(M=!1;;){if(n%2&&(r=r.times(t),Nt(r.d,s)&&(o=!0)),n=ie(n/2),n===0){n=r.d.length-1,o&&r.d[n]===0&&++r.d[n];break}t=t.times(t),Nt(t.d,s)}return M=!0,r}function Bt(e){return e.d[e.d.length-1]&1}function qt(e,t,n){for(var i,o,r=new e(t[0]),s=0;++s<t.length;){if(o=new e(t[s]),!o.s){r=o;break}i=r.cmp(o),(i===n||i===0&&r.s===n)&&(r=o)}return r}function At(e,t){var n,i,o,r,s,a,l,d=0,f=0,u=0,m=e.constructor,y=m.rounding,F=m.precision;if(!e.d||!e.d[0]||e.e>17)return new m(e.d?e.d[0]?e.s<0?0:1/0:1:e.s?e.s<0?0:e:NaN);for(t==null?(M=!1,l=F):l=t,a=new m(.03125);e.e>-2;)e=e.times(a),u+=5;for(i=Math.log(X(2,u))/Math.LN10*2+5|0,l+=i,n=r=s=new m(1),m.precision=l;;){if(r=b(r.times(e),l,1),n=n.times(++f),a=s.plus(V(r,n,l,1)),te(a.d).slice(0,l)===te(s.d).slice(0,l)){for(o=u;o--;)s=b(s.times(s),l,1);if(t==null)if(d<3&&ze(s.d,l-i,y,d))m.precision=l+=10,n=r=a=new m(1),f=0,d++;else return b(s,m.precision=F,y,M=!0);else return m.precision=F,s}s=a}}function Ue(e,t){var n,i,o,r,s,a,l,d,f,u,m,y=1,F=10,T=e,z=T.d,k=T.constructor,Y=k.rounding,N=k.precision;if(T.s<0||!z||!z[0]||!T.e&&z[0]==1&&z.length==1)return new k(z&&!z[0]?-1/0:T.s!=1?NaN:z?0:T);if(t==null?(M=!1,f=N):f=t,k.precision=f+=F,n=te(z),i=n.charAt(0),Math.abs(r=T.e)<15e14){for(;i<7&&i!=1||i==1&&n.charAt(1)>3;)T=T.times(e),n=te(T.d),i=n.charAt(0),y++;r=T.e,i>1?(T=new k("0."+n),r++):T=new k(i+"."+n.slice(1))}else return d=ot(k,f+2,N).times(r+""),T=Ue(new k(i+"."+n.slice(1)),f-F).plus(d),k.precision=N,t==null?b(T,N,Y,M=!0):T;for(u=T,l=s=T=V(T.minus(1),T.plus(1),f,1),m=b(T.times(T),f,1),o=3;;){if(s=b(s.times(m),f,1),d=l.plus(V(s,new k(o),f,1)),te(d.d).slice(0,f)===te(l.d).slice(0,f))if(l=l.times(2),r!==0&&(l=l.plus(ot(k,f+2,N).times(r+""))),l=V(l,new k(y),f,1),t==null)if(ze(l.d,f-F,Y,a))k.precision=f+=F,d=s=T=V(u.minus(1),u.plus(1),f,1),m=b(T.times(T),f,1),o=a=1;else return b(l,k.precision=N,Y,M=!0);else return k.precision=N,l;l=d,o+=2}}function Wt(e){return String(e.s*e.s/0)}function et(e,t){var n,i,o;for((n=t.indexOf("."))>-1&&(t=t.replace(".","")),(i=t.search(/e/i))>0?(n<0&&(n=i),n+=+t.slice(i+1),t=t.substring(0,i)):n<0&&(n=t.length),i=0;t.charCodeAt(i)===48;i++);for(o=t.length;t.charCodeAt(o-1)===48;--o);if(t=t.slice(i,o),t){if(o-=i,e.e=n=n-i-1,e.d=[],i=(n+1)%E,n<0&&(i+=E),i<o){for(i&&e.d.push(+t.slice(0,i)),o-=E;i<o;)e.d.push(+t.slice(i,i+=E));t=t.slice(i),i=E-t.length}else i-=o;for(;i--;)t+="0";e.d.push(+t),M&&(e.e>e.constructor.maxE?(e.d=null,e.e=NaN):e.e<e.constructor.minE&&(e.e=0,e.d=[0]))}else e.e=0,e.d=[0];return e}function En(e,t){var n,i,o,r,s,a,l,d,f;if(t.indexOf("_")>-1){if(t=t.replace(/(\d)_(?=\d)/g,"$1"),kt.test(t))return et(e,t)}else if(t==="Infinity"||t==="NaN")return+t||(e.s=NaN),e.e=NaN,e.d=null,e;if(In.test(t))n=16,t=t.toLowerCase();else if(Tn.test(t))n=2;else if(An.test(t))n=8;else throw Error(Pe+t);for(r=t.search(/p/i),r>0?(l=+t.slice(r+1),t=t.substring(2,r)):t=t.slice(2),r=t.indexOf("."),s=r>=0,i=e.constructor,s&&(t=t.replace(".",""),a=t.length,r=a-r,o=Rt(i,new i(n),r,r*2)),d=Je(t,n,we),f=d.length-1,r=f;d[r]===0;--r)d.pop();return r<0?new i(e.s*0):(e.e=rt(d,f),e.d=d,M=!1,s&&(e=V(e,o,a*4)),l&&(e=e.times(Math.abs(l)<54?X(2,l):Ye.pow(2,l))),M=!0,e)}function xn(e,t){var n,i=t.d.length;if(i<3)return t.isZero()?t:Re(e,2,t,t);n=1.4*Math.sqrt(i),n=n>16?16:n|0,t=t.times(1/st(5,n)),t=Re(e,2,t,t);for(var o,r=new e(5),s=new e(16),a=new e(20);n--;)o=t.times(t),t=t.times(r.plus(o.times(s.times(o).minus(a))));return t}function Re(e,t,n,i,o){var r,s,a,l,d=1,f=e.precision,u=Math.ceil(f/E);for(M=!1,l=n.times(n),a=new e(i);;){if(s=V(a.times(l),new e(t++*t++),f,1),a=o?i.plus(s):i.minus(s),i=V(s.times(l),new e(t++*t++),f,1),s=a.plus(i),s.d[u]!==void 0){for(r=u;s.d[r]===a.d[r]&&r--;);if(r==-1)break}r=a,a=i,i=s,s=r,d++}return M=!0,s.d.length=u+1,s}function st(e,t){for(var n=e;--t;)n*=e;return n}function Vt(e,t){var n,i=t.s<0,o=Ie(e,e.precision,1),r=o.times(.5);if(t=t.abs(),t.lte(r))return xe=i?4:1,t;if(n=t.divToInt(o),n.isZero())xe=i?3:2;else{if(t=t.minus(n.times(o)),t.lte(r))return xe=Bt(n)?i?2:3:i?4:1,t;xe=Bt(n)?i?1:4:i?3:2}return t.minus(o).abs()}function St(e,t,n,i){var o,r,s,a,l,d,f,u,m,y=e.constructor,F=n!==void 0;if(F?(le(n,1,Oe),i===void 0?i=y.rounding:le(i,0,8)):(n=y.precision,i=y.rounding),!e.isFinite())f=Wt(e);else{for(f=Ae(e),s=f.indexOf("."),F?(o=2,t==16?n=n*4-3:t==8&&(n=n*3-2)):o=t,s>=0&&(f=f.replace(".",""),m=new y(1),m.e=f.length-s,m.d=Je(Ae(m),10,o),m.e=m.d.length),u=Je(f,10,o),r=l=u.length;u[--l]==0;)u.pop();if(!u[0])f=F?"0p+0":"0";else{if(s<0?r--:(e=new y(e),e.d=u,e.e=r,e=V(e,m,n,i,0,o),u=e.d,r=e.e,d=Pt),s=u[n],a=o/2,d=d||u[n+1]!==void 0,d=i<4?(s!==void 0||d)&&(i===0||i===(e.s<0?3:2)):s>a||s===a&&(i===4||d||i===6&&u[n-1]&1||i===(e.s<0?8:7)),u.length=n,d)for(;++u[--n]>o-1;)u[n]=0,n||(++r,u.unshift(1));for(l=u.length;!u[l-1];--l);for(s=0,f="";s<l;s++)f+=wt.charAt(u[s]);if(F){if(l>1)if(t==16||t==8){for(s=t==16?4:3,--l;l%s;l++)f+="0";for(u=Je(f,o,t),l=u.length;!u[l-1];--l);for(s=1,f="1.";s<l;s++)f+=wt.charAt(u[s])}else f=f.charAt(0)+"."+f.slice(1);f=f+(r<0?"p":"p+")+r}else if(r<0){for(;++r;)f="0"+f;f="0."+f}else if(++r>l)for(r-=l;r--;)f+="0";else r<l&&(f=f.slice(0,r)+"."+f.slice(r))}f=(t==16?"0x":t==2?"0b":t==8?"0o":"")+f}return e.s<0?"-"+f:f}function Nt(e,t){if(e.length>t)return e.length=t,!0}function Fn(e){return new this(e).abs()}function Mn(e){return new this(e).acos()}function Dn(e){return new this(e).acosh()}function _n(e,t){return new this(e).plus(t)}function Bn(e){return new this(e).asin()}function Nn(e){return new this(e).asinh()}function Un(e){return new this(e).atan()}function Pn(e){return new this(e).atanh()}function On(e,t){e=new this(e),t=new this(t);var n,i=this.precision,o=this.rounding,r=i+4;return!e.s||!t.s?n=new this(NaN):!e.d&&!t.d?(n=Ie(this,r,1).times(t.s>0?.25:.75),n.s=e.s):!t.d||e.isZero()?(n=t.s<0?Ie(this,i,o):new this(0),n.s=e.s):!e.d||t.isZero()?(n=Ie(this,r,1).times(.5),n.s=e.s):t.s<0?(this.precision=r,this.rounding=1,n=this.atan(V(e,t,r,1)),t=Ie(this,r,1),this.precision=i,this.rounding=o,n=e.s<0?n.minus(t):n.plus(t)):n=this.atan(V(e,t,r,1)),n}function $n(e){return new this(e).cbrt()}function Cn(e){return b(e=new this(e),e.e+1,2)}function kn(e,t,n){return new this(e).clamp(t,n)}function Hn(e){if(!e||typeof e!="object")throw Error(it+"Object expected");var t,n,i,o=e.defaults===!0,r=["precision",1,Oe,"rounding",0,8,"toExpNeg",-He,0,"toExpPos",0,He,"maxE",0,He,"minE",-He,0,"modulo",0,9];for(t=0;t<r.length;t+=3)if(n=r[t],o&&(this[n]=Tt[n]),(i=e[n])!==void 0)if(ie(i)===i&&i>=r[t+1]&&i<=r[t+2])this[n]=i;else throw Error(Pe+n+": "+i);if(n="crypto",o&&(this[n]=Tt[n]),(i=e[n])!==void 0)if(i===!0||i===!1||i===0||i===1)if(i)if(typeof crypto!="undefined"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))this[n]=!0;else throw Error($t);else this[n]=!1;else throw Error(Pe+n+": "+i);return this}function Rn(e){return new this(e).cos()}function qn(e){return new this(e).cosh()}function Zt(e){var t,n,i;function o(r){var s,a,l,d=this;if(!(d instanceof o))return new o(r);if(d.constructor=o,Ut(r)){d.s=r.s,M?!r.d||r.e>o.maxE?(d.e=NaN,d.d=null):r.e<o.minE?(d.e=0,d.d=[0]):(d.e=r.e,d.d=r.d.slice()):(d.e=r.e,d.d=r.d?r.d.slice():r.d);return}if(l=typeof r,l==="number"){if(r===0){d.s=1/r<0?-1:1,d.e=0,d.d=[0];return}if(r<0?(r=-r,d.s=-1):d.s=1,r===~~r&&r<1e7){for(s=0,a=r;a>=10;a/=10)s++;M?s>o.maxE?(d.e=NaN,d.d=null):s<o.minE?(d.e=0,d.d=[0]):(d.e=s,d.d=[r]):(d.e=s,d.d=[r]);return}if(r*0!==0){r||(d.s=NaN),d.e=NaN,d.d=null;return}return et(d,r.toString())}if(l==="string")return(a=r.charCodeAt(0))===45?(r=r.slice(1),d.s=-1):(a===43&&(r=r.slice(1)),d.s=1),kt.test(r)?et(d,r):En(d,r);if(l==="bigint")return r<0?(r=-r,d.s=-1):d.s=1,et(d,r.toString());throw Error(Pe+r)}if(o.prototype=p,o.ROUND_UP=0,o.ROUND_DOWN=1,o.ROUND_CEIL=2,o.ROUND_FLOOR=3,o.ROUND_HALF_UP=4,o.ROUND_HALF_DOWN=5,o.ROUND_HALF_EVEN=6,o.ROUND_HALF_CEIL=7,o.ROUND_HALF_FLOOR=8,o.EUCLID=9,o.config=o.set=Hn,o.clone=Zt,o.isDecimal=Ut,o.abs=Fn,o.acos=Mn,o.acosh=Dn,o.add=_n,o.asin=Bn,o.asinh=Nn,o.atan=Un,o.atanh=Pn,o.atan2=On,o.cbrt=$n,o.ceil=Cn,o.clamp=kn,o.cos=Rn,o.cosh=qn,o.div=Wn,o.exp=Vn,o.floor=Zn,o.hypot=zn,o.ln=Yn,o.log=Qn,o.log10=Xn,o.log2=Gn,o.max=jn,o.min=Kn,o.mod=Jn,o.mul=eo,o.pow=to,o.random=no,o.round=oo,o.sign=io,o.sin=ro,o.sinh=so,o.sqrt=ao,o.sub=lo,o.sum=uo,o.tan=fo,o.tanh=co,o.trunc=mo,e===void 0&&(e={}),e&&e.defaults!==!0)for(i=["precision","rounding","toExpNeg","toExpPos","maxE","minE","modulo","crypto"],t=0;t<i.length;)e.hasOwnProperty(n=i[t++])||(e[n]=this[n]);return o.config(e),o}function Wn(e,t){return new this(e).div(t)}function Vn(e){return new this(e).exp()}function Zn(e){return b(e=new this(e),e.e+1,3)}function zn(){var e,t,n=new this(0);for(M=!1,e=0;e<arguments.length;)if(t=new this(arguments[e++]),t.d)n.d&&(n=n.plus(t.times(t)));else{if(t.s)return M=!0,new this(1/0);n=t}return M=!0,n.sqrt()}function Ut(e){return e instanceof Ye||e&&e.toStringTag===Ct||!1}function Yn(e){return new this(e).ln()}function Qn(e,t){return new this(e).log(t)}function Gn(e){return new this(e).log(2)}function Xn(e){return new this(e).log(10)}function jn(){return qt(this,arguments,-1)}function Kn(){return qt(this,arguments,1)}function Jn(e,t){return new this(e).mod(t)}function eo(e,t){return new this(e).mul(t)}function to(e,t){return new this(e).pow(t)}function no(e){var t,n,i,o,r=0,s=new this(1),a=[];if(e===void 0?e=this.precision:le(e,1,Oe),i=Math.ceil(e/E),this.crypto)if(crypto.getRandomValues)for(t=crypto.getRandomValues(new Uint32Array(i));r<i;)o=t[r],o>=429e7?t[r]=crypto.getRandomValues(new Uint32Array(1))[0]:a[r++]=o%1e7;else if(crypto.randomBytes){for(t=crypto.randomBytes(i*=4);r<i;)o=t[r]+(t[r+1]<<8)+(t[r+2]<<16)+((t[r+3]&127)<<24),o>=214e7?crypto.randomBytes(4).copy(t,r):(a.push(o%1e7),r+=4);r=i/4}else throw Error($t);else for(;r<i;)a[r++]=Math.random()*1e7|0;for(i=a[--r],e%=E,i&&e&&(o=X(10,E-e),a[r]=(i/o|0)*o);a[r]===0;r--)a.pop();if(r<0)n=0,a=[0];else{for(n=-1;a[0]===0;n-=E)a.shift();for(i=1,o=a[0];o>=10;o/=10)i++;i<E&&(n-=E-i)}return s.e=n,s.d=a,s}function oo(e){return b(e=new this(e),e.e+1,this.rounding)}function io(e){return e=new this(e),e.d?e.d[0]?e.s:0*e.s:e.s||NaN}function ro(e){return new this(e).sin()}function so(e){return new this(e).sinh()}function ao(e){return new this(e).sqrt()}function lo(e,t){return new this(e).sub(t)}function uo(){var e=0,t=arguments,n=new this(t[e]);for(M=!1;n.s&&++e<t.length;)n=n.plus(t[e]);return M=!0,b(n,this.precision,this.rounding)}function fo(e){return new this(e).tan()}function co(e){return new this(e).tanh()}function mo(e){return b(e=new this(e),e.e+1,1)}p[Symbol.for("nodejs.util.inspect.custom")]=p.toString;p[Symbol.toStringTag]="Decimal";var Ye=p.constructor=Zt(Tt);tt=new Ye(tt);nt=new Ye(nt);var D=Ye;var We=wn(Yt());D.set({precision:20,rounding:D.ROUND_HALF_UP});var tn=(i=>(i.STANDARD="STANDARD",i.SLOW="SLOW",i.RAPID="RAPID",i))(tn||{});var nn=(i=>(i.DILUTE_INITIAL="DILUTE_INITIAL",i.DILUTE_ALL="DILUTE_ALL",i.DILUTE_NONE="DILUTE_NONE",i))(nn||{}),on={STANDARD:[1,2.5,5,10,20,40,80,120,160,240,300],SLOW:[.5,1,1.5,2.5,5,10,20,30,40,60,80,100,120,140,160,190,220,260,300],RAPID:[5,10,20,40,80,160,300]},go=[.2,.25,.3,.35,.4,.45,.5,1,2,5,10],po=[.5,1,1.5,2,2.5,3,3.5,4,4.5,5,6,7,8,9,10],ho=[.5,1,1.5,2,2.5,3,4,5,7,9,10,11,12],Qt=500,$e;$e={minMeasurableMass:new D(.2),minMeasurableVolume:new D(.2),minServingsForMix:new D(3),PROTEIN_TOLERANCE_MG:new D(.5),DEFAULT_FOOD_A_DILUTION_THRESHOLD:new D(.2),DEFAULT_FOOD_B_THRESHOLD:new D(.2),MAX_SOLID_CONCENTRATION:new D(.05)};var c=null,Lt=[],bt=[],Et=[],rn=[],Se="",qe=null;var ae=-1,Ve="";function ve(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}function Ge(e,t){return new D(e).times(1e3).dividedBy(100)}function Gt(e){return e.times(100).dividedBy(1e3).toNumber()}function C(e,t){return e==null?"":(typeof e=="number"?e:e.toNumber()).toFixed(t)}function ue(e,t){if(e==null)return"";let n=typeof e=="number"?e:e.toNumber();return t==="g"?n.toFixed(2):n%1===0?n.toFixed(0):n.toFixed(1)}function Xt(e){return e.type==="LIQUID"?"ml":"g"}function vo(e,t,n){let i=[],o=t.type==="SOLID"?go:po,r=t.type==="SOLID"?e.dividedBy(n.MAX_SOLID_CONCENTRATION.times(t.mgPerUnit)):null;for(let s of o){let a=new D(s);for(let l of ho){let d=new D(l);if(t.type==="SOLID"){let f=a.times(t.mgPerUnit),u=f.dividedBy(e);if(u.lessThan(n.minServingsForMix))continue;let m=d.times(u),y=m;if(a.lessThan(n.minMeasurableMass)||d.lessThan(n.minMeasurableVolume)||y.greaterThan(Qt)||y.lessThan(n.minMeasurableVolume)||f.dividedBy(m).times(d).minus(e).abs().greaterThan(n.PROTEIN_TOLERANCE_MG))continue;i.push({mixFoodAmount:a,mixWaterAmount:y,dailyAmount:d,mixTotalVolume:m,servings:u})}else{let f=a.times(t.mgPerUnit),u=f.dividedBy(e);if(u.lessThan(n.minServingsForMix))continue;let m=d.times(u),y=m.minus(a);if(y.lessThan(0)||a.lessThan(n.minMeasurableVolume)||d.lessThan(n.minMeasurableVolume)||y.greaterThan(Qt)||y.lessThan(n.minMeasurableVolume)||f.dividedBy(m).times(d).minus(e).abs().greaterThan(n.PROTEIN_TOLERANCE_MG))continue;i.push({mixFoodAmount:a,mixWaterAmount:y,dailyAmount:d,mixTotalVolume:m,servings:u})}}}return i.sort((s,a)=>{if(t.type==="SOLID"&&r){let d=s.dailyAmount.greaterThanOrEqualTo(r),f=a.dailyAmount.greaterThanOrEqualTo(r);if(d&&!f)return-1;if(!d&&f)return 1}let l=s.mixFoodAmount.comparedTo(a.mixFoodAmount);return l!==0||(l=s.dailyAmount.comparedTo(a.dailyAmount),l!==0)||(l=s.mixTotalVolume.comparedTo(a.mixTotalVolume),l!==0)?l:s.mixWaterAmount.comparedTo(a.mixWaterAmount)}),i}function xt(e,t,n,i,o,r){let s=new D(e),a=s.dividedBy(n.mgPerUnit),l=n.type==="SOLID"?"g":"ml",d=!1;if(i==="DILUTE_INITIAL"?d=a.lessThan(o):i==="DILUTE_ALL"?d=!0:d=!1,d){let f=vo(s,n,r);if(f.length===0)return null;let u=f[0];return{stepIndex:t,targetMg:s,method:"DILUTE",dailyAmount:u.dailyAmount,dailyAmountUnit:"ml",mixFoodAmount:u.mixFoodAmount,mixWaterAmount:u.mixWaterAmount,servings:u.servings,food:"A"}}else return{stepIndex:t,targetMg:s,method:"DIRECT",dailyAmount:a,dailyAmountUnit:l,food:"A"}}function sn(e,t){let n="STANDARD",i="DILUTE_INITIAL",o=e.type==="SOLID"?"g":"ml",r=$e.DEFAULT_FOOD_A_DILUTION_THRESHOLD,s=on[n],a=[];for(let l=0;l<s.length;l++){let d=xt(s[l],l+1,e,i,r,t);if(d)a.push(d);else{let f=new D(s[l]),u=f.dividedBy(e.mgPerUnit);a.push({stepIndex:l+1,targetMg:f,method:"DIRECT",dailyAmount:u,dailyAmountUnit:o,food:"A"})}}return{dosingStrategy:n,foodA:e,foodAStrategy:i,diThreshold:r,steps:a,config:t}}function ft(e){if(!e.foodB)return e.steps.length;for(let t=0;t<e.steps.length;t++)if(e.steps[t].food==="B")return t;return e.steps.length}function Xe(e,t,n){let i=n.amount.times(t.mgPerUnit);e.foodB=t,e.foodBThreshold=n;let o=-1;for(let u=0;u<e.steps.length;u++)if(e.steps[u].targetMg.greaterThanOrEqualTo(i)){o=u;break}if(o===-1){console.warn("No transition point found for Food B");return}let r=[];for(let u=o+1;u<e.steps.length;u++)r.push(e.steps[u].targetMg);let s=e.steps[o].targetMg,a=[],l=t.type==="SOLID"?"g":"ml",d=s,f=d.dividedBy(t.mgPerUnit);a.push({stepIndex:o+2,targetMg:d,method:"DIRECT",dailyAmount:f,dailyAmountUnit:l,food:"B"});for(let u of r){let m=u.dividedBy(t.mgPerUnit);a.push({stepIndex:0,targetMg:u,method:"DIRECT",dailyAmount:m,dailyAmountUnit:l,food:"B"})}e.steps=e.steps.slice(0,o+1),e.steps.push(...a);for(let u=0;u<e.steps.length;u++)e.steps[u].stepIndex=u+1}function an(e){var n,i;let t=[];if(e.steps.length<5&&t.push({severity:"red",code:"R1",message:"Protocol < 5 steps, which is quite rapid for a full OIT protocol."}),e.foodA.mgPerUnit.lessThanOrEqualTo(new D(0))&&t.push({severity:"red",code:"R7",message:`${ve(e.foodA.name)} protein concentration must be > 0 to be considered for OIT`}),(n=e.foodB)!=null&&n.mgPerUnit.lessThanOrEqualTo(new D(0))&&t.push({severity:"red",code:"R7",message:`${ve(((i=e.foodB)==null?void 0:i.name)||"")} protein concentration must be > 0 to be considered for OIT`}),e.foodB){let o=!1;for(let r of e.steps)r.food==="B"&&(o=!0);o===!1&&t.push({severity:"yellow",code:"Y5",message:`${ve(e.foodB.name)} has no transition point. Decrease the threshold if you want to transition.`})}for(let o of e.steps){let s=o.food==="B"?e.foodB:e.foodA;if(o.targetMg.lessThanOrEqualTo(new D(0))&&t.push({severity:"red",code:"R8",message:`Step ${o.stepIndex}: A target protein of ${C(o.targetMg,1)} mg is NOT valid. It must be >0.`,stepIndex:o.stepIndex}),o.method==="DILUTE"){let a=o.mixFoodAmount.times(s.mgPerUnit),l=s.type==="SOLID"?o.mixWaterAmount:o.mixFoodAmount.plus(o.mixWaterAmount),d=a.times(o.dailyAmount).dividedBy(l);if(d.minus(o.targetMg).abs().greaterThan(.5)&&t.push({severity:"red",code:"R2",message:`Step ${o.stepIndex}: Protein mismatch. Target ${C(o.targetMg,1)} mg but calculated ${C(d,1)} mg.`,stepIndex:o.stepIndex}),o.servings.lessThan(new D(1))){let u=o.mixFoodAmount.times(s.mgPerUnit);t.push({severity:"red",code:"R5",message:`Step ${o.stepIndex}: ${C(o.mixFoodAmount,2)} ${Xt(s)} of food only makes ${C(u,1)} mg of total protein. However, target protein is ${C(o.targetMg,1)} mg.`,stepIndex:o.stepIndex})}l.lessThan(o.dailyAmount)&&t.push({severity:"red",code:"R6",message:`Step ${o.stepIndex}: Total volume of dilution is ${C(l,1)} ml; however, daily amount is ${C(o.dailyAmount,1)} ml, which is impossible`,stepIndex:o.stepIndex}),o.dailyAmount.lessThanOrEqualTo(0)&&t.push({severity:"red",code:"R9",message:`Step ${o.stepIndex}: Daily amount cannot be <= 0 ml`,stepIndex:o.stepIndex}),o.mixFoodAmount.lessThanOrEqualTo(0)&&t.push({severity:"red",code:"R9",message:`Step ${o.stepIndex}: Amount of food to mix cannot be <= 0 ${Xt(s)}`,stepIndex:o.stepIndex}),o.mixWaterAmount.lessThan(0)&&t.push({severity:"red",code:"R9",message:`Step ${o.stepIndex}: Amount of water to mix cannot be < 0 ml`,stepIndex:o.stepIndex}),s.type==="SOLID"&&o.mixFoodAmount.lessThan(e.config.minMeasurableMass)&&t.push({severity:"yellow",code:"Y3",message:`Step ${o.stepIndex}: Measuring ${C(o.mixFoodAmount,2)} g of food is impractical. Aim for value >=${e.config.minMeasurableMass} g`,stepIndex:o.stepIndex}),s.type==="LIQUID"&&o.mixFoodAmount.lessThan(e.config.minMeasurableVolume)&&t.push({severity:"yellow",code:"Y3",message:`Step ${o.stepIndex}: Measuring ${C(o.mixFoodAmount,1)} ml of food is impractical. Aim for value >=${e.config.minMeasurableVolume} ml`,stepIndex:o.stepIndex}),o.dailyAmount.lessThan(e.config.minMeasurableVolume)&&t.push({severity:"yellow",code:"Y3",message:`Step ${o.stepIndex}: Measuring a daily amount of ${C(o.dailyAmount,1)} ml is impractical. Aim for value >=${e.config.minMeasurableVolume} ml`,stepIndex:o.stepIndex}),o.mixWaterAmount.lessThan(e.config.minMeasurableVolume)&&t.push({severity:"yellow",code:"Y3",message:`Step ${o.stepIndex}: Measuring ${C(o.mixWaterAmount,1)} ml of water is impractical. Aim for value >=${e.config.minMeasurableVolume} ml`,stepIndex:o.stepIndex}),o.servings.lessThan(e.config.minServingsForMix)&&o.servings.greaterThan(new D(1))&&t.push({severity:"yellow",code:"Y1",message:`Step ${o.stepIndex}: Only ${C(o.servings,1)} servings (< ${$e.minServingsForMix} - impractical). Consider increasing mix amounts.`,stepIndex:o.stepIndex}),s.type==="SOLID"&&o.mixFoodAmount.dividedBy(o.mixWaterAmount).greaterThan(new D(.05))&&t.push({severity:"yellow",code:"Y4",message:`Step ${o.stepIndex}: at ${C(o.mixFoodAmount,2)} g of food in ${C(o.mixWaterAmount,1)} ml of water, the ratio of food:water is >1:20. The assumption that the food contributes non-negligibly to the total volume of dilution is likely violated. Consider increasing the Daily Amount`,stepIndex:o.stepIndex})}else if(o.method==="DIRECT"){let a=o.dailyAmount.times(s.mgPerUnit);a.minus(o.targetMg).abs().greaterThan(.5)&&t.push({severity:"red",code:"R2",message:`Step ${o.stepIndex}: Protein mismatch. Target ${C(o.targetMg,1)} mg but calculated ${C(a,1)} mg.`,stepIndex:o.stepIndex}),s.type==="SOLID"&&o.dailyAmount.lessThan(e.config.minMeasurableMass)&&t.push({severity:"yellow",code:"Y3",message:`Step ${o.stepIndex}: Measuring ${C(o.dailyAmount,2)} g of food is impractical. Aim for >=${e.config.minMeasurableMass} g`,stepIndex:o.stepIndex}),s.type==="LIQUID"&&o.dailyAmount.lessThan(e.config.minMeasurableVolume)&&t.push({severity:"yellow",code:"Y3",message:`Step ${o.stepIndex}: Measuring ${C(o.dailyAmount,1)} ml of food is impractical. Aim for >=${e.config.minMeasurableVolume} ml`,stepIndex:o.stepIndex})}}for(let o=1;o<e.steps.length;o++)e.steps[o].targetMg.lessThan(e.steps[o-1].targetMg)&&t.push({severity:"yellow",code:"Y2",message:`Steps must be ascending or equal \u2014 check step ${e.steps[o].stepIndex} vs step ${e.steps[o-1].stepIndex}.`,stepIndex:e.steps[o].stepIndex});return t}function ut(){if(!c)return;let e=on[c.dosingStrategy],t=[];for(let n=0;n<e.length;n++){let i=xt(e[n],n+1,c.foodA,c.foodAStrategy,c.diThreshold,c.config);i&&t.push(i)}c.steps=t,c.foodB&&c.foodBThreshold&&Xe(c,c.foodB,c.foodBThreshold),J(),re()}function Qe(){if(!c)return;let e=c.steps.map(o=>o.targetMg),t=c.steps.map(o=>o.food),n=ft(c),i=[];for(let o=0;o<e.length;o++){let r=e[o],s=t[o]==="B",a=s?c.foodB:c.foodA,l=s?"DILUTE_NONE":c.foodAStrategy,d=xt(r,o+1,a,l,c.diThreshold,c.config);d&&(d.food=t[o],i.push(d))}c.steps=i,J(),re()}function yo(e,t){if(!c)return;let n=c.steps[e-1];if(!n)return;n.targetMg=new D(t);let o=n.food==="B"?c.foodB:c.foodA;if(n.method==="DIRECT")n.dailyAmount=n.targetMg.dividedBy(o.mgPerUnit);else{let r=n.mixFoodAmount.times(o.mgPerUnit);if(n.servings=r.dividedBy(n.targetMg),o.type==="SOLID"){let s=n.dailyAmount.times(n.servings);n.mixWaterAmount=s}else{let s=n.dailyAmount.times(n.servings);n.mixWaterAmount=s.minus(n.mixFoodAmount)}}J(),re()}function wo(e,t){if(!c)return;let n=c.steps[e-1];if(!n)return;n.dailyAmount=new D(t);let o=n.food==="B"?c.foodB:c.foodA;if(n.method==="DIRECT")n.targetMg=n.dailyAmount.times(o.mgPerUnit);else{let r=n.mixFoodAmount.times(o.mgPerUnit);if(n.servings=r.dividedBy(n.targetMg),o.type==="SOLID"){let s=n.dailyAmount.times(n.servings);n.mixWaterAmount=s}else{let s=n.dailyAmount.times(n.servings);n.mixWaterAmount=s.minus(n.mixFoodAmount)}}J(),re()}function To(e,t){if(!c)return;let n=c.steps[e-1];if(!n||n.method!=="DILUTE")return;n.mixFoodAmount=new D(t);let o=n.food==="B"?c.foodB:c.foodA,r=n.mixFoodAmount.times(o.mgPerUnit);if(n.servings=r.dividedBy(n.targetMg),o.type==="SOLID"){let s=n.dailyAmount.times(n.servings);n.mixWaterAmount=s}else{let s=n.dailyAmount.times(n.servings);n.mixWaterAmount=s.minus(n.mixFoodAmount)}J(),re()}function Io(e){if(!c)return;let t=c.steps[e-1];if(!t)return;let n={stepIndex:t.stepIndex+1,targetMg:t.targetMg,method:t.method,dailyAmount:t.dailyAmount,dailyAmountUnit:t.dailyAmountUnit,food:t.food};t.method==="DILUTE"&&(n.mixFoodAmount=t.mixFoodAmount,n.mixWaterAmount=t.mixWaterAmount,n.servings=t.servings),c.steps.splice(e,0,n);for(let i=0;i<c.steps.length;i++)c.steps[i].stepIndex=i+1;J(),re()}function Ao(e){if(c&&!(c.steps.length<=1)){c.steps.splice(e-1,1);for(let t=0;t<c.steps.length;t++)c.steps[t].stepIndex=t+1;J(),re()}}function dt(e){if(console.log(`toggleFoodType called with isFoodB=${e}`),!c)return;let t=e?c.foodB:c.foodA,n=t.type==="LIQUID";t.type=t.type==="SOLID"?"LIQUID":"SOLID";for(let i of c.steps)if(i.food==="B"===e)if(i.method==="DILUTE"){i.dailyAmountUnit="ml";let r=i.mixFoodAmount.times(t.mgPerUnit);if(i.servings=r.dividedBy(i.targetMg),t.type==="SOLID"){let s=i.dailyAmount.times(i.servings);i.mixWaterAmount=s}else{let s=i.dailyAmount.times(i.servings);i.mixWaterAmount=s.minus(i.mixFoodAmount)}}else i.dailyAmountUnit=t.type==="SOLID"?"g":"ml";Le(),J(),re()}function Le(){if(!c)return;let e=document.querySelector(".food-a-container"),t=document.querySelector(".food-b-container"),n=`
    <div class="food-a-settings">
      <input
        type="text"
        class="food-name-input"
        id="food-a-name"
        value="${ve(c.foodA.name)}"
      />
      <div class="setting-row">
        <label>Protein:</label>
        <input
          type="number"
          min="0"
          max="150"
          id="food-a-protein"
          value="${Gt(c.foodA.mgPerUnit).toFixed(1)}"
          step="0.1"
        />
        <span>g per 100 ${c.foodA.type==="SOLID"?"g":"ml"}</span>
      </div>
      <div class="setting-row">
        <label>Form:</label>
        <div class="toggle-group">
          <button class="toggle-btn ${c.foodA.type==="SOLID"?"active":""}" data-action="toggle-food-a-solid">Solid</button>
          <button class="toggle-btn ${c.foodA.type==="LIQUID"?"active":""}" data-action="toggle-food-a-liquid">Liquid</button>
        </div>
      </div>
      <div class="setting-row">
        <label>Dilution strategy:</label>
        <div class="toggle-group">
          <button class="toggle-btn ${c.foodAStrategy==="DILUTE_INITIAL"?"active":""}" data-action="food-a-strategy-initial">Initial dilution</button>
          <button class="toggle-btn ${c.foodAStrategy==="DILUTE_ALL"?"active":""}" data-action="food-a-strategy-all">Dilution throughout</button>
          <button class="toggle-btn ${c.foodAStrategy==="DILUTE_NONE"?"active":""}" data-action="food-a-strategy-none">No dilutions</button>
        </div>
      </div>
      ${c.foodAStrategy==="DILUTE_INITIAL"?`
      <div class="setting-row threshold-setting">
        <label>Directly dose when neat amount \u2265</label>
        <input
          type="number"
          id="food-a-threshold"
          min="0"
          value="${ue(c.diThreshold,c.foodA.type==="SOLID"?"g":"ml")}"
          step="0.1"
        />
        <span>${c.foodA.type==="SOLID"?"g":"ml"}</span>
      </div>
      `:""}
    </div>
  `,i=e.querySelector(".food-a-settings");if(i?i.outerHTML=n:e.insertAdjacentHTML("beforeend",n),c.foodB){let o=`
      <div class="food-b-settings">
        <input
          type="text"
          class="food-name-input"
          id="food-b-name"
          value="${ve(c.foodB.name)}"
        />
        <div class="setting-row">
          <label>Protein:</label>
          <input
            type="number"
            id="food-b-protein"
            min="0"
            max="150"
            value="${Gt(c.foodB.mgPerUnit).toFixed(1)}"
            step="0.1"
          />
          <span>g per 100 ${c.foodB.type==="SOLID"?"g":"ml"}</span>
        </div>
        <div class="setting-row">
          <label>Form:</label>
          <div class="toggle-group">
            <button class="toggle-btn ${c.foodB.type==="SOLID"?"active":""}" data-action="toggle-food-b-solid">Solid</button>
            <button class="toggle-btn ${c.foodB.type==="LIQUID"?"active":""}" data-action="toggle-food-b-liquid">Liquid</button>
          </div>
        </div>
        <div class="setting-row threshold-setting">
          <label>Transition when amount of food \u2265</label>
          <input
            type="number"
            id="food-b-threshold"
            value="${ue(c.foodBThreshold.amount,c.foodBThreshold.unit)}"
            step="0.1"
            min="0"
          />
          <span>${c.foodBThreshold.unit}</span>
        </div>
      </div>
    `,r=t.querySelector(".food-b-settings");r?r.outerHTML=o:t.insertAdjacentHTML("beforeend",o)}else{let o=t.querySelector(".food-b-settings");o&&o.remove()}Fo()}function ct(){if(!c)return;let e=document.querySelector(".dosing-strategy-container"),t=`
    <h3>Dosing Strategy (resets all steps on change)</h3>
    <div class="setting-row">
      <div class="toggle-group">
        <button class="toggle-btn ${c.dosingStrategy==="STANDARD"?"active":""}" data-strategy="STANDARD">Standard</button>
        <button class="toggle-btn ${c.dosingStrategy==="SLOW"?"active":""}" data-strategy="SLOW">Slow</button>
        <button class="toggle-btn ${c.dosingStrategy==="RAPID"?"active":""}" data-strategy="RAPID">Rapid</button>
      </div>
    </div>
  `;e.innerHTML=t,e.querySelectorAll("[data-strategy]").forEach(n=>{n.addEventListener("click",i=>{let o=i.target.getAttribute("data-strategy");c&&o!==c.dosingStrategy&&(c.dosingStrategy=o,ut(),ct())})})}function J(){if(!c)return;let e=document.querySelector(".output-container table"),t=`
    <thead>
      <tr>
        <th>Step</th>
        <th>Protein (mg)</th>
        <th>Method</th>
        <th>Daily amount</th>
        <th>Amount for mixture</th>
        <th>Water for mixture</th>
      </tr>
    </thead>
    <tbody>
  `,n=ft(c),i=!0,o=an(c),r=new Map;for(let l of o)if(l.stepIndex!==void 0){let d=r.get(l.stepIndex);(!d||l.severity==="red"&&d==="yellow")&&r.set(l.stepIndex,l.severity)}for(let l of c.steps){let d=l.food==="B",f=d?c.foodB:c.foodA;d&&i?(t+=`
        <tr class="food-section-header">
          <td colspan="6">${ve(c.foodB.name)}</td>
        </tr>
      `,i=!1):!d&&l.stepIndex===1&&(t+=`
        <tr class="food-section-header">
          <td colspan="6">${ve(c.foodA.name)}</td>
        </tr>
      `);let u=r.get(l.stepIndex),m=u?`warning-highlight-${u}`:"";if(t+=`<tr class="${m}">`,t+=`
      <td class="actions-cell">
        <button class="btn-add-step" data-step="${l.stepIndex}">+</button>
        <button class="btn-remove-step" data-step="${l.stepIndex}">\u2212</button>
        <span class="step-number">${l.stepIndex}</span>
      </td>
    `,t+=`
      <td>
        <input
          class="editable"
          type="number"
          data-step="${l.stepIndex}"
          data-field="targetMg"
          value="${C(l.targetMg,1)}"
          step="0.1"
          min="0"
        />
      </td>
    `,t+=`
      <td class="method-cell">${l.method}</td>
    `,t+=`
      <td>
        <input
          class="editable"
          type="number"
          data-step="${l.stepIndex}"
          data-field="dailyAmount"
          value="${ue(l.dailyAmount,l.dailyAmountUnit)}"
          step="0.1"
          min="0"
        />
        <span> ${l.dailyAmountUnit}</span>
      </td>
    `,l.method==="DILUTE"){let y=f.type==="SOLID"?"g":"ml";t+=`
        <td>
          <input
            class="editable"
            type="number"
            data-step="${l.stepIndex}"
            data-field="mixFoodAmount"
            min="0"
            value="${ue(l.mixFoodAmount,y)}"
            step="0.01"
          />
          <span> ${y}</span>
        </td>
      `}else t+='<td class="na-cell">n/a</td>';l.method==="DILUTE"?t+=`
        <td class="non-editable">
          ${ue(l.mixWaterAmount,"ml")} ml
          <span style="color: var(--oit-text-secondary); font-size: 0.85rem;"> (${C(l.servings,1)} servings)</span>
        </td>
      `:t+='<td class="na-cell">n/a</td>',t+="</tr>"}t+="</tbody>",e.innerHTML=t;let s=document.querySelector(".bottom-section");if(!s.querySelector(".export-container")){let l=`
      <div class="export-container">
        <div class="export-buttons">
          <button class="btn-export" id="export-ascii">Export ASCII</button>
          <button class="btn-export" id="export-pdf">Export PDF</button>
        </div>
        <div class="custom-note-container">
          <label for="custom-note">Notes:</label>
          <textarea
            id="custom-note"
            class="custom-note-textarea"
            placeholder="Add any custom notes or instructions for this protocol..."
            rows="10"
          >${ve(Se)}</textarea>
        </div>
      </div>
    `;s.insertAdjacentHTML("afterbegin",l)}Mo(),Do(),_o()}function re(){if(!c)return;let e=an(c),t=document.querySelector(".warnings-container");if(e.length===0){t.innerHTML=`
      <div class="no-warnings">\u2713 Protocol valid. See here for the issues we check for.<br></div>
    `;return}let n=e.filter(r=>r.severity==="red"),i=e.filter(r=>r.severity==="yellow"),o="";n.length>0&&(o+=`
      <div class="warning-section red-warnings">
        <h4>Critical Issues (Red)</h4>
        <ul>
          ${n.map(r=>`<li><strong>${r.message}</strong></li>`).join("")}
        </ul>
      </div>
    `),i.length>0&&(o+=`
      <div class="warning-section yellow-warnings">
        <h4>Cautions (Yellow)</h4>
        <ul>
          ${i.map(r=>`<li>${r.message}</li>`).join("")}
        </ul>
      </div>
    `),t.innerHTML=o}function jt(e,t){if(!e.trim())return[];if(t==="protocol")return[...We.default.go(e,Et,{key:"Food",limit:50,threshold:-1e4})];{let n=We.default.go(e,Et,{key:"Food",limit:25,threshold:-1e4});return[...We.default.go(e,rn,{key:"name",limit:25,threshold:-1e4}),...n]}}function Kt(e,t,n){let o=document.getElementById(e).parentElement,r=o.querySelector(".search-dropdown");if(r&&r.remove(),t.length===0&&!n.trim())return;let s=document.createElement("div");s.className="search-dropdown",ae=-1,Ve=e;let a=document.createElement("div");a.className="search-result-item",a.setAttribute("data-index","0"),a.innerHTML=`<strong>Custom:</strong> ${ve(n||"New food")}`,a.addEventListener("click",()=>{bo(n||"New Food",e),ke(e)}),s.appendChild(a);let l=t.slice(0,50);for(let d=0;d<l.length;d++){let f=l[d],u=document.createElement("div");if(u.className="search-result-item",u.setAttribute("data-index",String(d+1)),f.obj.name)u.innerHTML=`<strong>Protocol:</strong> ${ve(f.obj.name)}`,u.addEventListener("click",()=>{Eo(f.obj),ke(e)});else{let m=f.obj;u.innerHTML=`
        ${ve(m.Food)}
        <span class="food-type"> - ${ve(m.Type)} - Protein: ${m["Mean value in 100g"].toFixed(1)} g/100 ${m.Type==="Solid"?"g":"ml"}</span>
      `,u.addEventListener("click",()=>{e==="food-a-search"?So(m):Lo(m),ke(e)})}s.appendChild(u)}o.appendChild(s)}function ke(e){let i=document.getElementById(e).parentElement.querySelector(".search-dropdown");i&&i.remove(),ae=-1,Ve=""}function lt(e){if(!Ve)return;let t=document.getElementById(Ve);if(!t)return;let i=t.parentElement.querySelector(".search-dropdown");if(!i)return;let o=Array.from(i.querySelectorAll(".search-result-item"));o.length!==0&&(ae>=0&&ae<o.length&&o[ae].classList.remove("highlighted"),e==="down"?ae=(ae+1)%o.length:ae=ae<=0?o.length-1:ae-1,o[ae].classList.add("highlighted"),o[ae].scrollIntoView({block:"nearest",behavior:"smooth"}))}function Jt(){if(!Ve||ae<0)return;let e=document.getElementById(Ve);if(!e)return;let n=e.parentElement.querySelector(".search-dropdown");if(!n)return;let i=Array.from(n.querySelectorAll(".search-result-item"));ae<i.length&&i[ae].click()}function So(e){let t={name:e.Food,type:e.Type==="Solid"?"SOLID":"LIQUID",mgPerUnit:Ge(e["Mean value in 100g"],e.Type==="Solid"?"g":"ml")};c=sn(t,$e),Le(),ct(),J(),re(),mt(),document.getElementById("food-a-search").value=""}function Lo(e){if(!c)return;let t={name:e.Food,type:e.Type==="Solid"?"SOLID":"LIQUID",mgPerUnit:Ge(e["Mean value in 100g"],e.Type==="Solid"?"g":"ml")},n={unit:t.type==="SOLID"?"g":"ml",amount:$e.DEFAULT_FOOD_B_THRESHOLD};Xe(c,t,n),Le(),J(),re(),document.getElementById("food-b-search").value=""}function bo(e,t){let n={name:e||"Custom Food",type:"SOLID",mgPerUnit:Ge(10,"g")};if(t==="food-a-search")c=sn(n,$e),Le(),ct(),J(),re(),mt();else{if(!c)return;let i={unit:"g",amount:$e.DEFAULT_FOOD_B_THRESHOLD};Xe(c,n,i),Le(),J(),re()}document.getElementById(t).value=""}function Eo(e){let t={name:e.food_a.name,type:e.food_a.type==="SOLID"?"SOLID":"LIQUID",mgPerUnit:new D(e.food_a.mgPerUnit)},n={dosingStrategy:tn[e.dosing_strategy],foodA:t,foodAStrategy:nn[e.food_a_strategy],diThreshold:new D(e.di_threshold),steps:[],config:$e};e.custom_note&&(Se=e.custom_note);let i=[];n.foodAStrategy==="DILUTE_INITIAL"?i=e.table_di:n.foodAStrategy==="DILUTE_NONE"?i=e.table_dn:n.foodAStrategy==="DILUTE_ALL"&&(i=e.table_da);for(let o=0;o<i.length;o++){let r=i[o],s={stepIndex:o+1,targetMg:new D(r.protein),method:r.method==="DILUTE"?"DILUTE":"DIRECT",dailyAmount:new D(r.daily_amount),dailyAmountUnit:r.method==="DILUTE"?"ml":r.food===t.name?t.type==="SOLID"?"g":"ml":"g",food:r.food===t.name?"A":"B"};if(r.method==="DILUTE"){s.mixFoodAmount=new D(r.mix_amount),s.mixWaterAmount=new D(r.water_amount);let a=r.food===t.name?t:n.foodB,l=s.mixFoodAmount.times(a.mgPerUnit);s.servings=l.dividedBy(s.targetMg)}n.steps.push(s)}e.food_b&&(n.foodB={name:e.food_b.name,type:e.food_b.type==="SOLID"?"SOLID":"LIQUID",mgPerUnit:new D(e.food_b.mgPerUnit)},e.food_b_threshold&&(n.foodBThreshold={unit:n.foodB.type==="SOLID"?"g":"ml",amount:new D(e.food_b_threshold)})),c=n,Le(),ct(),J(),re(),mt(),document.getElementById("food-a-search").value=""}function xo(){c&&(c.foodB=void 0,c.foodBThreshold=void 0,ut(),Le(),J(),re())}function mt(){let e=document.querySelector(".food-b-container");if(!e)return;if(c&&c.foodA){e.classList.remove("disabled");let n=document.getElementById("food-b-search"),i=document.getElementById("clear-food-b");n&&(n.disabled=!1),i&&(i.disabled=!1)}else{e.classList.add("disabled");let n=document.getElementById("food-b-search"),i=document.getElementById("clear-food-b");n&&(n.disabled=!0,n.value=""),i&&(i.disabled=!0)}}function Fo(){let e=document.getElementById("food-a-name");e&&e.addEventListener("input",s=>{c&&(c.foodA.name=s.target.value,J())});let t=document.getElementById("food-a-protein");t&&t.addEventListener("change",s=>{if(c){let a=parseFloat(s.target.value);a<0&&(a=0),a>150&&(a=150),Number.isNaN(a)&&(a=0),s.target.value=a.toFixed(1);let l=c.foodA.type==="SOLID"?"g":"ml";c.foodA.mgPerUnit=Ge(a,l),Qe()}});let n=document.getElementById("food-a-threshold");n&&n.addEventListener("change",s=>{c&&(c.diThreshold=new D(s.target.value),Qe())});let i=document.getElementById("food-b-name");i&&i.addEventListener("input",s=>{c&&c.foodB&&(c.foodB.name=s.target.value,J())});let o=document.getElementById("food-b-protein");o&&o.addEventListener("change",s=>{if(c&&c.foodB){let a=parseFloat(s.target.value);a<0&&(a=0),a>150&&(a=150),Number.isNaN(a)&&(a=0),s.target.value=a.toFixed(1);let l=c.foodB.type==="SOLID"?"g":"ml";if(c.foodB.mgPerUnit=Ge(a,l),c.foodBThreshold){let d=c.foodB,f=c.foodBThreshold;c.foodB=void 0,c.foodBThreshold=void 0,ut(),Xe(c,d,f),J(),re()}}});let r=document.getElementById("food-b-threshold");r&&r.addEventListener("change",s=>{if(c&&c.foodB&&c.foodBThreshold){c.foodBThreshold.amount=new D(s.target.value);let a=c.foodB,l=c.foodBThreshold;c.foodB=void 0,c.foodBThreshold=void 0,ut(),Xe(c,a,l),J(),re()}}),document.querySelectorAll("[data-action]").forEach(s=>{s.addEventListener("click",a=>{let l=a.target.getAttribute("data-action");if(c)switch(l){case"toggle-food-a-solid":c.foodA.type!=="SOLID"&&dt(!1);break;case"toggle-food-a-liquid":c.foodA.type!=="LIQUID"&&dt(!1);break;case"toggle-food-b-solid":c.foodB&&c.foodB.type!=="SOLID"&&dt(!0);break;case"toggle-food-b-liquid":c.foodB&&c.foodB.type!=="LIQUID"&&dt(!0);break;case"food-a-strategy-initial":c.foodAStrategy="DILUTE_INITIAL",Qe(),Le();break;case"food-a-strategy-all":c.foodAStrategy="DILUTE_ALL",Qe(),Le();break;case"food-a-strategy-none":c.foodAStrategy="DILUTE_NONE",Qe(),Le();break}})})}function Mo(){document.querySelectorAll("input.editable").forEach(e=>{e.addEventListener("blur",t=>{let n=t.target,i=parseInt(n.getAttribute("data-step")),o=n.getAttribute("data-field"),r=parseFloat(n.value);isNaN(r)||(r<0&&(r=0,n.value=r.toString()),o==="targetMg"?yo(i,r):o==="dailyAmount"?wo(i,r):o==="mixFoodAmount"&&To(i,r))}),e.addEventListener("keydown",t=>{t.key==="Enter"&&t.target.blur()})}),document.querySelectorAll(".btn-add-step").forEach(e=>{e.addEventListener("click",t=>{let n=parseInt(t.target.getAttribute("data-step"));Io(n)})}),document.querySelectorAll(".btn-remove-step").forEach(e=>{e.addEventListener("click",t=>{let n=parseInt(t.target.getAttribute("data-step"));Ao(n)})})}function Do(){let e=document.getElementById("export-ascii");e&&e.addEventListener("click",No);let t=document.getElementById("export-pdf");t&&t.addEventListener("click",Bo)}function _o(){let e=document.getElementById("custom-note");if(!e)return;e.value=Se;let t=null;e.addEventListener("input",n=>{t!==null&&clearTimeout(t),t=window.setTimeout(()=>{let i=n.target.value,o=document.createElement("div");o.textContent=i,Se=o.textContent||""},300)})}function Bo(){if(!c)return;let{jsPDF:e}=jspdf,t=new e({unit:"pt",format:"letter"}),n=40;t.setFontSize(18),t.setFont("helvetica","bold"),t.text("Oral Immunotherapy Protocol",40,n),n+=30;let i=c.foodA.type==="SOLID"?"Solid":"Liquid",o=c.foodA.type==="SOLID"?"g":"ml",r=ft(c),s=c.steps.length,a=[];for(let u=0;u<r;u++){let m=c.steps[u],y=c.foodA,F=`${ue(m.dailyAmount,m.dailyAmountUnit)} ${m.dailyAmountUnit}`,T="N/A";if(m.method==="DILUTE"){let z=y.type==="SOLID"?"g":"ml";T=`${ue(m.mixFoodAmount,z)} ${z} food + ${ue(m.mixWaterAmount,"ml")} ml water`}u===s-1?a.push([m.stepIndex,`${C(m.targetMg,1)} mg`,m.method,F,T,"Continue long term"]):a.push([m.stepIndex,`${C(m.targetMg,1)} mg`,m.method,F,T,"2-4 weeks"])}if(t.setFontSize(14),t.setFont("helvetica","bold"),t.text(`${c.foodA.name}`,40,n),n+=20,t.setFontSize(10),t.setFont("helvetica","normal"),t.text(`Protein: ${C(c.foodA.mgPerUnit.dividedBy(new D(10)),2)} g per 100 ${o} serving.`,40,n),n+=15,t.autoTable({startY:n,head:[["Step","Protein","Method","Daily Amount","How to make mix","Interval"]],body:a,theme:"grid",headStyles:{fillColor:[66,139,202],fontStyle:"bold"},margin:{left:40,right:40},styles:{fontSize:9,cellPadding:5},columnStyles:{0:{cellWidth:40},1:{cellWidth:70},2:{cellWidth:60},3:{cellWidth:90},4:{cellWidth:180},5:{cellWidth:80}}}),n=t.lastAutoTable.finalY+20,c.foodB&&r<s){let u=c.foodB.type==="SOLID"?"Solid":"Liquid",m=c.foodB.type==="SOLID"?"g":"ml",y=[];for(let F=r;F<s;F++){let T=c.steps[F],z=c.foodB,k=`${ue(T.dailyAmount,T.dailyAmountUnit)} ${T.dailyAmountUnit}`,Y="N/A";if(T.method==="DILUTE"){let N=z.type==="SOLID"?"g":"ml";Y=`${ue(T.mixFoodAmount,N)} ${N} food + ${ue(T.mixWaterAmount,"ml")} ml water`}F===s-1?y.push([T.stepIndex,`${C(T.targetMg,1)} mg`,T.method,k,Y,"Continue long term"]):y.push([T.stepIndex,`${C(T.targetMg,1)} mg`,T.method,k,Y,"2-4 weeks"])}n>650&&(t.addPage(),n=40),n+=10,t.setFontSize(14),t.setFont("helvetica","bold"),t.text(`${c.foodB.name}`,40,n),n+=20,t.setFontSize(10),t.setFont("helvetica","normal"),t.text(`Protein: ${C(c.foodB.mgPerUnit.dividedBy(new D(10)),2)} g per 100 ${m} serving`,40,n),n+=15,t.autoTable({startY:n,head:[["Step","Protein","Method","Daily Amount","How to make mix","Interval"]],body:y,theme:"grid",headStyles:{fillColor:[66,139,202],fontStyle:"bold"},margin:{left:40,right:40},styles:{fontSize:9,cellPadding:5},columnStyles:{0:{cellWidth:40},1:{cellWidth:70},2:{cellWidth:60},3:{cellWidth:90},4:{cellWidth:180},5:{cellWidth:80}}}),n=t.lastAutoTable.finalY+20}if(Se&&Se.trim()){n>650&&(t.addPage(),n=40),t.setFontSize(14),t.setFont("helvetica","bold"),t.text("Notes",40,n),n+=15,t.setFontSize(10),t.setFont("helvetica","normal");let m=t.splitTextToSize(Se.trim(),520);for(let y of m)n>730&&(t.addPage(),n=40),t.text(y,40,n),n+=14}let l=t.internal.getNumberOfPages();for(let u=1;u<=l;u++)t.setPage(u),t.setFontSize(8),t.setFont("helvetica","italic"),t.setTextColor(100),t.text("",40,760),t.text("Always verify calculations before clinical use.",40,772),t.setTextColor(0);let d=t.output("dataurlstring"),f=window.open("","_blank");f?f.document.write(`<iframe src="${d}" style="width:100%; height:100%; border:none;"></iframe>`):alert("Popup blocked. Please allow popups to view the PDF.")}function No(){if(!c)return;let e="",t="",n="",i=c.foodA.type==="SOLID"?"Solid":"Liquid",o=c.foodA.type==="SOLID"?"g":"ml";if(t+=`${c.foodA.name} (${i}). Protein: ${C(c.foodA.mgPerUnit,1)} mg/${o}`,c.foodB){let d=c.foodB.type==="SOLID"?"Solid":"Liquid",f=c.foodB.type==="SOLID"?"g":"ml";n+=`${c.foodB.name} (${d}). Protein: ${C(c.foodB.mgPerUnit,1)} mg/${f}`}let r=c.steps.length,s=ft(c),a=new AsciiTable(t),l=new AsciiTable(n);a.setHeading("Step","Protein","Method","Daily Amount","Mix Details"),l.setHeading("Step","Protein","Method","Daily Amount","Mix Details");for(let d of c.steps){let f=d.food==="B",u=f?c.foodB:c.foodA,m;f?m=l:m=a;let y=`${ue(d.dailyAmount,d.dailyAmountUnit)} ${d.dailyAmountUnit}`,F="N/A";if(d.method==="DILUTE"){let T=u.type==="SOLID"?"g":"ml";F=`${ue(d.mixFoodAmount,T)} ${T} food + ${ue(d.mixWaterAmount,"ml")} ml water`}m.addRow(d.stepIndex,`${C(d.targetMg,1)} mg`,d.method,y,F)}s>0&&(e+=a.toString()+`

`),s<r&&(e+=`--- TRANSITION TO: ---
`,e+=l.toString()+`

`),Se&&Se.trim()&&(e+=`========================================
`,e+=`NOTES
`,e+=`========================================
`,e+=`${Se.trim()}`),navigator.clipboard.writeText(e).catch(()=>{alert(`Failed to copy to clipboard. Please copy manually:

`+e)})}async function Uo(){try{Lt=await(await fetch("/tool_assets/typed_foods_rough.json")).json(),Et=Lt.map(n=>yt(vt({},n),{prepared:We.default.prepare(n.Food)})),bt=await(await fetch("/tool_assets/oit_protocols.json")).json(),rn=bt.map(n=>yt(vt({},n),{prepared:We.default.prepare(n.name)})),console.log(`Loaded ${Lt.length} foods and ${bt.length} protocols`)}catch(e){console.error("Error loading databases:",e),alert("Error loading food and protocol databases. Some features may not work.")}}async function en(){await Uo();let e=document.getElementById("food-a-search");e&&(e.addEventListener("input",i=>{let o=i.target.value;qe&&clearTimeout(qe),qe=window.setTimeout(()=>{let r=jt(o,"food");Kt("food-a-search",r,o)},150)}),e.addEventListener("keydown",i=>{var r;(r=e.parentElement)!=null&&r.querySelector(".search-dropdown")&&(i.key==="ArrowDown"?(i.preventDefault(),lt("down")):i.key==="ArrowUp"?(i.preventDefault(),lt("up")):i.key==="Enter"?(i.preventDefault(),Jt()):i.key==="Escape"&&ke("food-a-search"))}),e.addEventListener("blur",()=>{setTimeout(()=>ke("food-a-search"),200)}));let t=document.getElementById("food-b-search");t&&(t.addEventListener("input",i=>{let o=i.target.value;qe&&clearTimeout(qe),qe=window.setTimeout(()=>{let r=jt(o,"protocol");Kt("food-b-search",r,o)},150)}),t.addEventListener("keydown",i=>{var r;(r=t.parentElement)!=null&&r.querySelector(".search-dropdown")&&(i.key==="ArrowDown"?(i.preventDefault(),lt("down")):i.key==="ArrowUp"?(i.preventDefault(),lt("up")):i.key==="Enter"?(i.preventDefault(),Jt()):i.key==="Escape"&&ke("food-b-search"))}),t.addEventListener("blur",()=>{setTimeout(()=>ke("food-b-search"),200)}));let n=document.getElementById("clear-food-b");n&&n.addEventListener("click",xo),mt(),console.log("OIT Calculator initialized")}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",en):en();})();
/*! Bundled license information:

decimal.js/decimal.mjs:
  (*!
   *  decimal.js v10.6.0
   *  An arbitrary-precision Decimal type for JavaScript.
   *  https://github.com/MikeMcl/decimal.js
   *  Copyright (c) 2025 Michael Mclaughlin <M8ch88l@gmail.com>
   *  MIT Licence
   *)
*/

import{a as Qe,b as Rt}from"./chunks/chunk-Y6SLVHK3.js";var en=Qe((Kt,ct)=>{((n,e)=>{typeof define=="function"&&define.amd?define([],e):typeof ct=="object"&&ct.exports?ct.exports=e():n.fuzzysort=e()})(Kt,n=>{"use strict";var e=(p,m)=>{if(!p||!m)return K;var w=v(p);V(m)||(m=g(m));var I=w.bitflags;return(I&m._bitflags)!==I?K:T(w,m)},t=(p,m,w)=>{if(!p)return w?.all?M(m,w):yt;var I=v(p),b=I.bitflags,S=I.containsSpace,y=u(w?.threshold||0),x=w?.limit||P,E=0,C=0,B=m.length;function ce(ke){E<x?(tt.add(ke),++E):(++C,ke._score>tt.peek()._score&&tt.replaceTop(ke))}if(w?.key)for(var oe=w.key,U=0;U<B;++U){var de=m[U],H=_e(de,oe);if(H&&(V(H)||(H=g(H)),(b&H._bitflags)===b)){var k=T(I,H);k!==K&&(k._score<y||(k.obj=de,ce(k)))}}else if(w?.keys){var Oe=w.keys,we=Oe.length;e:for(var U=0;U<B;++U){var de=m[U];{for(var re=0,_=0;_<we;++_){var oe=Oe[_],H=_e(de,oe);if(!H){Be[_]=Xe;continue}V(H)||(H=g(H)),Be[_]=H,re|=H._bitflags}if((b&re)!==b)continue}if(S)for(let $=0;$<I.spaceSearches.length;$++)he[$]=pe;for(var _=0;_<we;++_){if(H=Be[_],H===Xe){Se[_]=Xe;continue}if(Se[_]=T(I,H,!1,S),Se[_]===K){Se[_]=Xe;continue}if(S)for(let W=0;W<I.spaceSearches.length;W++){if(Z[W]>-1e3&&he[W]>pe){var ee=(he[W]+Z[W])/4;ee>he[W]&&(he[W]=ee)}Z[W]>he[W]&&(he[W]=Z[W])}}if(S){for(let $=0;$<I.spaceSearches.length;$++)if(he[$]===pe)continue e}else{var N=!1;for(let $=0;$<we;$++)if(Se[$]._score!==pe){N=!0;break}if(!N)continue}var ve=new a(we);for(let $=0;$<we;$++)ve[$]=Se[$];if(S){var Y=0;for(let $=0;$<I.spaceSearches.length;$++)Y+=he[$]}else{var Y=pe;for(let W=0;W<we;W++){var k=ve[W];if(k._score>-1e3&&Y>pe){var ee=(Y+k._score)/4;ee>Y&&(Y=ee)}k._score>Y&&(Y=k._score)}}if(ve.obj=de,ve._score=Y,w?.scoreFn){if(Y=w.scoreFn(ve),!Y)continue;Y=u(Y),ve._score=Y}Y<y||ce(ve)}}else for(var U=0;U<B;++U){var H=m[U];if(H&&(V(H)||(H=g(H)),(b&H._bitflags)===b)){var k=T(I,H);k!==K&&(k._score<y||ce(k))}}if(E===0)return yt;for(var Ce=new Array(E),U=E-1;U>=0;--U)Ce[U]=tt.poll();return Ce.total=E+C,Ce},i=(p,m="<b>",w="</b>")=>{for(var I=typeof m=="function"?m:void 0,b=p.target,S=b.length,y=p.indexes,x="",E=0,C=0,B=!1,ce=[],oe=0;oe<S;++oe){var U=b[oe];if(y[C]===oe){if(++C,B||(B=!0,I?(ce.push(x),x=""):x+=m),C===y.length){I?(x+=U,ce.push(I(x,E++)),x="",ce.push(b.substr(oe+1))):x+=U+w+b.substr(oe+1);break}}else B&&(B=!1,I?(ce.push(I(x,E++)),x=""):x+=w);x+=U}return I?ce:x},o=p=>{typeof p=="number"?p=""+p:typeof p!="string"&&(p="");var m=le(p);return d(p,{_targetLower:m._lower,_targetLowerCodes:m.lowerCodes,_bitflags:m.bitflags})},r=()=>{Ne.clear(),ge.clear()};class s{get indexes(){return this._indexes.slice(0,this._indexes.len).sort((m,w)=>m-w)}set indexes(m){return this._indexes=m}highlight(m,w){return i(this,m,w)}get score(){return l(this._score)}set score(m){this._score=u(m)}}class a extends Array{get score(){return l(this._score)}set score(m){this._score=u(m)}}var d=(p,m)=>{let w=new s;return w.target=p,w.obj=m.obj??K,w._score=m._score??pe,w._indexes=m._indexes??[],w._targetLower=m._targetLower??"",w._targetLowerCodes=m._targetLowerCodes??K,w._nextBeginningIndexes=m._nextBeginningIndexes??K,w._bitflags=m._bitflags??0,w},l=p=>p===pe?0:p>1?p:Math.E**(((-p+1)**.04307-1)*-2),u=p=>p===0?pe:p>1?p:1-Math.pow(Math.log(p)/-2+1,1/.04307),c=p=>{typeof p=="number"?p=""+p:typeof p!="string"&&(p=""),p=p.trim();var m=le(p),w=[];if(m.containsSpace){var I=p.split(/\s+/);I=[...new Set(I)];for(var b=0;b<I.length;b++)if(I[b]!==""){var S=le(I[b]);w.push({lowerCodes:S.lowerCodes,_lower:I[b].toLowerCase(),containsSpace:!1})}}return{lowerCodes:m.lowerCodes,_lower:m._lower,containsSpace:m.containsSpace,bitflags:m.bitflags,spaceSearches:w}},g=p=>{if(p.length>999)return o(p);var m=Ne.get(p);return m!==void 0||(m=o(p),Ne.set(p,m)),m},v=p=>{if(p.length>999)return c(p);var m=ge.get(p);return m!==void 0||(m=c(p),ge.set(p,m)),m},M=(p,m)=>{var w=[];w.total=p.length;var I=m?.limit||P;if(m?.key)for(var b=0;b<p.length;b++){var S=p[b],y=_e(S,m.key);if(y!=K){V(y)||(y=g(y));var x=d(y.target,{_score:y._score,obj:S});if(w.push(x),w.length>=I)return w}}else if(m?.keys)for(var b=0;b<p.length;b++){for(var S=p[b],E=new a(m.keys.length),C=m.keys.length-1;C>=0;--C){var y=_e(S,m.keys[C]);if(!y){E[C]=Xe;continue}V(y)||(y=g(y)),y._score=pe,y._indexes.len=0,E[C]=y}if(E.obj=S,E._score=pe,w.push(E),w.length>=I)return w}else for(var b=0;b<p.length;b++){var y=p[b];if(y!=K&&(V(y)||(y=g(y)),y._score=pe,y._indexes.len=0,w.push(y),w.length>=I))return w}return w},T=(p,m,w=!1,I=!1)=>{if(w===!1&&p.containsSpace)return G(p,m,I);for(var b=p._lower,S=p.lowerCodes,y=S[0],x=m._targetLowerCodes,E=S.length,C=x.length,U=0,B=0,ce=0;;){var oe=y===x[B];if(oe){if(me[ce++]=B,++U,U===E)break;y=S[U]}if(++B,B>=C)return K}var U=0,de=!1,H=0,k=m._nextBeginningIndexes;k===K&&(k=m._nextBeginningIndexes=j(m.target)),B=me[0]===0?0:k[me[0]-1];var Oe=0;if(B!==C)for(;;)if(B>=C){if(U<=0||(++Oe,Oe>200))break;--U;var we=Me[--H];B=k[we]}else{var oe=S[U]===x[B];if(oe){if(Me[H++]=B,++U,U===E){de=!0;break}++B}else B=k[B]}var re=E<=1?-1:m._targetLower.indexOf(b,me[0]),_=!!~re,ee=_?re===0||m._nextBeginningIndexes[re-1]===re:!1;if(_&&!ee){for(var N=0;N<k.length;N=k[N])if(!(N<=re)){for(var ve=0;ve<E&&S[ve]===m._targetLowerCodes[N+ve];ve++);if(ve===E){re=N,ee=!0;break}}}var Y=$=>{for(var W=0,Pt=0,xe=1;xe<E;++xe)$[xe]-$[xe-1]!==1&&(W-=$[xe],++Pt);var bn=$[E-1]-$[0]-(E-1);if(W-=(12+bn)*Pt,$[0]!==0&&(W-=$[0]*$[0]*.2),!de)W*=1e3;else{for(var Tt=1,xe=k[0];xe<C;xe=k[xe])++Tt;Tt>24&&(W*=(Tt-24)*10)}return W-=(C-E)/2,_&&(W/=1+E*E*1),ee&&(W/=1+E*E*1),W-=(C-E)/2,W};if(de)if(ee){for(var N=0;N<E;++N)me[N]=re+N;var Ce=me,ke=Y(me)}else var Ce=Me,ke=Y(Me);else{if(_)for(var N=0;N<E;++N)me[N]=re+N;var Ce=me,ke=Y(Ce)}m._score=ke;for(var N=0;N<E;++N)m._indexes[N]=Ce[N];m._indexes.len=E;let nt=new s;return nt.target=m.target,nt._score=m._score,nt._indexes=m._indexes,nt},G=(p,m,w)=>{for(var I=new Set,b=0,S=K,y=0,x=p.spaceSearches,E=x.length,C=0,B=()=>{for(let ee=C-1;ee>=0;ee--)m._nextBeginningIndexes[Ie[ee*2+0]]=Ie[ee*2+1]},ce=!1,_=0;_<E;++_){Z[_]=pe;var oe=x[_];if(S=T(oe,m),w){if(S===K)continue;ce=!0}else if(S===K)return B(),K;var U=_===E-1;if(!U){var de=S._indexes,H=!0;for(let N=0;N<de.len-1;N++)if(de[N+1]-de[N]!==1){H=!1;break}if(H){var k=de[de.len-1]+1,Oe=m._nextBeginningIndexes[k-1];for(let N=k-1;N>=0&&Oe===m._nextBeginningIndexes[N];N--)m._nextBeginningIndexes[N]=k,Ie[C*2+0]=N,Ie[C*2+1]=Oe,C++}}b+=S._score/E,Z[_]=S._score/E,S._indexes[0]<y&&(b-=(y-S._indexes[0])*2),y=S._indexes[0];for(var we=0;we<S._indexes.len;++we)I.add(S._indexes[we])}if(w&&!ce)return K;B();var re=T(p,m,!0);if(re!==K&&re._score>b){if(w)for(var _=0;_<E;++_)Z[_]=re._score/E;return re}w&&(S=m),S._score=b;var _=0;for(let ee of I)S._indexes[_++]=ee;return S._indexes.len=_,S},z=p=>p.replace(/\p{Script=Latin}+/gu,m=>m.normalize("NFD")).replace(/[\u0300-\u036f]/g,""),le=p=>{p=z(p);for(var m=p.length,w=p.toLowerCase(),I=[],b=0,S=!1,y=0;y<m;++y){var x=I[y]=w.charCodeAt(y);if(x===32){S=!0;continue}var E=x>=97&&x<=122?x-97:x>=48&&x<=57?26:x<=127?30:31;b|=1<<E}return{lowerCodes:I,bitflags:b,containsSpace:S,_lower:w}},R=p=>{for(var m=p.length,w=[],I=0,b=!1,S=!1,y=0;y<m;++y){var x=p.charCodeAt(y),E=x>=65&&x<=90,C=E||x>=97&&x<=122||x>=48&&x<=57,B=E&&!b||!S||!C;b=E,S=C,B&&(w[I++]=y)}return w},j=p=>{p=z(p);for(var m=p.length,w=R(p),I=[],b=w[0],S=0,y=0;y<m;++y)b>y?I[y]=b:(b=w[++S],I[y]=b===void 0?m:b);return I},Ne=new Map,ge=new Map,me=[],Me=[],Ie=[],he=[],Z=[],Be=[],Se=[],_e=(p,m)=>{var w=p[m];if(w!==void 0)return w;if(typeof m=="function")return m(p);var I=m;Array.isArray(m)||(I=m.split("."));for(var b=I.length,S=-1;p&&++S<b;)p=p[I[S]];return p},V=p=>typeof p=="object"&&typeof p._bitflags=="number",P=1/0,pe=-P,yt=[];yt.total=0;var K=null,Xe=o(""),In=p=>{var m=[],w=0,I={},b=S=>{for(var y=0,x=m[y],E=1;E<w;){var C=E+1;y=E,C<w&&m[C]._score<m[E]._score&&(y=C),m[y-1>>1]=m[y],E=1+(y<<1)}for(var B=y-1>>1;y>0&&x._score<m[B]._score;B=(y=B)-1>>1)m[y]=m[B];m[y]=x};return I.add=(S=>{var y=w;m[w++]=S;for(var x=y-1>>1;y>0&&S._score<m[x]._score;x=(y=x)-1>>1)m[y]=m[x];m[y]=S}),I.poll=(S=>{if(w!==0){var y=m[0];return m[0]=m[--w],b(),y}}),I.peek=(S=>{if(w!==0)return m[0]}),I.replaceTop=(S=>{m[0]=S,b()}),I},tt=In();return{single:e,go:t,prepare:o,cleanup:r}})});var nn=Qe((Vi,xt)=>{"use strict";var wi=(function(){function n(e,t){var i=[],o=!0,r=!1,s=void 0;try{for(var a=e[Symbol.iterator](),d;!(o=(d=a.next()).done)&&(i.push(d.value),!(t&&i.length===t));o=!0);}catch(l){r=!0,s=l}finally{try{!o&&a.return&&a.return()}finally{if(r)throw s}}return i}return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return n(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}})(),ft="[\x1B\x9B][[()#;?]*(?:[0-9]{1,4}(?:;[0-9]{0,4})*)?[0-9A-PRZcf-nqry=><]",tn="\0-\b\v-\x1B\x9B\xAD\u200B\u2028\u2029\uFEFF\uFE00-\uFE0F",Mt=`
`+tn,yi=new RegExp("(?:"+ft+")|["+tn+"]","g"),Lt=new RegExp("(?:"+ft+")|["+Mt+"]","g"),Dt=new RegExp("((?:"+ft+")|[	"+Mt+"])?([^	"+Mt+"]*)","g");xt.exports={zeroWidthCharacters:Lt,ansiEscapeCodes:new RegExp(ft,"g"),strlen:n=>Array.from(n.replace(Lt,"")).length,isBlank:n=>n.replace(Lt,"").replace(/\s/g,"").length===0,blank:n=>Array.from(n.replace(yi,"")).map(e=>e==="	"||e===`
`?e:" ").join(""),partition(n){for(var e,t=[];Dt.lastIndex!==n.length&&(e=Dt.exec(n));)t.push([e[1]||"",e[2]]);return Dt.lastIndex=0,t},first(n,e){let t="",i=0;for(let r of xt.exports.partition(n)){var o=wi(r,2);let s=o[0],a=o[1],d=Array.from(a).slice(0,e-i);t+=s+d.join(""),i+=d.length}return t}}});var rn=Qe((Gi,on)=>{var Ti=[{name:"none",borders:{top:{left:"",center:" ",right:"",colSeparator:" "},middle:{left:"",center:" ",right:"",colSeparator:" "},bottom:{left:"",center:" ",right:"",colSeparator:" "},data:{left:"",center:" ",right:"",colSeparator:" "}}},{name:"compact",borders:{top:{left:"",center:"-",right:"",colSeparator:"-"},middle:{left:"",center:"-",right:"",colSeparator:" "},bottom:{left:"",center:"",right:"",colSeparator:""},data:{left:"",center:" ",right:"",colSeparator:" "}}},{name:"ramac",borders:{top:{left:"+",center:"-",right:"+",colSeparator:"+"},middle:{left:"+",center:"-",right:"+",colSeparator:"+"},bottom:{left:"+",center:"-",right:"+",colSeparator:"+"},data:{left:"|",center:" ",right:"|",colSeparator:"|"}}},{name:"ascii-table",borders:{top:{left:".",center:"-",right:".",colSeparator:"-"},middle:{left:"|",center:"-",right:"|",colSeparator:"-"},bottom:{left:".",center:"-",right:".",colSeparator:"-"},data:{left:"|",center:" ",right:"|",colSeparator:"|"}}},{name:"ascii-reStructuredText",borders:{top:{left:"+",center:"-",right:"+",colSeparator:"+"},middle:{left:"+",center:"=",right:"+",colSeparator:"+"},bottom:{left:"+",center:"-",right:"+",colSeparator:"+"},data:{left:"|",center:" ",right:"|",colSeparator:"|"}}},{name:"ascii-reStructuredText-simple",borders:{top:{left:"=",center:"=",right:"=",colSeparator:" "},middle:{left:"=",center:"=",right:"=",colSeparator:" "},bottom:{left:"=",center:"=",right:"=",colSeparator:" "},data:{left:" ",center:" ",right:" ",colSeparator:" "}}},{name:"ascii-dots",borders:{top:{left:".",center:".",right:".",colSeparator:"."},middle:{left:":",center:".",right:":",colSeparator:":"},bottom:{left:":",center:".",right:":",colSeparator:":"},data:{left:":",center:" ",right:":",colSeparator:":"}}},{name:"ascii-rounded",borders:{top:{left:".",center:"-",right:".",colSeparator:"."},middle:{left:":",center:"-",right:":",colSeparator:"+"},bottom:{left:"'",center:"-",right:"'",colSeparator:"'"},data:{left:"|",center:" ",right:"|",colSeparator:"|"}}},{name:"ascii-clean",borders:{top:{left:"",center:"-",right:"",colSeparator:"|"},middle:{left:"",center:"-",right:"",colSeparator:"|"},bottom:{left:"",center:"-",right:"",colSeparator:"|"},data:{left:"",center:" ",right:"",colSeparator:"|"}}},{name:"ascii-girder",borders:{top:{left:"//",center:"=",right:"\\\\",colSeparator:"[]"},middle:{left:"|]",center:"=",right:"[|",colSeparator:"[]"},bottom:{left:"\\\\",center:"=",right:"//",colSeparator:"[]"},data:{left:"||",center:" ",right:"||",colSeparator:"||"}}},{name:"unicode-single",borders:{top:{left:"\u250C",center:"\u2500",right:"\u2510",colSeparator:"\u252C"},middle:{left:"\u251C",center:"\u2500",right:"\u2524",colSeparator:"\u253C"},bottom:{left:"\u2514",center:"\u2500",right:"\u2518",colSeparator:"\u2534"},data:{left:"\u2502",center:" ",right:"\u2502",colSeparator:"\u2502"}}},{name:"unicode-double",borders:{top:{left:"\u2554",center:"\u2550",right:"\u2557",colSeparator:"\u2566"},middle:{left:"\u2560",center:"\u2550",right:"\u2563",colSeparator:"\u256C"},bottom:{left:"\u255A",center:"\u2550",right:"\u255D",colSeparator:"\u2569"},data:{left:"\u2551",center:" ",right:"\u2551",colSeparator:"\u2551"}}},{name:"unicode-mix",borders:{top:{left:"\u2554",center:"\u2550",right:"\u2557",colSeparator:"\u2564"},middle:{left:"\u255F",center:"\u2500",right:"\u2562",colSeparator:"\u253C"},bottom:{left:"\u255A",center:"\u2550",right:"\u255D",colSeparator:"\u2567"},data:{left:"\u2551",center:" ",right:"\u2551",colSeparator:"\u2502"}}},{name:"unicode-round",borders:{top:{left:"\u256D",center:"\u2500",right:"\u256E",colSeparator:"\u252C"},middle:{left:"\u251C",center:"\u2500",right:"\u2524",colSeparator:"\u253C"},bottom:{left:"\u2570",center:"\u2500",right:"\u256F",colSeparator:"\u2534"},data:{left:"\u2502",center:" ",right:"\u2502",colSeparator:"\u2502"}}},{name:"github-markdown",borders:{top:{left:"",center:"",right:"",colSeparator:""},middle:{left:"|",center:"-",right:"|",colSeparator:"|"},bottom:{left:"",center:"",right:"",colSeparator:""},data:{left:"|",center:" ",right:"|",colSeparator:"|"}}},{name:"reddit-markdown",borders:{top:{left:"",center:" ",right:"",colSeparator:" "},middle:{left:"",center:"-",right:"",colSeparator:"|"},bottom:{left:"",center:"",right:"",colSeparator:""},data:{left:"",center:" ",right:"",colSeparator:"|"}}}];on.exports={styles:Ti}});var an=Qe((Zi,sn)=>{var X={LEFT:0,RIGHT:1,CENTER:2,AUTO:3},{strlen:ae,isBlank:Si,partition:gt}=nn(),{styles:Ai}=rn(),Ft=class n{constructor(e=""){this.styles=Ai,this.clear(),this.setTitle(e)}static isNumeric(e){return!isNaN(parseFloat(e))&&isFinite(e)}static padStart(e,t,i=" "){if(ae(e)>=t)return e;{let d=gt(e);var o;if(d.length>0){for(var r=0,s=1;s<d.length;s++)r+=ae(d[s][1]);var a=d[0][1];a=i.repeat(t-r-ae(a)).concat(a),d[0][1]=a,o="",d.forEach(l=>o+=l[0]+l[1])}else o=i.repeat(t);return o}}static padEnd(e,t,i=" "){if(ae(e)>=t)return e;{let d=gt(e);var o="";if(d.length>1){for(var r=0,s=0;s<d.length-2;s++)r+=ae(d[s][1]);var a=d[d.length-2][1];a=a.concat(i.repeat(t-r-ae(a))),d[d.length-2][1]=a,d.forEach(l=>o+=l[0]+l[1])}else o=e.concat(i.repeat(t-ae(e)));return o}}static align(e,t,i,o=" "){let r=""+t;return e==X.RIGHT?n.padStart(r,i,o):e==X.LEFT?n.padEnd(r,i,o):e==X.CENTER?n.padEnd(n.padStart(r,ae(r)+Math.floor((i-ae(r))/2),o),i,o):n.alignAuto(t,i,o)}static alignLeft(e,t,i=" "){return this.align(X.LEFT,e,t,i)}static alignRight(e,t,i=" "){return this.align(X.RIGHT,e,t,i)}static alignCenter(e,t,i=" "){return this.align(X.CENTER,e,t,i)}static alignAuto(e,t,i=" "){return n.isNumeric(e)?this.alignRight(e,t,i):typeof e=="string"?this.alignLeft(e,t,i):this.alignLeft(e,t,i)}static wordWrap(e,t){let i=gt(String(e));var o="";if(i.length>1)for(var r=0;r<i.length-1;r+=2){let[s,a]=i[r],d=i[r+1][0],l=n.wordWrapBasic(a,t);o+=s+l.split(`
`).join(d+`
`+s)+d}else o=n.wordWrapBasic(e,t);return o}static wordWrapBasic(e,t){e=""+e;for(var o=!1,r="";ae(e)>t;){o=!1;for(var s=t-1;s>=0;s--)if(Si(e.charAt(s))){r+=e.substring(0,s).trimStart()+`
`,e=e.slice(s+1),o=!0;break}o||(r+=e.substring(0,t).trimStart()+`
`,e=e.slice(t))}return r+e.trimStart()}static truncateString(e,t){if(ae(e)>t){var o="",r=0;for(let[s,a]of gt(e)){let d=Array.from(a.substring(0,t-3).concat("...")).slice(0,t-r);o+=s+d.join(""),r+=d.length}return o}else return e}static arrayFill(e,t){let i=[];for(var o=0;o<e;o++)i.push(t);return i}static arrayResize(e,t,i){for(;t>e.length;)e.push(i)}setStyle(e){let t=this.styles.find(i=>i.name==e);return this.style=t||this.styles.find(i=>i.name=="ramac"),this}getStyle(){return this.style}getStyles(){return Array.from(this.styles)}addStyle(e){return this.styles.push(e),this}removeBorder(){return this.setStyle("none")}clear(){return this.setStyle("ramac"),this.setTitle(),this.setHeading(),this.clearRows(),this.setTitleAlignCenter(),this.setHeadingAlignCenter(),this.setCellMargin(1),this.dataAlign=void 0,this.colWidths=void 0,this.wrapping=void 0,this.setJustify(!1),this}clearRows(){return this.rows=[],this}setTitle(e=""){return this.title=e,this}getTitle(){return this.title?this.title:""}setTitleAlign(e){return this.titleAlignment=e,this}setTitleAlignLeft(){return this.setTitleAlign(X.LEFT)}setTitleAlignRight(){return this.setTitleAlign(X.RIGHT)}setTitleAlignCenter(){return this.setTitleAlign(X.CENTER)}getTitleAlign(){return this.titleAlignment}setHeading(...e){this.heading=n.arrayFill(e.length);for(var t=0;t<e.length;t++)this.heading[t]=e[t];return this}getHeading(){return Array.from(this.heading)}setHeadingAlign(e){return this.headingAlign=e,this}setHeadingAlignLeft(){return this.setHeadingAlign(X.LEFT)}setHeadingAlignRight(){return this.setHeadingAlign(X.RIGHT)}setHeadingAlignCenter(){return this.setHeadingAlign(X.CENTER)}getHeadingAlign(){return this.headingAlign}addRow(...e){let t=n.arrayFill(e.length);for(var i=0;i<e.length;i++)t[i]=e[i];return this.rows.push(t),this}addNonZeroRow(...e){var t=!0;let i=n.arrayFill(e.length);for(var o=0;o<e.length;o++){let r=e[o];n.isNumeric(r)&&r!=0&&(t=!1),i[o]=e[o]}return t||this.rows.push(i),this}addRowMatrix(e){return e.forEach(t=>this.rows.push(t)),this}getRows(){return Array.from(this.rows)}setCell(e,t,i){this.rows[e-1][t-1]=i}getCell(e,t){return this.getRows()[e-1][t-1]}setWidth(e,t){return this.colWidths?n.arrayResize(this.colWidths,e):this.colWidths=n.arrayFill(e),this.colWidths[e-1]=t,this}getWidth(e){var t;return this.colWidths&&e<=this.colWidths.length&&(t=this.colWidths[e-1]),t}setWidths(e){return this.colWidths=e,this}getWidths(){return this.colWidths?this.colWidths:[]}setCellMargin(e){return this.cellMargin=e,this}getCellMargin(){return this.cellMargin}setAlign(e,t){return this.dataAlign?this.dataAlign.concat(n.arrayFill(e-this.dataAlign.length,X.AUTO)):this.dataAlign=n.arrayFill(e),this.dataAlign[e-1]=t,this}getAlign(e){var t=X.AUTO;return this.dataAlign&&e<=this.dataAlign.length&&(t=this.dataAlign[e-1]),t}setAligns(e){return this.dataAlign=Array.from(e),this}getAligns(){return this.dataAlign||(this.getRows().length>0?this.dataAlign=n.arrayFill(this.getRows()[0].length,X.AUTO):this.dataAlign=[]),Array.from(this.dataAlign)}setAlignLeft(e){return this.setAlign(e,X.LEFT)}setAlignRight(e){return this.setAlign(e,X.RIGHT)}setAlignCenter(e){return this.setAlign(e,X.CENTER)}setWrapped(e,t=!0){return this.wrapping?this.wrapping.concat(n.arrayFill(e-this.wrapping.length,!1)):this.wrapping=n.arrayFill(e,!1),this.wrapping[e-1]=t,this}isWrapped(e){var t=!1;return this.wrapping&&e<=this.wrapping.length&&(t=this.wrapping[e-1]),t}setWrappings(e){return this.wrapping=Array.from(e),this}getWrappings(){return this.wrapping||(this.getRows().length>0?this.wrapping=n.arrayFill(this.getRows()[0].length,!1):this.wrapping=[]),Array.from(this.wrapping)}setJustify(e=!0){return this.justify=e,this}isJustify(){return this.justify?this.justify:!1}transpose(){if(this.getHeading().length==0&&this.getRows().length==0)return this;let e=this.getHeading().length>0?this.getHeading().length:this.getRows()[0].length,t=this.getRows().length,i=n.arrayFill(e),o=this.getHeading().length>0?1:0;for(var r=0;r<i.length;r++){i[r]=n.arrayFill(t+o),this.getHeading().length>0&&(i[r][0]=this.getHeading()[r]);for(var s=o;s<i[0].length;s++)i[r][s]=this.getCell(s+Math.abs(o-1),r+1)}return new n(this.getTitle()).setHeadingAlign(this.getHeadingAlign()).addRowMatrix(i)}toJSON(){return`{
   "title": ${JSON.stringify(this.getTitle())},
   "heading": ${JSON.stringify(this.getHeading())},
   "rows": ${JSON.stringify(this.getRows())},
   "formatting": {
       "titleAlign": ${JSON.stringify(this.getTitleAlign())},
       "headingAlign": ${JSON.stringify(this.getHeadingAlign())},
       "columns": {
           "aligns": ${JSON.stringify(this.getAligns())},
           "widths": ${JSON.stringify(this.getWidths())},
           "wrappings": ${JSON.stringify(this.getWrappings())}
       },
       "justify": ${JSON.stringify(this.isJustify())}
   }
}`}fromJSON(e){return this.clear(),this.setTitle(e.title),this.heading=Array.from(e.heading),this.addRowMatrix(e.rows),this.setTitleAlign(e.formatting.titleAlign),this.setHeadingAlign(e.formatting.headingAlign),this.setAligns(e.formatting.columns.aligns),this.setWidths(e.formatting.columns.widths),this.setWrappings(e.formatting.columns.wrappings),this.setJustify(e.formatting.justify),this}sort(e){return this.rows.sort(e),this}sortColumn(e,t=function(i,o){return i>o?1:-1}){return this.rows.sort(function(i,o){return t(i[e-1],o[e-1])}),this}sortColumnDesc(e){let t=function(i,o){return o>i?1:-1};return this.sortColumn(e,t)}getColumnsWidth(){var e;let t=this.getHeading();t.length>0?e=n.arrayFill(t.length,0):e=n.arrayFill(this.getRows()[0].length,0);for(var i=0;i<t.length;i++){let r="".padStart(this.getCellMargin())+t[i]+"".padStart(this.getCellMargin());ae(r)>e[i]&&(e[i]=ae(r))}this.getRows().forEach(r=>{for(var s=0;s<r.length;s++){let a="".padStart(this.getCellMargin())+r[s]+"".padStart(this.getCellMargin());ae(a)>e[s]&&(e[s]=ae(a))}});for(var o=0;o<e.length;o++)this.getWidth(o+1)&&(e[o]=this.getWidth(o+1));return this.isJustify()&&(e=n.arrayFill(e.length,Math.max(...e))),e}getHorizontalLine(e,t){for(var i=e.left,o=0;o<t.length;o++)i+="".padStart(t[o],e.center),o<t.length-1&&(i+=e.colSeparator);return i+=e.right,i=i.trim(),i!=""&&(i=i+`
`),i}getWrappedRows(e){let t=n.arrayFill(e.length);for(var i=1,o=0;o<e.length;o++){let l=e[o];this.getWidth(o+1)&&this.isWrapped(o+1)?(t[o]=n.wordWrap(l,this.getWidth(o+1)-this.getCellMargin()*2).split(`
`),t[o].length>i&&(i=t[o].length)):t[o]=[l]}let r=n.arrayFill(i);for(var s=0;s<i;s++)r[s]=n.arrayFill(e.length,"");for(var a=0;a<e.length;a++)for(var d=0;d<t[a].length;d++)r[d][a]=t[a][d];return r}getHeadingRowTruncated(e,t,i){for(var o=e.left,r=0;r<i.length;r++){let s=""+i[r],a=n.align(this.getHeadingAlign(),s,t[r]-this.getCellMargin()*2);o+="".padStart(this.getCellMargin())+n.truncateString(a,t[r]-this.getCellMargin()*2)+"".padStart(this.getCellMargin()),r<i.length-1&&(o+=e.colSeparator)}return o+=e.right+`
`,o}getHeadingRow(e,t){var i="";return this.getWrappedRows(this.getHeading()).forEach(r=>{i+=this.getHeadingRowTruncated(e,t,r)}),i}getDataRowTruncated(e,t,i){for(var o=e.left,r=0;r<t.length;r++){let s=""+i[r],a=n.align(this.getAlign(r+1),s,t[r]-this.getCellMargin()*2);o+="".padStart(this.getCellMargin())+n.truncateString(a,t[r]-this.getCellMargin()*2)+"".padStart(this.getCellMargin()),r<t.length-1&&(o+=e.colSeparator)}return o+=e.right+`
`,o}getDataRow(e,t,i){var o="";return this.getWrappedRows(i).forEach(s=>{o+=this.getDataRowTruncated(e,t,s)}),o}toString(){let e=this.getColumnsWidth(),t=this.getStyle(),i=e.reduce(function(r,s){return r+s},0)+(e.length-1)*ae(t.borders.data.colSeparator);var o="";if(this.getTitle().length>0){o+=t.borders.top.left+"".padStart(i,t.borders.top.center)+t.borders.top.right+`
`,o.trim()==""&&(o=""),o+=t.borders.data.left+n.align(this.getTitleAlign(),this.getTitle(),i)+t.borders.data.right+`
`;let r={left:t.borders.middle.left,right:t.borders.middle.right,center:t.borders.top.center,colSeparator:t.borders.top.colSeparator};(r.center!=""||r.colSeparator!="")&&(o+=this.getHorizontalLine(r,e))}else o+=this.getHorizontalLine(t.borders.top,e);return this.getHeading().length>0&&(o+=this.getHeadingRow(t.borders.data,e),o+=this.getHorizontalLine(t.borders.middle,e)),this.getRows().forEach(r=>{o+=this.getDataRow(t.borders.data,e,r)}),o+=this.getHorizontalLine(t.borders.bottom,e),o}};sn.exports={AsciiTable3:Ft,AlignmentEnum:X}});var dn=Qe((Yi,ln)=>{ln.exports=an()});var qe=9e15,He=1e9,St="0123456789abcdef",rt="2.3025850929940456840179914546843642076011014886287729760333279009675726096773524802359972050895982983419677840422862486334095254650828067566662873690987816894829072083255546808437998948262331985283935053089653777326288461633662222876982198867465436674744042432743651550489343149393914796194044002221051017141748003688084012647080685567743216228355220114804663715659121373450747856947683463616792101806445070648000277502684916746550586856935673420670581136429224554405758925724208241314695689016758940256776311356919292033376587141660230105703089634572075440370847469940168269282808481184289314848524948644871927809676271275775397027668605952496716674183485704422507197965004714951050492214776567636938662976979522110718264549734772662425709429322582798502585509785265383207606726317164309505995087807523710333101197857547331541421808427543863591778117054309827482385045648019095610299291824318237525357709750539565187697510374970888692180205189339507238539205144634197265287286965110862571492198849978748873771345686209167058",st="3.1415926535897932384626433832795028841971693993751058209749445923078164062862089986280348253421170679821480865132823066470938446095505822317253594081284811174502841027019385211055596446229489549303819644288109756659334461284756482337867831652712019091456485669234603486104543266482133936072602491412737245870066063155881748815209209628292540917153643678925903600113305305488204665213841469519415116094330572703657595919530921861173819326117931051185480744623799627495673518857527248912279381830119491298336733624406566430860213949463952247371907021798609437027705392171762931767523846748184676694051320005681271452635608277857713427577896091736371787214684409012249534301465495853710507922796892589235420199561121290219608640344181598136297747713099605187072113499999983729780499510597317328160963185950244594553469083026425223082533446850352619311881710100031378387528865875332083814206171776691473035982534904287554687311595628638823537875937519577818577805321712268066130019278766111959092164201989380952572010654858632789",At={precision:20,rounding:4,modulo:1,toExpNeg:-7,toExpPos:21,minE:-qe,maxE:qe,crypto:!1},Wt,Fe,F=!0,lt="[DecimalError] ",Re=lt+"Invalid argument: ",qt=lt+"Precision limit exceeded",zt=lt+"crypto unavailable",Vt="[object Decimal]",se=Math.floor,J=Math.pow,En=/^0b([01]+(\.[01]*)?|\.[01]+)(p[+-]?\d+)?$/i,Ln=/^0x([0-9a-f]+(\.[0-9a-f]*)?|\.[0-9a-f]+)(p[+-]?\d+)?$/i,Dn=/^0o([0-7]+(\.[0-7]*)?|\.[0-7]+)(p[+-]?\d+)?$/i,Gt=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,Ae=1e7,D=7,Mn=9007199254740991,xn=rt.length-1,It=st.length-1,h={toStringTag:Vt};h.absoluteValue=h.abs=function(){var n=new this.constructor(this);return n.s<0&&(n.s=1),A(n)};h.ceil=function(){return A(new this.constructor(this),this.e+1,2)};h.clampedTo=h.clamp=function(n,e){var t,i=this,o=i.constructor;if(n=new o(n),e=new o(e),!n.s||!e.s)return new o(NaN);if(n.gt(e))throw Error(Re+e);return t=i.cmp(n),t<0?n:i.cmp(e)>0?e:new o(i)};h.comparedTo=h.cmp=function(n){var e,t,i,o,r=this,s=r.d,a=(n=new r.constructor(n)).d,d=r.s,l=n.s;if(!s||!a)return!d||!l?NaN:d!==l?d:s===a?0:!s^d<0?1:-1;if(!s[0]||!a[0])return s[0]?d:a[0]?-l:0;if(d!==l)return d;if(r.e!==n.e)return r.e>n.e^d<0?1:-1;for(i=s.length,o=a.length,e=0,t=i<o?i:o;e<t;++e)if(s[e]!==a[e])return s[e]>a[e]^d<0?1:-1;return i===o?0:i>o^d<0?1:-1};h.cosine=h.cos=function(){var n,e,t=this,i=t.constructor;return t.d?t.d[0]?(n=i.precision,e=i.rounding,i.precision=n+Math.max(t.e,t.sd())+D,i.rounding=1,t=Fn(i,Qt(i,t)),i.precision=n,i.rounding=e,A(Fe==2||Fe==3?t.neg():t,n,e,!0)):new i(1):new i(NaN)};h.cubeRoot=h.cbrt=function(){var n,e,t,i,o,r,s,a,d,l,u=this,c=u.constructor;if(!u.isFinite()||u.isZero())return new c(u);for(F=!1,r=u.s*J(u.s*u,1/3),!r||Math.abs(r)==1/0?(t=te(u.d),n=u.e,(r=(n-t.length+1)%3)&&(t+=r==1||r==-2?"0":"00"),r=J(t,1/3),n=se((n+1)/3)-(n%3==(n<0?-1:2)),r==1/0?t="5e"+n:(t=r.toExponential(),t=t.slice(0,t.indexOf("e")+1)+n),i=new c(t),i.s=u.s):i=new c(r.toString()),s=(n=c.precision)+3;;)if(a=i,d=a.times(a).times(a),l=d.plus(u),i=q(l.plus(u).times(a),l.plus(d),s+2,1),te(a.d).slice(0,s)===(t=te(i.d)).slice(0,s))if(t=t.slice(s-3,s+1),t=="9999"||!o&&t=="4999"){if(!o&&(A(a,n+1,0),a.times(a).times(a).eq(u))){i=a;break}s+=4,o=1}else{(!+t||!+t.slice(1)&&t.charAt(0)=="5")&&(A(i,n+1,1),e=!i.times(i).times(i).eq(u));break}return F=!0,A(i,n,c.rounding,e)};h.decimalPlaces=h.dp=function(){var n,e=this.d,t=NaN;if(e){if(n=e.length-1,t=(n-se(this.e/D))*D,n=e[n],n)for(;n%10==0;n/=10)t--;t<0&&(t=0)}return t};h.dividedBy=h.div=function(n){return q(this,new this.constructor(n))};h.dividedToIntegerBy=h.divToInt=function(n){var e=this,t=e.constructor;return A(q(e,new t(n),0,1,1),t.precision,t.rounding)};h.equals=h.eq=function(n){return this.cmp(n)===0};h.floor=function(){return A(new this.constructor(this),this.e+1,3)};h.greaterThan=h.gt=function(n){return this.cmp(n)>0};h.greaterThanOrEqualTo=h.gte=function(n){var e=this.cmp(n);return e==1||e===0};h.hyperbolicCosine=h.cosh=function(){var n,e,t,i,o,r=this,s=r.constructor,a=new s(1);if(!r.isFinite())return new s(r.s?1/0:NaN);if(r.isZero())return a;t=s.precision,i=s.rounding,s.precision=t+Math.max(r.e,r.sd())+4,s.rounding=1,o=r.d.length,o<32?(n=Math.ceil(o/3),e=(1/ut(4,n)).toString()):(n=16,e="2.3283064365386962890625e-10"),r=ze(s,1,r.times(e),new s(1),!0);for(var d,l=n,u=new s(8);l--;)d=r.times(r),r=a.minus(d.times(u.minus(d.times(u))));return A(r,s.precision=t,s.rounding=i,!0)};h.hyperbolicSine=h.sinh=function(){var n,e,t,i,o=this,r=o.constructor;if(!o.isFinite()||o.isZero())return new r(o);if(e=r.precision,t=r.rounding,r.precision=e+Math.max(o.e,o.sd())+4,r.rounding=1,i=o.d.length,i<3)o=ze(r,2,o,o,!0);else{n=1.4*Math.sqrt(i),n=n>16?16:n|0,o=o.times(1/ut(5,n)),o=ze(r,2,o,o,!0);for(var s,a=new r(5),d=new r(16),l=new r(20);n--;)s=o.times(o),o=o.times(a.plus(s.times(d.times(s).plus(l))))}return r.precision=e,r.rounding=t,A(o,e,t,!0)};h.hyperbolicTangent=h.tanh=function(){var n,e,t=this,i=t.constructor;return t.isFinite()?t.isZero()?new i(t):(n=i.precision,e=i.rounding,i.precision=n+7,i.rounding=1,q(t.sinh(),t.cosh(),i.precision=n,i.rounding=e)):new i(t.s)};h.inverseCosine=h.acos=function(){var n=this,e=n.constructor,t=n.abs().cmp(1),i=e.precision,o=e.rounding;return t!==-1?t===0?n.isNeg()?be(e,i,o):new e(0):new e(NaN):n.isZero()?be(e,i+4,o).times(.5):(e.precision=i+6,e.rounding=1,n=new e(1).minus(n).div(n.plus(1)).sqrt().atan(),e.precision=i,e.rounding=o,n.times(2))};h.inverseHyperbolicCosine=h.acosh=function(){var n,e,t=this,i=t.constructor;return t.lte(1)?new i(t.eq(1)?0:NaN):t.isFinite()?(n=i.precision,e=i.rounding,i.precision=n+Math.max(Math.abs(t.e),t.sd())+4,i.rounding=1,F=!1,t=t.times(t).minus(1).sqrt().plus(t),F=!0,i.precision=n,i.rounding=e,t.ln()):new i(t)};h.inverseHyperbolicSine=h.asinh=function(){var n,e,t=this,i=t.constructor;return!t.isFinite()||t.isZero()?new i(t):(n=i.precision,e=i.rounding,i.precision=n+2*Math.max(Math.abs(t.e),t.sd())+6,i.rounding=1,F=!1,t=t.times(t).plus(1).sqrt().plus(t),F=!0,i.precision=n,i.rounding=e,t.ln())};h.inverseHyperbolicTangent=h.atanh=function(){var n,e,t,i,o=this,r=o.constructor;return o.isFinite()?o.e>=0?new r(o.abs().eq(1)?o.s/0:o.isZero()?o:NaN):(n=r.precision,e=r.rounding,i=o.sd(),Math.max(i,n)<2*-o.e-1?A(new r(o),n,e,!0):(r.precision=t=i-o.e,o=q(o.plus(1),new r(1).minus(o),t+n,1),r.precision=n+4,r.rounding=1,o=o.ln(),r.precision=n,r.rounding=e,o.times(.5))):new r(NaN)};h.inverseSine=h.asin=function(){var n,e,t,i,o=this,r=o.constructor;return o.isZero()?new r(o):(e=o.abs().cmp(1),t=r.precision,i=r.rounding,e!==-1?e===0?(n=be(r,t+4,i).times(.5),n.s=o.s,n):new r(NaN):(r.precision=t+6,r.rounding=1,o=o.div(new r(1).minus(o.times(o)).sqrt().plus(1)).atan(),r.precision=t,r.rounding=i,o.times(2)))};h.inverseTangent=h.atan=function(){var n,e,t,i,o,r,s,a,d,l=this,u=l.constructor,c=u.precision,g=u.rounding;if(l.isFinite()){if(l.isZero())return new u(l);if(l.abs().eq(1)&&c+4<=It)return s=be(u,c+4,g).times(.25),s.s=l.s,s}else{if(!l.s)return new u(NaN);if(c+4<=It)return s=be(u,c+4,g).times(.5),s.s=l.s,s}for(u.precision=a=c+10,u.rounding=1,t=Math.min(28,a/D+2|0),n=t;n;--n)l=l.div(l.times(l).plus(1).sqrt().plus(1));for(F=!1,e=Math.ceil(a/D),i=1,d=l.times(l),s=new u(l),o=l;n!==-1;)if(o=o.times(d),r=s.minus(o.div(i+=2)),o=o.times(d),s=r.plus(o.div(i+=2)),s.d[e]!==void 0)for(n=e;s.d[n]===r.d[n]&&n--;);return t&&(s=s.times(2<<t-1)),F=!0,A(s,u.precision=c,u.rounding=g,!0)};h.isFinite=function(){return!!this.d};h.isInteger=h.isInt=function(){return!!this.d&&se(this.e/D)>this.d.length-2};h.isNaN=function(){return!this.s};h.isNegative=h.isNeg=function(){return this.s<0};h.isPositive=h.isPos=function(){return this.s>0};h.isZero=function(){return!!this.d&&this.d[0]===0};h.lessThan=h.lt=function(n){return this.cmp(n)<0};h.lessThanOrEqualTo=h.lte=function(n){return this.cmp(n)<1};h.logarithm=h.log=function(n){var e,t,i,o,r,s,a,d,l=this,u=l.constructor,c=u.precision,g=u.rounding,v=5;if(n==null)n=new u(10),e=!0;else{if(n=new u(n),t=n.d,n.s<0||!t||!t[0]||n.eq(1))return new u(NaN);e=n.eq(10)}if(t=l.d,l.s<0||!t||!t[0]||l.eq(1))return new u(t&&!t[0]?-1/0:l.s!=1?NaN:t?0:1/0);if(e)if(t.length>1)r=!0;else{for(o=t[0];o%10===0;)o/=10;r=o!==1}if(F=!1,a=c+v,s=Pe(l,a),i=e?at(u,a+10):Pe(n,a),d=q(s,i,a,1),je(d.d,o=c,g))do if(a+=10,s=Pe(l,a),i=e?at(u,a+10):Pe(n,a),d=q(s,i,a,1),!r){+te(d.d).slice(o+1,o+15)+1==1e14&&(d=A(d,c+1,0));break}while(je(d.d,o+=10,g));return F=!0,A(d,c,g)};h.minus=h.sub=function(n){var e,t,i,o,r,s,a,d,l,u,c,g,v=this,M=v.constructor;if(n=new M(n),!v.d||!n.d)return!v.s||!n.s?n=new M(NaN):v.d?n.s=-n.s:n=new M(n.d||v.s!==n.s?v:NaN),n;if(v.s!=n.s)return n.s=-n.s,v.plus(n);if(l=v.d,g=n.d,a=M.precision,d=M.rounding,!l[0]||!g[0]){if(g[0])n.s=-n.s;else if(l[0])n=new M(v);else return new M(d===3?-0:0);return F?A(n,a,d):n}if(t=se(n.e/D),u=se(v.e/D),l=l.slice(),r=u-t,r){for(c=r<0,c?(e=l,r=-r,s=g.length):(e=g,t=u,s=l.length),i=Math.max(Math.ceil(a/D),s)+2,r>i&&(r=i,e.length=1),e.reverse(),i=r;i--;)e.push(0);e.reverse()}else{for(i=l.length,s=g.length,c=i<s,c&&(s=i),i=0;i<s;i++)if(l[i]!=g[i]){c=l[i]<g[i];break}r=0}for(c&&(e=l,l=g,g=e,n.s=-n.s),s=l.length,i=g.length-s;i>0;--i)l[s++]=0;for(i=g.length;i>r;){if(l[--i]<g[i]){for(o=i;o&&l[--o]===0;)l[o]=Ae-1;--l[o],l[i]+=Ae}l[i]-=g[i]}for(;l[--s]===0;)l.pop();for(;l[0]===0;l.shift())--t;return l[0]?(n.d=l,n.e=dt(l,t),F?A(n,a,d):n):new M(d===3?-0:0)};h.modulo=h.mod=function(n){var e,t=this,i=t.constructor;return n=new i(n),!t.d||!n.s||n.d&&!n.d[0]?new i(NaN):!n.d||t.d&&!t.d[0]?A(new i(t),i.precision,i.rounding):(F=!1,i.modulo==9?(e=q(t,n.abs(),0,3,1),e.s*=n.s):e=q(t,n,0,i.modulo,1),e=e.times(n),F=!0,t.minus(e))};h.naturalExponential=h.exp=function(){return bt(this)};h.naturalLogarithm=h.ln=function(){return Pe(this)};h.negated=h.neg=function(){var n=new this.constructor(this);return n.s=-n.s,A(n)};h.plus=h.add=function(n){var e,t,i,o,r,s,a,d,l,u,c=this,g=c.constructor;if(n=new g(n),!c.d||!n.d)return!c.s||!n.s?n=new g(NaN):c.d||(n=new g(n.d||c.s===n.s?c:NaN)),n;if(c.s!=n.s)return n.s=-n.s,c.minus(n);if(l=c.d,u=n.d,a=g.precision,d=g.rounding,!l[0]||!u[0])return u[0]||(n=new g(c)),F?A(n,a,d):n;if(r=se(c.e/D),i=se(n.e/D),l=l.slice(),o=r-i,o){for(o<0?(t=l,o=-o,s=u.length):(t=u,i=r,s=l.length),r=Math.ceil(a/D),s=r>s?r+1:s+1,o>s&&(o=s,t.length=1),t.reverse();o--;)t.push(0);t.reverse()}for(s=l.length,o=u.length,s-o<0&&(o=s,t=u,u=l,l=t),e=0;o;)e=(l[--o]=l[o]+u[o]+e)/Ae|0,l[o]%=Ae;for(e&&(l.unshift(e),++i),s=l.length;l[--s]==0;)l.pop();return n.d=l,n.e=dt(l,i),F?A(n,a,d):n};h.precision=h.sd=function(n){var e,t=this;if(n!==void 0&&n!==!!n&&n!==1&&n!==0)throw Error(Re+n);return t.d?(e=Zt(t.d),n&&t.e+1>e&&(e=t.e+1)):e=NaN,e};h.round=function(){var n=this,e=n.constructor;return A(new e(n),n.e+1,e.rounding)};h.sine=h.sin=function(){var n,e,t=this,i=t.constructor;return t.isFinite()?t.isZero()?new i(t):(n=i.precision,e=i.rounding,i.precision=n+Math.max(t.e,t.sd())+D,i.rounding=1,t=Bn(i,Qt(i,t)),i.precision=n,i.rounding=e,A(Fe>2?t.neg():t,n,e,!0)):new i(NaN)};h.squareRoot=h.sqrt=function(){var n,e,t,i,o,r,s=this,a=s.d,d=s.e,l=s.s,u=s.constructor;if(l!==1||!a||!a[0])return new u(!l||l<0&&(!a||a[0])?NaN:a?s:1/0);for(F=!1,l=Math.sqrt(+s),l==0||l==1/0?(e=te(a),(e.length+d)%2==0&&(e+="0"),l=Math.sqrt(e),d=se((d+1)/2)-(d<0||d%2),l==1/0?e="5e"+d:(e=l.toExponential(),e=e.slice(0,e.indexOf("e")+1)+d),i=new u(e)):i=new u(l.toString()),t=(d=u.precision)+3;;)if(r=i,i=r.plus(q(s,r,t+2,1)).times(.5),te(r.d).slice(0,t)===(e=te(i.d)).slice(0,t))if(e=e.slice(t-3,t+1),e=="9999"||!o&&e=="4999"){if(!o&&(A(r,d+1,0),r.times(r).eq(s))){i=r;break}t+=4,o=1}else{(!+e||!+e.slice(1)&&e.charAt(0)=="5")&&(A(i,d+1,1),n=!i.times(i).eq(s));break}return F=!0,A(i,d,u.rounding,n)};h.tangent=h.tan=function(){var n,e,t=this,i=t.constructor;return t.isFinite()?t.isZero()?new i(t):(n=i.precision,e=i.rounding,i.precision=n+10,i.rounding=1,t=t.sin(),t.s=1,t=q(t,new i(1).minus(t.times(t)).sqrt(),n+10,0),i.precision=n,i.rounding=e,A(Fe==2||Fe==4?t.neg():t,n,e,!0)):new i(NaN)};h.times=h.mul=function(n){var e,t,i,o,r,s,a,d,l,u=this,c=u.constructor,g=u.d,v=(n=new c(n)).d;if(n.s*=u.s,!g||!g[0]||!v||!v[0])return new c(!n.s||g&&!g[0]&&!v||v&&!v[0]&&!g?NaN:!g||!v?n.s/0:n.s*0);for(t=se(u.e/D)+se(n.e/D),d=g.length,l=v.length,d<l&&(r=g,g=v,v=r,s=d,d=l,l=s),r=[],s=d+l,i=s;i--;)r.push(0);for(i=l;--i>=0;){for(e=0,o=d+i;o>i;)a=r[o]+v[i]*g[o-i-1]+e,r[o--]=a%Ae|0,e=a/Ae|0;r[o]=(r[o]+e)%Ae|0}for(;!r[--s];)r.pop();return e?++t:r.shift(),n.d=r,n.e=dt(r,t),F?A(n,c.precision,c.rounding):n};h.toBinary=function(n,e){return Et(this,2,n,e)};h.toDecimalPlaces=h.toDP=function(n,e){var t=this,i=t.constructor;return t=new i(t),n===void 0?t:(fe(n,0,He),e===void 0?e=i.rounding:fe(e,0,8),A(t,n+t.e+1,e))};h.toExponential=function(n,e){var t,i=this,o=i.constructor;return n===void 0?t=Ee(i,!0):(fe(n,0,He),e===void 0?e=o.rounding:fe(e,0,8),i=A(new o(i),n+1,e),t=Ee(i,!0,n+1)),i.isNeg()&&!i.isZero()?"-"+t:t};h.toFixed=function(n,e){var t,i,o=this,r=o.constructor;return n===void 0?t=Ee(o):(fe(n,0,He),e===void 0?e=r.rounding:fe(e,0,8),i=A(new r(o),n+o.e+1,e),t=Ee(i,!1,n+i.e+1)),o.isNeg()&&!o.isZero()?"-"+t:t};h.toFraction=function(n){var e,t,i,o,r,s,a,d,l,u,c,g,v=this,M=v.d,T=v.constructor;if(!M)return new T(v);if(l=t=new T(1),i=d=new T(0),e=new T(i),r=e.e=Zt(M)-v.e-1,s=r%D,e.d[0]=J(10,s<0?D+s:s),n==null)n=r>0?e:l;else{if(a=new T(n),!a.isInt()||a.lt(l))throw Error(Re+a);n=a.gt(e)?r>0?e:l:a}for(F=!1,a=new T(te(M)),u=T.precision,T.precision=r=M.length*D*2;c=q(a,e,0,1,1),o=t.plus(c.times(i)),o.cmp(n)!=1;)t=i,i=o,o=l,l=d.plus(c.times(o)),d=o,o=e,e=a.minus(c.times(o)),a=o;return o=q(n.minus(t),i,0,1,1),d=d.plus(o.times(l)),t=t.plus(o.times(i)),d.s=l.s=v.s,g=q(l,i,r,1).minus(v).abs().cmp(q(d,t,r,1).minus(v).abs())<1?[l,i]:[d,t],T.precision=u,F=!0,g};h.toHexadecimal=h.toHex=function(n,e){return Et(this,16,n,e)};h.toNearest=function(n,e){var t=this,i=t.constructor;if(t=new i(t),n==null){if(!t.d)return t;n=new i(1),e=i.rounding}else{if(n=new i(n),e===void 0?e=i.rounding:fe(e,0,8),!t.d)return n.s?t:n;if(!n.d)return n.s&&(n.s=t.s),n}return n.d[0]?(F=!1,t=q(t,n,0,e,1).times(n),F=!0,A(t)):(n.s=t.s,t=n),t};h.toNumber=function(){return+this};h.toOctal=function(n,e){return Et(this,8,n,e)};h.toPower=h.pow=function(n){var e,t,i,o,r,s,a=this,d=a.constructor,l=+(n=new d(n));if(!a.d||!n.d||!a.d[0]||!n.d[0])return new d(J(+a,l));if(a=new d(a),a.eq(1))return a;if(i=d.precision,r=d.rounding,n.eq(1))return A(a,i,r);if(e=se(n.e/D),e>=n.d.length-1&&(t=l<0?-l:l)<=Mn)return o=Yt(d,a,t,i),n.s<0?new d(1).div(o):A(o,i,r);if(s=a.s,s<0){if(e<n.d.length-1)return new d(NaN);if((n.d[e]&1)==0&&(s=1),a.e==0&&a.d[0]==1&&a.d.length==1)return a.s=s,a}return t=J(+a,l),e=t==0||!isFinite(t)?se(l*(Math.log("0."+te(a.d))/Math.LN10+a.e+1)):new d(t+"").e,e>d.maxE+1||e<d.minE-1?new d(e>0?s/0:0):(F=!1,d.rounding=a.s=1,t=Math.min(12,(e+"").length),o=bt(n.times(Pe(a,i+t)),i),o.d&&(o=A(o,i+5,1),je(o.d,i,r)&&(e=i+10,o=A(bt(n.times(Pe(a,e+t)),e),e+5,1),+te(o.d).slice(i+1,i+15)+1==1e14&&(o=A(o,i+1,0)))),o.s=s,F=!0,d.rounding=r,A(o,i,r))};h.toPrecision=function(n,e){var t,i=this,o=i.constructor;return n===void 0?t=Ee(i,i.e<=o.toExpNeg||i.e>=o.toExpPos):(fe(n,1,He),e===void 0?e=o.rounding:fe(e,0,8),i=A(new o(i),n,e),t=Ee(i,n<=i.e||i.e<=o.toExpNeg,n)),i.isNeg()&&!i.isZero()?"-"+t:t};h.toSignificantDigits=h.toSD=function(n,e){var t=this,i=t.constructor;return n===void 0?(n=i.precision,e=i.rounding):(fe(n,1,He),e===void 0?e=i.rounding:fe(e,0,8)),A(new i(t),n,e)};h.toString=function(){var n=this,e=n.constructor,t=Ee(n,n.e<=e.toExpNeg||n.e>=e.toExpPos);return n.isNeg()&&!n.isZero()?"-"+t:t};h.truncated=h.trunc=function(){return A(new this.constructor(this),this.e+1,1)};h.valueOf=h.toJSON=function(){var n=this,e=n.constructor,t=Ee(n,n.e<=e.toExpNeg||n.e>=e.toExpPos);return n.isNeg()?"-"+t:t};function te(n){var e,t,i,o=n.length-1,r="",s=n[0];if(o>0){for(r+=s,e=1;e<o;e++)i=n[e]+"",t=D-i.length,t&&(r+=Ue(t)),r+=i;s=n[e],i=s+"",t=D-i.length,t&&(r+=Ue(t))}else if(s===0)return"0";for(;s%10===0;)s/=10;return r+s}function fe(n,e,t){if(n!==~~n||n<e||n>t)throw Error(Re+n)}function je(n,e,t,i){var o,r,s,a;for(r=n[0];r>=10;r/=10)--e;return--e<0?(e+=D,o=0):(o=Math.ceil((e+1)/D),e%=D),r=J(10,D-e),a=n[o]%r|0,i==null?e<3?(e==0?a=a/100|0:e==1&&(a=a/10|0),s=t<4&&a==99999||t>3&&a==49999||a==5e4||a==0):s=(t<4&&a+1==r||t>3&&a+1==r/2)&&(n[o+1]/r/100|0)==J(10,e-2)-1||(a==r/2||a==0)&&(n[o+1]/r/100|0)==0:e<4?(e==0?a=a/1e3|0:e==1?a=a/100|0:e==2&&(a=a/10|0),s=(i||t<4)&&a==9999||!i&&t>3&&a==4999):s=((i||t<4)&&a+1==r||!i&&t>3&&a+1==r/2)&&(n[o+1]/r/1e3|0)==J(10,e-3)-1,s}function it(n,e,t){for(var i,o=[0],r,s=0,a=n.length;s<a;){for(r=o.length;r--;)o[r]*=e;for(o[0]+=St.indexOf(n.charAt(s++)),i=0;i<o.length;i++)o[i]>t-1&&(o[i+1]===void 0&&(o[i+1]=0),o[i+1]+=o[i]/t|0,o[i]%=t)}return o.reverse()}function Fn(n,e){var t,i,o;if(e.isZero())return e;i=e.d.length,i<32?(t=Math.ceil(i/3),o=(1/ut(4,t)).toString()):(t=16,o="2.3283064365386962890625e-10"),n.precision+=t,e=ze(n,1,e.times(o),new n(1));for(var r=t;r--;){var s=e.times(e);e=s.times(s).minus(s).times(8).plus(1)}return n.precision-=t,e}var q=(function(){function n(i,o,r){var s,a=0,d=i.length;for(i=i.slice();d--;)s=i[d]*o+a,i[d]=s%r|0,a=s/r|0;return a&&i.unshift(a),i}function e(i,o,r,s){var a,d;if(r!=s)d=r>s?1:-1;else for(a=d=0;a<r;a++)if(i[a]!=o[a]){d=i[a]>o[a]?1:-1;break}return d}function t(i,o,r,s){for(var a=0;r--;)i[r]-=a,a=i[r]<o[r]?1:0,i[r]=a*s+i[r]-o[r];for(;!i[0]&&i.length>1;)i.shift()}return function(i,o,r,s,a,d){var l,u,c,g,v,M,T,G,z,le,R,j,Ne,ge,me,Me,Ie,he,Z,Be,Se=i.constructor,_e=i.s==o.s?1:-1,V=i.d,P=o.d;if(!V||!V[0]||!P||!P[0])return new Se(!i.s||!o.s||(V?P&&V[0]==P[0]:!P)?NaN:V&&V[0]==0||!P?_e*0:_e/0);for(d?(v=1,u=i.e-o.e):(d=Ae,v=D,u=se(i.e/v)-se(o.e/v)),Z=P.length,Ie=V.length,z=new Se(_e),le=z.d=[],c=0;P[c]==(V[c]||0);c++);if(P[c]>(V[c]||0)&&u--,r==null?(ge=r=Se.precision,s=Se.rounding):a?ge=r+(i.e-o.e)+1:ge=r,ge<0)le.push(1),M=!0;else{if(ge=ge/v+2|0,c=0,Z==1){for(g=0,P=P[0],ge++;(c<Ie||g)&&ge--;c++)me=g*d+(V[c]||0),le[c]=me/P|0,g=me%P|0;M=g||c<Ie}else{for(g=d/(P[0]+1)|0,g>1&&(P=n(P,g,d),V=n(V,g,d),Z=P.length,Ie=V.length),Me=Z,R=V.slice(0,Z),j=R.length;j<Z;)R[j++]=0;Be=P.slice(),Be.unshift(0),he=P[0],P[1]>=d/2&&++he;do g=0,l=e(P,R,Z,j),l<0?(Ne=R[0],Z!=j&&(Ne=Ne*d+(R[1]||0)),g=Ne/he|0,g>1?(g>=d&&(g=d-1),T=n(P,g,d),G=T.length,j=R.length,l=e(T,R,G,j),l==1&&(g--,t(T,Z<G?Be:P,G,d))):(g==0&&(l=g=1),T=P.slice()),G=T.length,G<j&&T.unshift(0),t(R,T,j,d),l==-1&&(j=R.length,l=e(P,R,Z,j),l<1&&(g++,t(R,Z<j?Be:P,j,d))),j=R.length):l===0&&(g++,R=[0]),le[c++]=g,l&&R[0]?R[j++]=V[Me]||0:(R=[V[Me]],j=1);while((Me++<Ie||R[0]!==void 0)&&ge--);M=R[0]!==void 0}le[0]||le.shift()}if(v==1)z.e=u,Wt=M;else{for(c=1,g=le[0];g>=10;g/=10)c++;z.e=c+u*v-1,A(z,a?r+z.e+1:r,s,M)}return z}})();function A(n,e,t,i){var o,r,s,a,d,l,u,c,g,v=n.constructor;e:if(e!=null){if(c=n.d,!c)return n;for(o=1,a=c[0];a>=10;a/=10)o++;if(r=e-o,r<0)r+=D,s=e,u=c[g=0],d=u/J(10,o-s-1)%10|0;else if(g=Math.ceil((r+1)/D),a=c.length,g>=a)if(i){for(;a++<=g;)c.push(0);u=d=0,o=1,r%=D,s=r-D+1}else break e;else{for(u=a=c[g],o=1;a>=10;a/=10)o++;r%=D,s=r-D+o,d=s<0?0:u/J(10,o-s-1)%10|0}if(i=i||e<0||c[g+1]!==void 0||(s<0?u:u%J(10,o-s-1)),l=t<4?(d||i)&&(t==0||t==(n.s<0?3:2)):d>5||d==5&&(t==4||i||t==6&&(r>0?s>0?u/J(10,o-s):0:c[g-1])%10&1||t==(n.s<0?8:7)),e<1||!c[0])return c.length=0,l?(e-=n.e+1,c[0]=J(10,(D-e%D)%D),n.e=-e||0):c[0]=n.e=0,n;if(r==0?(c.length=g,a=1,g--):(c.length=g+1,a=J(10,D-r),c[g]=s>0?(u/J(10,o-s)%J(10,s)|0)*a:0),l)for(;;)if(g==0){for(r=1,s=c[0];s>=10;s/=10)r++;for(s=c[0]+=a,a=1;s>=10;s/=10)a++;r!=a&&(n.e++,c[0]==Ae&&(c[0]=1));break}else{if(c[g]+=a,c[g]!=Ae)break;c[g--]=0,a=1}for(r=c.length;c[--r]===0;)c.pop()}return F&&(n.e>v.maxE?(n.d=null,n.e=NaN):n.e<v.minE&&(n.e=0,n.d=[0])),n}function Ee(n,e,t){if(!n.isFinite())return Xt(n);var i,o=n.e,r=te(n.d),s=r.length;return e?(t&&(i=t-s)>0?r=r.charAt(0)+"."+r.slice(1)+Ue(i):s>1&&(r=r.charAt(0)+"."+r.slice(1)),r=r+(n.e<0?"e":"e+")+n.e):o<0?(r="0."+Ue(-o-1)+r,t&&(i=t-s)>0&&(r+=Ue(i))):o>=s?(r+=Ue(o+1-s),t&&(i=t-o-1)>0&&(r=r+"."+Ue(i))):((i=o+1)<s&&(r=r.slice(0,i)+"."+r.slice(i)),t&&(i=t-s)>0&&(o+1===s&&(r+="."),r+=Ue(i))),r}function dt(n,e){var t=n[0];for(e*=D;t>=10;t/=10)e++;return e}function at(n,e,t){if(e>xn)throw F=!0,t&&(n.precision=t),Error(qt);return A(new n(rt),e,1,!0)}function be(n,e,t){if(e>It)throw Error(qt);return A(new n(st),e,t,!0)}function Zt(n){var e=n.length-1,t=e*D+1;if(e=n[e],e){for(;e%10==0;e/=10)t--;for(e=n[0];e>=10;e/=10)t++}return t}function Ue(n){for(var e="";n--;)e+="0";return e}function Yt(n,e,t,i){var o,r=new n(1),s=Math.ceil(i/D+4);for(F=!1;;){if(t%2&&(r=r.times(e),$t(r.d,s)&&(o=!0)),t=se(t/2),t===0){t=r.d.length-1,o&&r.d[t]===0&&++r.d[t];break}e=e.times(e),$t(e.d,s)}return F=!0,r}function Ht(n){return n.d[n.d.length-1]&1}function Jt(n,e,t){for(var i,o,r=new n(e[0]),s=0;++s<e.length;){if(o=new n(e[s]),!o.s){r=o;break}i=r.cmp(o),(i===t||i===0&&r.s===t)&&(r=o)}return r}function bt(n,e){var t,i,o,r,s,a,d,l=0,u=0,c=0,g=n.constructor,v=g.rounding,M=g.precision;if(!n.d||!n.d[0]||n.e>17)return new g(n.d?n.d[0]?n.s<0?0:1/0:1:n.s?n.s<0?0:n:NaN);for(e==null?(F=!1,d=M):d=e,a=new g(.03125);n.e>-2;)n=n.times(a),c+=5;for(i=Math.log(J(2,c))/Math.LN10*2+5|0,d+=i,t=r=s=new g(1),g.precision=d;;){if(r=A(r.times(n),d,1),t=t.times(++u),a=s.plus(q(r,t,d,1)),te(a.d).slice(0,d)===te(s.d).slice(0,d)){for(o=c;o--;)s=A(s.times(s),d,1);if(e==null)if(l<3&&je(s.d,d-i,v,l))g.precision=d+=10,t=r=a=new g(1),u=0,l++;else return A(s,g.precision=M,v,F=!0);else return g.precision=M,s}s=a}}function Pe(n,e){var t,i,o,r,s,a,d,l,u,c,g,v=1,M=10,T=n,G=T.d,z=T.constructor,le=z.rounding,R=z.precision;if(T.s<0||!G||!G[0]||!T.e&&G[0]==1&&G.length==1)return new z(G&&!G[0]?-1/0:T.s!=1?NaN:G?0:T);if(e==null?(F=!1,u=R):u=e,z.precision=u+=M,t=te(G),i=t.charAt(0),Math.abs(r=T.e)<15e14){for(;i<7&&i!=1||i==1&&t.charAt(1)>3;)T=T.times(n),t=te(T.d),i=t.charAt(0),v++;r=T.e,i>1?(T=new z("0."+t),r++):T=new z(i+"."+t.slice(1))}else return l=at(z,u+2,R).times(r+""),T=Pe(new z(i+"."+t.slice(1)),u-M).plus(l),z.precision=R,e==null?A(T,R,le,F=!0):T;for(c=T,d=s=T=q(T.minus(1),T.plus(1),u,1),g=A(T.times(T),u,1),o=3;;){if(s=A(s.times(g),u,1),l=d.plus(q(s,new z(o),u,1)),te(l.d).slice(0,u)===te(d.d).slice(0,u))if(d=d.times(2),r!==0&&(d=d.plus(at(z,u+2,R).times(r+""))),d=q(d,new z(v),u,1),e==null)if(je(d.d,u-M,le,a))z.precision=u+=M,l=s=T=q(c.minus(1),c.plus(1),u,1),g=A(T.times(T),u,1),o=a=1;else return A(d,z.precision=R,le,F=!0);else return z.precision=R,d;d=l,o+=2}}function Xt(n){return String(n.s*n.s/0)}function ot(n,e){var t,i,o;for((t=e.indexOf("."))>-1&&(e=e.replace(".","")),(i=e.search(/e/i))>0?(t<0&&(t=i),t+=+e.slice(i+1),e=e.substring(0,i)):t<0&&(t=e.length),i=0;e.charCodeAt(i)===48;i++);for(o=e.length;e.charCodeAt(o-1)===48;--o);if(e=e.slice(i,o),e){if(o-=i,n.e=t=t-i-1,n.d=[],i=(t+1)%D,t<0&&(i+=D),i<o){for(i&&n.d.push(+e.slice(0,i)),o-=D;i<o;)n.d.push(+e.slice(i,i+=D));e=e.slice(i),i=D-e.length}else i-=o;for(;i--;)e+="0";n.d.push(+e),F&&(n.e>n.constructor.maxE?(n.d=null,n.e=NaN):n.e<n.constructor.minE&&(n.e=0,n.d=[0]))}else n.e=0,n.d=[0];return n}function Nn(n,e){var t,i,o,r,s,a,d,l,u;if(e.indexOf("_")>-1){if(e=e.replace(/(\d)_(?=\d)/g,"$1"),Gt.test(e))return ot(n,e)}else if(e==="Infinity"||e==="NaN")return+e||(n.s=NaN),n.e=NaN,n.d=null,n;if(Ln.test(e))t=16,e=e.toLowerCase();else if(En.test(e))t=2;else if(Dn.test(e))t=8;else throw Error(Re+e);for(r=e.search(/p/i),r>0?(d=+e.slice(r+1),e=e.substring(2,r)):e=e.slice(2),r=e.indexOf("."),s=r>=0,i=n.constructor,s&&(e=e.replace(".",""),a=e.length,r=a-r,o=Yt(i,new i(t),r,r*2)),l=it(e,t,Ae),u=l.length-1,r=u;l[r]===0;--r)l.pop();return r<0?new i(n.s*0):(n.e=dt(l,u),n.d=l,F=!1,s&&(n=q(n,o,a*4)),d&&(n=n.times(Math.abs(d)<54?J(2,d):Ke.pow(2,d))),F=!0,n)}function Bn(n,e){var t,i=e.d.length;if(i<3)return e.isZero()?e:ze(n,2,e,e);t=1.4*Math.sqrt(i),t=t>16?16:t|0,e=e.times(1/ut(5,t)),e=ze(n,2,e,e);for(var o,r=new n(5),s=new n(16),a=new n(20);t--;)o=e.times(e),e=e.times(r.plus(o.times(s.times(o).minus(a))));return e}function ze(n,e,t,i,o){var r,s,a,d,l=1,u=n.precision,c=Math.ceil(u/D);for(F=!1,d=t.times(t),a=new n(i);;){if(s=q(a.times(d),new n(e++*e++),u,1),a=o?i.plus(s):i.minus(s),i=q(s.times(d),new n(e++*e++),u,1),s=a.plus(i),s.d[c]!==void 0){for(r=c;s.d[r]===a.d[r]&&r--;);if(r==-1)break}r=a,a=i,i=s,s=r,l++}return F=!0,s.d.length=c+1,s}function ut(n,e){for(var t=n;--e;)t*=n;return t}function Qt(n,e){var t,i=e.s<0,o=be(n,n.precision,1),r=o.times(.5);if(e=e.abs(),e.lte(r))return Fe=i?4:1,e;if(t=e.divToInt(o),t.isZero())Fe=i?3:2;else{if(e=e.minus(t.times(o)),e.lte(r))return Fe=Ht(t)?i?2:3:i?4:1,e;Fe=Ht(t)?i?1:4:i?3:2}return e.minus(o).abs()}function Et(n,e,t,i){var o,r,s,a,d,l,u,c,g,v=n.constructor,M=t!==void 0;if(M?(fe(t,1,He),i===void 0?i=v.rounding:fe(i,0,8)):(t=v.precision,i=v.rounding),!n.isFinite())u=Xt(n);else{for(u=Ee(n),s=u.indexOf("."),M?(o=2,e==16?t=t*4-3:e==8&&(t=t*3-2)):o=e,s>=0&&(u=u.replace(".",""),g=new v(1),g.e=u.length-s,g.d=it(Ee(g),10,o),g.e=g.d.length),c=it(u,10,o),r=d=c.length;c[--d]==0;)c.pop();if(!c[0])u=M?"0p+0":"0";else{if(s<0?r--:(n=new v(n),n.d=c,n.e=r,n=q(n,g,t,i,0,o),c=n.d,r=n.e,l=Wt),s=c[t],a=o/2,l=l||c[t+1]!==void 0,l=i<4?(s!==void 0||l)&&(i===0||i===(n.s<0?3:2)):s>a||s===a&&(i===4||l||i===6&&c[t-1]&1||i===(n.s<0?8:7)),c.length=t,l)for(;++c[--t]>o-1;)c[t]=0,t||(++r,c.unshift(1));for(d=c.length;!c[d-1];--d);for(s=0,u="";s<d;s++)u+=St.charAt(c[s]);if(M){if(d>1)if(e==16||e==8){for(s=e==16?4:3,--d;d%s;d++)u+="0";for(c=it(u,o,e),d=c.length;!c[d-1];--d);for(s=1,u="1.";s<d;s++)u+=St.charAt(c[s])}else u=u.charAt(0)+"."+u.slice(1);u=u+(r<0?"p":"p+")+r}else if(r<0){for(;++r;)u="0"+u;u="0."+u}else if(++r>d)for(r-=d;r--;)u+="0";else r<d&&(u=u.slice(0,r)+"."+u.slice(r))}u=(e==16?"0x":e==2?"0b":e==8?"0o":"")+u}return n.s<0?"-"+u:u}function $t(n,e){if(n.length>e)return n.length=e,!0}function _n(n){return new this(n).abs()}function On(n){return new this(n).acos()}function Cn(n){return new this(n).acosh()}function Un(n,e){return new this(n).plus(e)}function Pn(n){return new this(n).asin()}function Rn(n){return new this(n).asinh()}function Hn(n){return new this(n).atan()}function $n(n){return new this(n).atanh()}function kn(n,e){n=new this(n),e=new this(e);var t,i=this.precision,o=this.rounding,r=i+4;return!n.s||!e.s?t=new this(NaN):!n.d&&!e.d?(t=be(this,r,1).times(e.s>0?.25:.75),t.s=n.s):!e.d||n.isZero()?(t=e.s<0?be(this,i,o):new this(0),t.s=n.s):!n.d||e.isZero()?(t=be(this,r,1).times(.5),t.s=n.s):e.s<0?(this.precision=r,this.rounding=1,t=this.atan(q(n,e,r,1)),e=be(this,r,1),this.precision=i,this.rounding=o,t=n.s<0?t.minus(e):t.plus(e)):t=this.atan(q(n,e,r,1)),t}function Wn(n){return new this(n).cbrt()}function qn(n){return A(n=new this(n),n.e+1,2)}function zn(n,e,t){return new this(n).clamp(e,t)}function Vn(n){if(!n||typeof n!="object")throw Error(lt+"Object expected");var e,t,i,o=n.defaults===!0,r=["precision",1,He,"rounding",0,8,"toExpNeg",-qe,0,"toExpPos",0,qe,"maxE",0,qe,"minE",-qe,0,"modulo",0,9];for(e=0;e<r.length;e+=3)if(t=r[e],o&&(this[t]=At[t]),(i=n[t])!==void 0)if(se(i)===i&&i>=r[e+1]&&i<=r[e+2])this[t]=i;else throw Error(Re+t+": "+i);if(t="crypto",o&&(this[t]=At[t]),(i=n[t])!==void 0)if(i===!0||i===!1||i===0||i===1)if(i)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))this[t]=!0;else throw Error(zt);else this[t]=!1;else throw Error(Re+t+": "+i);return this}function Gn(n){return new this(n).cos()}function Zn(n){return new this(n).cosh()}function jt(n){var e,t,i;function o(r){var s,a,d,l=this;if(!(l instanceof o))return new o(r);if(l.constructor=o,kt(r)){l.s=r.s,F?!r.d||r.e>o.maxE?(l.e=NaN,l.d=null):r.e<o.minE?(l.e=0,l.d=[0]):(l.e=r.e,l.d=r.d.slice()):(l.e=r.e,l.d=r.d?r.d.slice():r.d);return}if(d=typeof r,d==="number"){if(r===0){l.s=1/r<0?-1:1,l.e=0,l.d=[0];return}if(r<0?(r=-r,l.s=-1):l.s=1,r===~~r&&r<1e7){for(s=0,a=r;a>=10;a/=10)s++;F?s>o.maxE?(l.e=NaN,l.d=null):s<o.minE?(l.e=0,l.d=[0]):(l.e=s,l.d=[r]):(l.e=s,l.d=[r]);return}if(r*0!==0){r||(l.s=NaN),l.e=NaN,l.d=null;return}return ot(l,r.toString())}if(d==="string")return(a=r.charCodeAt(0))===45?(r=r.slice(1),l.s=-1):(a===43&&(r=r.slice(1)),l.s=1),Gt.test(r)?ot(l,r):Nn(l,r);if(d==="bigint")return r<0?(r=-r,l.s=-1):l.s=1,ot(l,r.toString());throw Error(Re+r)}if(o.prototype=h,o.ROUND_UP=0,o.ROUND_DOWN=1,o.ROUND_CEIL=2,o.ROUND_FLOOR=3,o.ROUND_HALF_UP=4,o.ROUND_HALF_DOWN=5,o.ROUND_HALF_EVEN=6,o.ROUND_HALF_CEIL=7,o.ROUND_HALF_FLOOR=8,o.EUCLID=9,o.config=o.set=Vn,o.clone=jt,o.isDecimal=kt,o.abs=_n,o.acos=On,o.acosh=Cn,o.add=Un,o.asin=Pn,o.asinh=Rn,o.atan=Hn,o.atanh=$n,o.atan2=kn,o.cbrt=Wn,o.ceil=qn,o.clamp=zn,o.cos=Gn,o.cosh=Zn,o.div=Yn,o.exp=Jn,o.floor=Xn,o.hypot=Qn,o.ln=jn,o.log=Kn,o.log10=ti,o.log2=ei,o.max=ni,o.min=ii,o.mod=oi,o.mul=ri,o.pow=si,o.random=ai,o.round=li,o.sign=di,o.sin=ui,o.sinh=ci,o.sqrt=fi,o.sub=gi,o.sum=mi,o.tan=hi,o.tanh=pi,o.trunc=vi,n===void 0&&(n={}),n&&n.defaults!==!0)for(i=["precision","rounding","toExpNeg","toExpPos","maxE","minE","modulo","crypto"],e=0;e<i.length;)n.hasOwnProperty(t=i[e++])||(n[t]=this[t]);return o.config(n),o}function Yn(n,e){return new this(n).div(e)}function Jn(n){return new this(n).exp()}function Xn(n){return A(n=new this(n),n.e+1,3)}function Qn(){var n,e,t=new this(0);for(F=!1,n=0;n<arguments.length;)if(e=new this(arguments[n++]),e.d)t.d&&(t=t.plus(e.times(e)));else{if(e.s)return F=!0,new this(1/0);t=e}return F=!0,t.sqrt()}function kt(n){return n instanceof Ke||n&&n.toStringTag===Vt||!1}function jn(n){return new this(n).ln()}function Kn(n,e){return new this(n).log(e)}function ei(n){return new this(n).log(2)}function ti(n){return new this(n).log(10)}function ni(){return Jt(this,arguments,-1)}function ii(){return Jt(this,arguments,1)}function oi(n,e){return new this(n).mod(e)}function ri(n,e){return new this(n).mul(e)}function si(n,e){return new this(n).pow(e)}function ai(n){var e,t,i,o,r=0,s=new this(1),a=[];if(n===void 0?n=this.precision:fe(n,1,He),i=Math.ceil(n/D),this.crypto)if(crypto.getRandomValues)for(e=crypto.getRandomValues(new Uint32Array(i));r<i;)o=e[r],o>=429e7?e[r]=crypto.getRandomValues(new Uint32Array(1))[0]:a[r++]=o%1e7;else if(crypto.randomBytes){for(e=crypto.randomBytes(i*=4);r<i;)o=e[r]+(e[r+1]<<8)+(e[r+2]<<16)+((e[r+3]&127)<<24),o>=214e7?crypto.randomBytes(4).copy(e,r):(a.push(o%1e7),r+=4);r=i/4}else throw Error(zt);else for(;r<i;)a[r++]=Math.random()*1e7|0;for(i=a[--r],n%=D,i&&n&&(o=J(10,D-n),a[r]=(i/o|0)*o);a[r]===0;r--)a.pop();if(r<0)t=0,a=[0];else{for(t=-1;a[0]===0;t-=D)a.shift();for(i=1,o=a[0];o>=10;o/=10)i++;i<D&&(t-=D-i)}return s.e=t,s.d=a,s}function li(n){return A(n=new this(n),n.e+1,this.rounding)}function di(n){return n=new this(n),n.d?n.d[0]?n.s:0*n.s:n.s||NaN}function ui(n){return new this(n).sin()}function ci(n){return new this(n).sinh()}function fi(n){return new this(n).sqrt()}function gi(n,e){return new this(n).sub(e)}function mi(){var n=0,e=arguments,t=new this(e[n]);for(F=!1;t.s&&++n<e.length;)t=t.plus(e[n]);return F=!0,A(t,this.precision,this.rounding)}function hi(n){return new this(n).tan()}function pi(n){return new this(n).tanh()}function vi(n){return A(n=new this(n),n.e+1,1)}h[Symbol.for("nodejs.util.inspect.custom")]=h.toString;h[Symbol.toStringTag]="Decimal";var Ke=h.constructor=jt(At);rt=new Ke(rt);st=new Ke(st);var L=Ke;var Ze=Rt(en()),Bt=Rt(dn());L.set({precision:20,rounding:L.ROUND_HALF_UP});var hn=(t=>(t.STANDARD="STANDARD",t.SLOW="SLOW",t))(hn||{});var pn=(i=>(i.DILUTE_INITIAL="DILUTE_INITIAL",i.DILUTE_ALL="DILUTE_ALL",i.DILUTE_NONE="DILUTE_NONE",i))(pn||{}),vt=2,$e=1,vn={STANDARD:[1,2.5,5,10,20,40,80,120,160,240,300].map(n=>new L(n)),SLOW:[.5,1,1.5,2.5,5,10,20,30,40,60,80,100,120,140,160,190,220,260,300].map(n=>new L(n))},Ii=[.2,.25,.3,.35,.4,.45,.5,1,2,5,10,12,14,16,18,20,25,30].map(n=>new L(n)),bi=[.5,1,1.5,2,2.5,3,3.5,4,4.5,5,6,7,8,9,10,14,16,18,20,25,30].map(n=>new L(n)),Ei=[.5,1,1.5,2,2.5,3,4,5,7,9,10,11,12].map(n=>new L(n)),un=new L(500),ye;ye={minMeasurableMass:new L(.2),minMeasurableVolume:new L(.2),minServingsForMix:new L(3),PROTEIN_TOLERANCE:new L(.05),DEFAULT_FOOD_A_DILUTION_THRESHOLD:new L(.2),DEFAULT_FOOD_B_THRESHOLD:new L(.2),MAX_SOLID_CONCENTRATION:new L(.05)};var f=null,Nt=[],_t=[],wn=[],Le="",yn="",Ve=null,ue=-1,Je="";function Te(n){return n.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}function O(n,e){return n==null?"":(typeof n=="number"?n:n.toNumber()).toFixed(e)}function ne(n,e){if(n==null)return"";let t=typeof n=="number"?n:n.toNumber();return e==="g"?t.toFixed(vt):t%1===0?t.toFixed(0):t.toFixed($e)}function mt(n){return n.type==="LIQUID"?"ml":"g"}function Li(n,e,t){let i=[],o=e.type==="SOLID"?Ii:bi,r=e.type==="SOLID"?n.dividedBy(t.MAX_SOLID_CONCENTRATION.times(e.getMgPerUnit())):null;for(let s of o){let a=s;for(let d of Ei){let l=d;if(e.type==="SOLID"){let u=a.times(e.getMgPerUnit()),c=u.dividedBy(n);if(c.lessThan(t.minServingsForMix))continue;let g=l.times(c),v=g;if(a.lessThan(t.minMeasurableMass)||l.lessThan(t.minMeasurableVolume)||v.greaterThan(un)||v.lessThan(t.minMeasurableVolume)||u.dividedBy(g).times(l).dividedBy(n).minus(1).abs().greaterThan(t.PROTEIN_TOLERANCE))continue;i.push({mixFoodAmount:a,mixWaterAmount:v,dailyAmount:l,mixTotalVolume:g,servings:c})}else{let u=a.times(e.getMgPerUnit()),c=u.dividedBy(n);if(c.lessThan(t.minServingsForMix))continue;let g=l.times(c),v=g.minus(a);if(v.lessThan(0)||a.lessThan(t.minMeasurableVolume)||l.lessThan(t.minMeasurableVolume)||v.greaterThan(un)||v.lessThan(t.minMeasurableVolume)||u.dividedBy(g).times(l).dividedBy(n).minus(1).abs().greaterThan(t.PROTEIN_TOLERANCE))continue;i.push({mixFoodAmount:a,mixWaterAmount:v,dailyAmount:l,mixTotalVolume:g,servings:c})}}}return i.sort((s,a)=>{if(e.type==="SOLID"&&r){let l=s.dailyAmount.greaterThanOrEqualTo(r),u=a.dailyAmount.greaterThanOrEqualTo(r);if(l&&!u)return-1;if(!l&&u)return 1}let d=s.mixFoodAmount.comparedTo(a.mixFoodAmount);return d!==0||(d=s.dailyAmount.comparedTo(a.dailyAmount),d!==0)||(d=s.mixTotalVolume.comparedTo(a.mixTotalVolume),d!==0)?d:s.mixWaterAmount.comparedTo(a.mixWaterAmount)}),i}function Ot(n,e,t,i,o,r){let s=n,a=s.dividedBy(t.getMgPerUnit()),d=t.type==="SOLID"?"g":"ml",l=!1;if(i==="DILUTE_INITIAL"?l=a.lessThan(o):i==="DILUTE_ALL"?l=!0:l=!1,l){let u=Li(s,t,r);if(u.length===0)return null;let c=u[0];return{stepIndex:e,targetMg:s,method:"DILUTE",dailyAmount:c.dailyAmount,dailyAmountUnit:"ml",mixFoodAmount:c.mixFoodAmount,mixWaterAmount:c.mixWaterAmount,servings:c.servings,food:"A"}}else return{stepIndex:e,targetMg:s,method:"DIRECT",dailyAmount:a,dailyAmountUnit:d,food:"A"}}function Tn(n,e){let t="STANDARD",i="DILUTE_INITIAL",o=n.type==="SOLID"?"g":"ml",r=ye.DEFAULT_FOOD_A_DILUTION_THRESHOLD,s=vn[t],a=[];for(let d=0;d<s.length;d++){let l=Ot(s[d],d+1,n,i,r,e);if(l)a.push(l);else{let u=s[d],c=u.dividedBy(n.getMgPerUnit());a.push({stepIndex:d+1,targetMg:u,method:"DIRECT",dailyAmount:c,dailyAmountUnit:o,food:"A"})}}return{dosingStrategy:t,foodA:n,foodAStrategy:i,diThreshold:r,steps:a,config:e}}function Sn(n){if(!n.foodB)return n.steps.length;for(let e=0;e<n.steps.length;e++)if(n.steps[e].food==="B")return e;return n.steps.length}function Ye(n,e,t){let i=t.amount.times(e.getMgPerUnit());n.foodB=e,n.foodBThreshold=t;let o=-1;for(let c=0;c<n.steps.length;c++)if(n.steps[c].targetMg.greaterThanOrEqualTo(i)){o=c;break}if(o===-1)return;let r=[];for(let c=o+1;c<n.steps.length;c++)r.push(n.steps[c].targetMg);let s=n.steps[o].targetMg,a=[],d=e.type==="SOLID"?"g":"ml",l=s,u=l.dividedBy(e.getMgPerUnit());a.push({stepIndex:o+2,targetMg:l,method:"DIRECT",dailyAmount:u,dailyAmountUnit:d,food:"B"});for(let c of r){let g=c.dividedBy(e.getMgPerUnit());a.push({stepIndex:0,targetMg:c,method:"DIRECT",dailyAmount:g,dailyAmountUnit:d,food:"B"})}n.steps=n.steps.slice(0,o+1),n.steps.push(...a);for(let c=0;c<n.steps.length;c++)n.steps[c].stepIndex=c+1}function An(n){let e=[];if(n.steps.length<5&&e.push({severity:"red",code:"R1",message:"Protocol < 5 steps, which is quite rapid for a full OIT protocol."}),n.foodA.getMgPerUnit().lessThanOrEqualTo(new L(0))&&e.push({severity:"red",code:"R7",message:`${Te(n.foodA.name)} protein concentration must be > 0 to be considered for OIT`}),n.foodB?.getMgPerUnit().lessThanOrEqualTo(new L(0))&&e.push({severity:"red",code:"R7",message:`${Te(n.foodB?.name||"")} protein concentration must be > 0 to be considered for OIT`}),n.foodB){let t=!1;for(let i of n.steps)i.food==="B"&&(t=!0);t===!1&&e.push({severity:"yellow",code:"Y5",message:`${Te(n.foodB.name)} has no transition point. Decrease the threshold if you want to transition.`})}for(let t of n.steps){let o=t.food==="B"?n.foodB:n.foodA;if(t.targetMg.lessThanOrEqualTo(new L(0))&&e.push({severity:"red",code:"R8",message:`Step ${t.stepIndex}: A target protein of ${O(t.targetMg,1)} mg is NOT valid. It must be >0.`,stepIndex:t.stepIndex}),t.method==="DILUTE"){let r=mt(o),s=new L(ne(t.mixFoodAmount,r)),a=new L(ne(t.mixWaterAmount,"ml")),d=new L(ne(t.dailyAmount,"ml")),l=s.times(o.getMgPerUnit()),u=o.type==="SOLID"?a:s.plus(a);u.isZero()&&(u=new L(1),console.log("mixTotalVolumeBasedOnRounded is 0",u));let c=l.times(d).dividedBy(u);if(!t.targetMg.isZero()){let v=c.dividedBy(t.targetMg).minus(1).abs();v.greaterThan(ye.PROTEIN_TOLERANCE)&&e.push({severity:"red",code:"R2",message:`Step ${t.stepIndex}: Protein mismatch. Target ${O(t.targetMg,1)} mg but calculated ${O(c,1)} mg: ${O(v.times(100),0)}% difference.`,stepIndex:t.stepIndex})}if(t.servings.lessThan(new L(1))){let v=t.mixFoodAmount.times(o.getMgPerUnit());e.push({severity:"red",code:"R5",message:`Step ${t.stepIndex}: ${ne(t.mixFoodAmount,mt(o))} ${mt(o)} of food only makes ${O(v,1)} mg of total protein. However, target protein is ${O(t.targetMg,1)} mg.`,stepIndex:t.stepIndex})}let g=o.type==="SOLID"?t.mixWaterAmount:t.mixFoodAmount.plus(t.mixWaterAmount);g.lessThan(t.dailyAmount)&&e.push({severity:"red",code:"R6",message:`Step ${t.stepIndex}: Total volume of dilution is ${O(g,$e)} ml; however, daily amount is ${O(t.dailyAmount,$e)} ml, which is impossible`,stepIndex:t.stepIndex}),t.dailyAmount.lessThanOrEqualTo(0)&&e.push({severity:"red",code:"R9",message:`Step ${t.stepIndex}: Daily amount cannot be <= 0 ml`,stepIndex:t.stepIndex}),t.mixFoodAmount.lessThanOrEqualTo(0)&&e.push({severity:"red",code:"R9",message:`Step ${t.stepIndex}: Amount of food to mix cannot be <= 0 ${mt(o)}`,stepIndex:t.stepIndex}),t.mixWaterAmount.lessThan(0)&&e.push({severity:"red",code:"R9",message:`Step ${t.stepIndex}: Amount of water to mix cannot be < 0 ml`,stepIndex:t.stepIndex}),o.type==="SOLID"&&s.lessThan(n.config.minMeasurableMass)&&e.push({severity:"yellow",code:"Y3",message:`Step ${t.stepIndex}: Measuring ${O(t.mixFoodAmount,vt)} g of food is impractical. Aim for value \u2265 ${n.config.minMeasurableMass} g`,stepIndex:t.stepIndex}),o.type==="LIQUID"&&s.lessThan(n.config.minMeasurableVolume)&&e.push({severity:"yellow",code:"Y3",message:`Step ${t.stepIndex}: Measuring ${O(t.mixFoodAmount,$e)} ml of food is impractical. Aim for value \u2265 ${n.config.minMeasurableVolume} ml`,stepIndex:t.stepIndex}),d.lessThan(n.config.minMeasurableVolume)&&e.push({severity:"yellow",code:"Y3",message:`Step ${t.stepIndex}: Measuring a daily amount of ${O(t.dailyAmount,$e)} ml is impractical. Aim for value \u2265 ${n.config.minMeasurableVolume} ml`,stepIndex:t.stepIndex}),a.lessThan(n.config.minMeasurableVolume)&&e.push({severity:"yellow",code:"Y3",message:`Step ${t.stepIndex}: Measuring ${O(t.mixWaterAmount,$e)} ml of water is impractical. Aim for value \u2265 ${n.config.minMeasurableVolume} ml`,stepIndex:t.stepIndex}),t.servings.lessThan(n.config.minServingsForMix)&&t.servings.greaterThan(new L(1))&&e.push({severity:"yellow",code:"Y1",message:`Step ${t.stepIndex}: Only ${O(t.servings,1)} servings (< ${ye.minServingsForMix} - impractical). Consider increasing mix amounts.`,stepIndex:t.stepIndex}),o.type==="SOLID"&&t.mixFoodAmount.dividedBy(t.mixWaterAmount).greaterThan(new L(ye.MAX_SOLID_CONCENTRATION))&&e.push({severity:"yellow",code:"Y4",message:`Step ${t.stepIndex}: at ${O(t.mixFoodAmount,vt)} g of food in ${O(t.mixWaterAmount,$e)} ml of water, the w/v is > ${O(ye.MAX_SOLID_CONCENTRATION.times(100),0)}%. The assumption that the food contributes non-negligibly to the total volume of dilution is likely violated. Consider increasing the Daily Amount`,stepIndex:t.stepIndex})}else if(t.method==="DIRECT"){let r=t.dailyAmountUnit,s=new L(ne(t.dailyAmount,r)),a=s.times(o.getMgPerUnit());if(!t.targetMg.isZero()){let d=a.dividedBy(t.targetMg).minus(1).abs();d.greaterThan(ye.PROTEIN_TOLERANCE)&&e.push({severity:"red",code:"R2",message:`Step ${t.stepIndex}: Protein mismatch. Target ${O(t.targetMg,1)} mg but calculated ${O(a,1)} mg: ${O(d.times(100),0)}% difference.`,stepIndex:t.stepIndex})}o.type==="SOLID"&&s.lessThan(n.config.minMeasurableMass)&&e.push({severity:"yellow",code:"Y3",message:`Step ${t.stepIndex}: Measuring ${O(t.dailyAmount,vt)} g of food is impractical. Aim for \u2265 ${n.config.minMeasurableMass} g`,stepIndex:t.stepIndex}),o.type==="LIQUID"&&s.lessThan(n.config.minMeasurableVolume)&&e.push({severity:"yellow",code:"Y3",message:`Step ${t.stepIndex}: Measuring ${O(t.dailyAmount,$e)} ml of food is impractical. Aim for \u2265 ${n.config.minMeasurableVolume} ml`,stepIndex:t.stepIndex})}}for(let t=1;t<n.steps.length;t++)n.steps[t].targetMg.lessThan(n.steps[t-1].targetMg)&&e.push({severity:"yellow",code:"Y2",message:`Steps must be ascending or equal \u2014 check step ${n.steps[t].stepIndex} vs step ${n.steps[t-1].stepIndex}.`,stepIndex:n.steps[t].stepIndex});return e}function et(){if(!f)return;let n=vn[f.dosingStrategy],e=[];for(let t=0;t<n.length;t++){let i=Ot(n[t],t+1,f.foodA,f.foodAStrategy,f.diThreshold,f.config);i&&e.push(i)}f.steps=e,f.foodB&&f.foodBThreshold&&Ye(f,f.foodB,f.foodBThreshold),Q(),ie()}function Ge(){if(!f)return;let n=f.steps.map(i=>i.targetMg),e=f.steps.map(i=>i.food),t=[];for(let i=0;i<n.length;i++){let o=n[i],r=e[i]==="B",s=r?f.foodB:f.foodA,a=r?"DILUTE_NONE":f.foodAStrategy,d=Ot(o,i+1,s,a,f.diThreshold,f.config);d&&(d.food=e[i],t.push(d))}f.steps=t,Q(),ie()}function Di(n,e){if(!f)return;let t=f.steps[n-1];if(!t)return;try{t.targetMg=new L(e)}catch{console.error("Invalid number format for targetMg:",e);return}let o=t.food==="B"?f.foodB:f.foodA;if(t.method==="DIRECT")t.dailyAmount=t.targetMg.dividedBy(o.getMgPerUnit());else{let r=t.mixFoodAmount.times(o.getMgPerUnit());if(t.servings=r.dividedBy(t.targetMg),o.type==="SOLID"){let s=t.dailyAmount.times(t.servings);t.mixWaterAmount=s}else{let s=t.dailyAmount.times(t.servings);t.mixWaterAmount=s.minus(t.mixFoodAmount)}}Q(),ie()}function Mi(n,e){if(!f)return;let t=f.steps[n-1];if(!t)return;t.dailyAmount=new L(e);let o=t.food==="B"?f.foodB:f.foodA;if(t.method==="DIRECT")t.targetMg=t.dailyAmount.times(o.getMgPerUnit());else{let r=t.mixFoodAmount.times(o.getMgPerUnit());if(t.servings=r.dividedBy(t.targetMg),o.type==="SOLID"){let s=t.dailyAmount.times(t.servings);t.mixWaterAmount=s}else{let s=t.dailyAmount.times(t.servings);t.mixWaterAmount=s.minus(t.mixFoodAmount)}}Q(),ie()}function xi(n,e){if(!f)return;let t=f.steps[n-1];if(!t||t.method!=="DILUTE")return;t.mixFoodAmount=new L(e);let o=t.food==="B"?f.foodB:f.foodA,r=t.mixFoodAmount.times(o.getMgPerUnit());if(t.servings=r.dividedBy(t.targetMg),o.type==="SOLID"){let s=t.dailyAmount.times(t.servings);t.mixWaterAmount=s}else{let s=t.dailyAmount.times(t.servings);t.mixWaterAmount=s.minus(t.mixFoodAmount)}Q(),ie()}function Fi(n){if(!f)return;let e=f.steps[n-1];if(!e)return;let t={stepIndex:e.stepIndex+1,targetMg:e.targetMg,method:e.method,dailyAmount:e.dailyAmount,dailyAmountUnit:e.dailyAmountUnit,food:e.food};e.method==="DILUTE"&&(t.mixFoodAmount=e.mixFoodAmount,t.mixWaterAmount=e.mixWaterAmount,t.servings=e.servings),f.steps.splice(n,0,t);for(let i=0;i<f.steps.length;i++)f.steps[i].stepIndex=i+1;Q(),ie()}function Ni(n){if(f&&!(f.steps.length<=1)){f.steps.splice(n-1,1);for(let e=0;e<f.steps.length;e++)f.steps[e].stepIndex=e+1;Q(),ie()}}function ht(n){if(!f)return;let e=n?f.foodB:f.foodA;e.type=e.type==="SOLID"?"LIQUID":"SOLID";for(let t of f.steps)if(t.food==="B"===n)if(t.method==="DILUTE"){t.dailyAmountUnit="ml";let o=t.mixFoodAmount.times(e.getMgPerUnit());if(t.servings=o.dividedBy(t.targetMg),e.type==="SOLID"){let r=t.dailyAmount.times(t.servings);t.mixWaterAmount=r}else{let r=t.dailyAmount.times(t.servings);t.mixWaterAmount=r.minus(t.mixFoodAmount)}}else t.dailyAmountUnit=e.type==="SOLID"?"g":"ml";De(),Q(),ie()}function Ct(){let n=document.querySelector(".dosing-strategy-container"),e=document.querySelector(".warnings-container");n&&n.classList.remove("oit-hidden-on-init"),e&&e.classList.remove("oit-hidden-on-init")}function De(){if(!f)return;let n=document.querySelector(".food-a-container"),e=document.querySelector(".food-b-container"),t=`
    <div class="food-a-settings">
      <input
        type="text"
        class="food-name-input"
        id="food-a-name"
        value="${Te(f.foodA.name)}"
      />
      <div class="setting-row">
        <label>Protein:</label>
      <div class="input-unit-group">
        <input
          type="number"
          min="0"
          max="${f.foodA.servingSize}"
          id="food-a-protein"
          value="${f.foodA.gramsInServing.toFixed(1)}"
          step="0.1"
        />
        <span>g per</span>
        <input
          type="number"
          min="0"
          id="food-a-serving-size"
          value="${f.foodA.servingSize.toFixed(1)}"
          step="0.1"
        />
        <span>${f.foodA.type==="SOLID"?"g":"ml"}</span>
      </div>
      </div>
      <div class="setting-row">
        <label>Form:</label>
        <div class="toggle-group">
          <button class="toggle-btn ${f.foodA.type==="SOLID"?"active":""}" data-action="toggle-food-a-solid">Solid</button>
          <button class="toggle-btn ${f.foodA.type==="LIQUID"?"active":""}" data-action="toggle-food-a-liquid">Liquid</button>
        </div>
      </div>
      <div class="setting-row">
        <label>Dilution strategy:</label>
        <div class="toggle-group">
          <button class="toggle-btn ${f.foodAStrategy==="DILUTE_INITIAL"?"active":""}" data-action="food-a-strategy-initial">Initial dilution</button>
          <button class="toggle-btn ${f.foodAStrategy==="DILUTE_ALL"?"active":""}" data-action="food-a-strategy-all">Dilution throughout</button>
          <button class="toggle-btn ${f.foodAStrategy==="DILUTE_NONE"?"active":""}" data-action="food-a-strategy-none">No dilutions</button>
        </div>
      </div>
      ${f.foodAStrategy==="DILUTE_INITIAL"?`
      <div class="setting-row threshold-setting">
        <label>Directly dose when neat amount \u2265</label>
        <div class="input-unit-group">
          <input
            type="number"
            id="food-a-threshold"
            min="0"
            value="${ne(f.diThreshold,f.foodA.type==="SOLID"?"g":"ml")}"
            step="0.1"
          />
          <span>${f.foodA.type==="SOLID"?"g":"ml"}</span>
        </div>
      </div>
      `:""}
    </div>
  `,i=n.querySelector(".food-a-settings");if(i?i.outerHTML=t:n.insertAdjacentHTML("beforeend",t),f.foodB){let o=`
      <div class="food-b-settings">
        <input
          type="text"
          class="food-name-input"
          id="food-b-name"
          value="${Te(f.foodB.name)}"
        />
        <div class="setting-row">
          <label>Protein:</label>
          <div class="input-unit-group">
            <input
              type="number"
              id="food-b-protein"
              min="0"
              max="${f.foodB.servingSize}"
              value="${f.foodB.gramsInServing.toFixed(1)}"
              step="0.1"
            />
            <span>g per</span>
            <input
              type="number"
              id="food-b-serving-size"
              min="0"
              value="${f.foodB.servingSize.toFixed(1)}"
              step="0.1"
            />
            <span>${f.foodB.type==="SOLID"?"g":"ml"}</span>
          </div>
        </div>
        <div class="setting-row">
          <label>Form:</label>
          <div class="toggle-group">
            <button class="toggle-btn ${f.foodB.type==="SOLID"?"active":""}" data-action="toggle-food-b-solid">Solid</button>
            <button class="toggle-btn ${f.foodB.type==="LIQUID"?"active":""}" data-action="toggle-food-b-liquid">Liquid</button>
          </div>
        </div>
        <div class="setting-row threshold-setting">
          <label>Transition when daily amount \u2265</label>
          <div class="input-unit-group">
            <input
              type="number"
              id="food-b-threshold"
              value="${ne(f.foodBThreshold.amount,f.foodBThreshold.unit)}"
              step="0.1"
              min="0"
            />
            <span>${f.foodBThreshold.unit}</span>
          </div>
        </div>
      </div>
    `,r=e.querySelector(".food-b-settings");r?r.outerHTML=o:e.insertAdjacentHTML("beforeend",o)}else{let o=e.querySelector(".food-b-settings");o&&o.remove()}Pi()}function wt(){if(!f)return;let n=document.querySelector(".dosing-strategy-container"),e=`
    <h3>Dosing Strategy (resets all steps on change)</h3>
    <div class="setting-row">
      <div class="toggle-group">
        <button class="toggle-btn ${f.dosingStrategy==="STANDARD"?"active":""}" data-strategy="STANDARD">Standard</button>
        <button class="toggle-btn ${f.dosingStrategy==="SLOW"?"active":""}" data-strategy="SLOW">Slow</button>
      </div>
    </div>
  `;n.innerHTML=e,n.querySelectorAll("[data-strategy]").forEach(t=>{t.addEventListener("click",i=>{let o=i.target.getAttribute("data-strategy");f&&o!==f.dosingStrategy&&(f.dosingStrategy=o,et(),wt())})})}function Q(){if(!f)return;let n=document.querySelector(".output-container table"),e=`
    <thead>
      <tr>
        <th>Step</th>
        <th>Protein (mg)</th>
        <th>Method</th>
        <th>Amount for mixture</th>
        <th>Water for mixture</th>
        <th>Daily amount</th>
      </tr>
    </thead>
    <tbody>
  `,t=!0,i=An(f),o=new Map;for(let a of i)if(a.stepIndex!==void 0){let d=o.get(a.stepIndex);(!d||a.severity==="red"&&d==="yellow")&&o.set(a.stepIndex,a.severity)}for(let a of f.steps){let d=a.food==="B",l=d?f.foodB:f.foodA;d&&t?(e+=`
        <tr class="food-section-header">
          <td colspan="6">${Te(f.foodB.name)}</td>
        </tr>
      `,t=!1):!d&&a.stepIndex===1&&(e+=`
        <tr class="food-section-header">
          <td colspan="6">${Te(f.foodA.name)}</td>
        </tr>
      `);let u=o.get(a.stepIndex),c=u?`warning-highlight-${u}`:"";if(e+=`<tr class="${c}">`,e+=`
      <td>
        <div class="actions-cell">
          <button class="btn-add-step" data-step="${a.stepIndex}">+</button>
          <button class="btn-remove-step" data-step="${a.stepIndex}">\u2212</button>
          <span class="step-number">${a.stepIndex}</span>
        </div>
      </td>
    `,e+=`
      <td>
        <input
          class="editable"
          type="number"
          data-step="${a.stepIndex}"
          data-field="targetMg"
          value="${O(a.targetMg,1)}"
          step="0.1"
          min="0"
        />
      </td>
    `,e+=`
      <td class="method-cell">${a.method}</td>
    `,a.method==="DILUTE"){let g=l.type==="SOLID"?"g":"ml";e+=`
        <td>
          <input
            class="editable"
            type="number"
            data-step="${a.stepIndex}"
            data-field="mixFoodAmount"
            min="0"
            value="${ne(a.mixFoodAmount,g)}"
            step="0.01"
          />
          <span> ${g}</span>
        </td>
      `}else e+='<td class="na-cell">n/a</td>';a.method==="DILUTE"?e+=`
        <td class="non-editable">
          ${ne(a.mixWaterAmount,"ml")} ml
          <span style="color: var(--oit-text-secondary); font-size: 0.85rem;"> (${O(a.servings,1)} servings)</span>
        </td>
      `:e+='<td class="na-cell">n/a</td>',e+=`
      <td>
        <input
          class="editable"
          type="number"
          data-step="${a.stepIndex}"
          data-field="dailyAmount"
          value="${ne(a.dailyAmount,a.dailyAmountUnit)}"
          step="0.1"
          min="0"
        />
        <span> ${a.dailyAmountUnit}</span>
      </td>
    `,e+="</tr>"}e+="</tbody>",n.innerHTML=e;let r=document.querySelector(".bottom-section");if(!r.querySelector(".export-container")){let a=`
      <div class="export-container">
        <div class="export-buttons">
          <button class="btn-export" id="export-ascii">Copy ASCII</button>
          <button class="btn-export" id="export-pdf">Export PDF</button>
        </div>
        <div class="custom-note-container">
          <label for="custom-note">Notes:</label>
          <textarea
            id="custom-note"
            class="custom-note-textarea"
            placeholder="Add any custom notes or instructions ..."
            rows="8"
          >${Te(Le)}</textarea>
        </div>
      </div>
    `;r.insertAdjacentHTML("afterbegin",a),Hi(),$i()}Ri()}function ie(){if(!f)return;let n=An(f),e=document.querySelector(".warnings-container");if(n.length===0){e.innerHTML=`
      <div class="no-warnings">
      \u2713 Protocol passes internal checks: see <a href="${yn}" target="_blank"> here </a> for the issues we check for.<br><br>THIS DOES NOT GUARANTEE THE PROTOCOL IS SAFE.
      </div>
    `;return}let t=n.filter(r=>r.severity==="red"),i=n.filter(r=>r.severity==="yellow"),o="";t.length>0&&(o+=`
      <div class="warning-section red-warnings">
        <h4>Critical Issues (Red)</h4>
        <ul>
          ${t.map(r=>`<li><strong>${r.message}</strong></li>`).join("")}
        </ul>
      </div>
    `),i.length>0&&(o+=`
      <div class="warning-section yellow-warnings">
        <h4>Cautions (Yellow)</h4>
        <ul>
          ${i.map(r=>`<li>${r.message}</li>`).join("")}
        </ul>
      </div>
    `),e.innerHTML=o}function cn(n,e){if(!n.trim())return[];if(e==="food")return[...Ze.default.go(n,_t,{key:"prepared",limit:50,threshold:-1e4})];{let t=Ze.default.go(n,_t,{key:"prepared",limit:25,threshold:-1e4});return[...Ze.default.go(n,wn,{key:"prepared",limit:25,threshold:-1e4}),...t]}}function fn(n,e,t){let o=document.getElementById(n).parentElement,r=o.querySelector(".search-dropdown");if(r&&r.remove(),e.length===0&&!t.trim())return;let s=document.createElement("div");s.className="search-dropdown",ue=-1,Je=n;let a=document.createElement("div");a.className="search-result-item",a.setAttribute("data-index","0"),a.innerHTML=`<strong>Custom:</strong> ${Te(t||"New food")}`,a.addEventListener("click",()=>{Oi(t||"New Food",n),We(n)}),s.appendChild(a);let d=e.slice(0,50);for(let l=0;l<d.length;l++){let u=d[l],c=document.createElement("div");if(c.className="search-result-item",c.setAttribute("data-index",String(l+1)),u.obj.name)c.innerHTML=`<strong>Protocol:</strong> ${Te(u.obj.name)}`,c.addEventListener("click",()=>{Ci(u.obj),We(n)});else{let g=u.obj;c.innerHTML=`
        ${Te(g.Food)}
        <span class="food-type"> - ${Te(g.Type)} - Protein: ${g["Mean protein in grams"].toFixed(1)} g/${g["Serving size"]} ${g.Type==="Solid"?"g":"ml"}</span>
      `,c.addEventListener("click",()=>{n==="food-a-search"?Bi(g):_i(g),We(n)})}s.appendChild(c)}o.appendChild(s)}function We(n){let i=document.getElementById(n).parentElement.querySelector(".search-dropdown");i&&i.remove(),ue=-1,Je=""}function pt(n){if(!Je)return;let e=document.getElementById(Je);if(!e)return;let i=e.parentElement.querySelector(".search-dropdown");if(!i)return;let o=Array.from(i.querySelectorAll(".search-result-item"));o.length!==0&&(ue>=0&&ue<o.length&&o[ue].classList.remove("highlighted"),n==="down"?ue=(ue+1)%o.length:ue=ue<=0?o.length-1:ue-1,o[ue].classList.add("highlighted"),o[ue].scrollIntoView({block:"nearest",behavior:"smooth"}))}function gn(){if(!Je||ue<0)return;let n=document.getElementById(Je);if(!n)return;let t=n.parentElement.querySelector(".search-dropdown");if(!t)return;let i=Array.from(t.querySelectorAll(".search-result-item"));ue<i.length&&i[ue].click()}function Bi(n){let e={name:n.Food,type:n.Type==="Solid"?"SOLID":"LIQUID",gramsInServing:new L(n["Mean protein in grams"]),servingSize:new L(n["Serving size"]),getMgPerUnit:function(){return this.gramsInServing.times(1e3).dividedBy(this.servingSize)}};f=Tn(e,ye),Ct(),De(),wt(),Q(),ie(),Ut(),document.getElementById("food-a-search").value=""}function _i(n){if(!f)return;let e={name:n.Food,type:n.Type==="Solid"?"SOLID":"LIQUID",gramsInServing:new L(n["Mean protein in grams"]),servingSize:new L(n["Serving size"]),getMgPerUnit:function(){return this.gramsInServing.times(1e3).dividedBy(this.servingSize)}},t={unit:e.type==="SOLID"?"g":"ml",amount:ye.DEFAULT_FOOD_B_THRESHOLD};Ye(f,e,t),De(),Q(),ie(),document.getElementById("food-b-search").value=""}function Oi(n,e){let t={name:n||"Custom Food",type:"SOLID",gramsInServing:new L(10),servingSize:new L(100),getMgPerUnit:function(){return this.gramsInServing.times(1e3).dividedBy(this.servingSize)}};if(e==="food-a-search")f=Tn(t,ye),Ct(),De(),wt(),Q(),ie(),Ut();else{if(!f)return;let i={unit:"g",amount:ye.DEFAULT_FOOD_B_THRESHOLD};Ye(f,t,i),De(),Q(),ie()}document.getElementById(e).value=""}function Ci(n){let e={name:n.food_a.name,type:n.food_a.type==="SOLID"?"SOLID":"LIQUID",gramsInServing:new L(n.food_a.gramsInServing),servingSize:new L(n.food_a.servingSize),getMgPerUnit:function(){return this.gramsInServing.times(1e3).dividedBy(this.servingSize)}},t={dosingStrategy:hn[n.dosing_strategy],foodA:e,foodAStrategy:pn[n.food_a_strategy],diThreshold:new L(n.di_threshold),steps:[],config:ye};n.custom_note&&(Le=n.custom_note);let i=[];t.foodAStrategy==="DILUTE_INITIAL"?i=n.table_di:t.foodAStrategy==="DILUTE_NONE"?i=n.table_dn:t.foodAStrategy==="DILUTE_ALL"&&(i=n.table_da);for(let o=0;o<i.length;o++){let r=i[o],s={stepIndex:o+1,targetMg:new L(r.protein),method:r.method==="DILUTE"?"DILUTE":"DIRECT",dailyAmount:new L(r.daily_amount),dailyAmountUnit:r.method==="DILUTE"?"ml":r.food===e.name?e.type==="SOLID"?"g":"ml":"g",food:r.food===e.name?"A":"B"};if(r.method==="DILUTE"){s.mixFoodAmount=new L(r.mix_amount),s.mixWaterAmount=new L(r.water_amount);let a=r.food===e.name?e:t.foodB,d=s.mixFoodAmount.times(a.getMgPerUnit());s.servings=d.dividedBy(s.targetMg)}t.steps.push(s)}n.food_b&&(t.foodB={name:n.food_b.name,type:n.food_b.type==="SOLID"?"SOLID":"LIQUID",gramsInServing:new L(n.food_b.gramsInServing),servingSize:new L(n.food_b.servingSize),getMgPerUnit:function(){return this.gramsInServing.times(1e3).dividedBy(this.servingSize)}},n.food_b_threshold&&(t.foodBThreshold={unit:t.foodB.type==="SOLID"?"g":"ml",amount:new L(n.food_b_threshold)})),f=t,Ct(),De(),wt(),Q(),ie(),Ut(),document.getElementById("food-a-search").value=""}function Ui(){f&&(f.foodB=void 0,f.foodBThreshold=void 0,et(),De(),Q(),ie())}function Ut(){let n=document.querySelector(".food-b-container");if(!n)return;if(f&&f.foodA){n.classList.remove("disabled");let t=document.getElementById("food-b-search"),i=document.getElementById("clear-food-b");t&&(t.disabled=!1),i&&(i.disabled=!1)}else{n.classList.add("disabled");let t=document.getElementById("food-b-search"),i=document.getElementById("clear-food-b");t&&(t.disabled=!0,t.value=""),i&&(i.disabled=!0)}}function Pi(){let n=document.getElementById("food-a-name");n&&n.addEventListener("input",d=>{f&&(f.foodA.name=d.target.value,Q())});let e=document.getElementById("food-a-serving-size");e&&e.addEventListener("change",d=>{if(f){let l=parseFloat(d.target.value);l<=0&&(l=1),l>1e3&&(l=1e3),Number.isNaN(l)&&(l=1),d.target.value=l.toFixed(1),f.foodA.servingSize=new L(l),Ge()}});let t=document.getElementById("food-a-protein");t&&t.addEventListener("change",d=>{if(f){let l=parseFloat(d.target.value);l<0&&(l=0),l>f.foodA.servingSize.toNumber()&&(l=f.foodA.servingSize.toNumber()),Number.isNaN(l)&&(l=0),d.target.value=l.toFixed(1),f.foodA.gramsInServing=new L(l),Ge()}});let i=document.getElementById("food-a-threshold");i&&i.addEventListener("change",d=>{f&&(f.diThreshold=new L(d.target.value),Ge())});let o=document.getElementById("food-b-name");o&&o.addEventListener("input",d=>{f&&f.foodB&&(f.foodB.name=d.target.value,Q())});let r=document.getElementById("food-b-serving-size");r&&r.addEventListener("change",d=>{if(f&&f.foodB){let l=parseFloat(d.target.value);if(l<=0&&(l=1),l>1e3&&(l=1e3),Number.isNaN(l)&&(l=1),d.target.value=l.toFixed(1),f.foodB.servingSize=new L(l),f.foodBThreshold){let u=f.foodB,c=f.foodBThreshold;f.foodB=void 0,f.foodBThreshold=void 0,et(),Ye(f,u,c),Q(),ie()}}});let s=document.getElementById("food-b-protein");s&&s.addEventListener("change",d=>{if(f&&f.foodB){let l=parseFloat(d.target.value);if(l<0&&(l=0),l>f.foodB.servingSize.toNumber()&&(l=f.foodB.servingSize.toNumber()),Number.isNaN(l)&&(l=0),d.target.value=l.toFixed(1),f.foodB.gramsInServing=new L(l),f.foodBThreshold){let u=f.foodB,c=f.foodBThreshold;f.foodB=void 0,f.foodBThreshold=void 0,et(),Ye(f,u,c),Q(),ie()}}});let a=document.getElementById("food-b-threshold");a&&a.addEventListener("change",d=>{if(f&&f.foodB&&f.foodBThreshold){f.foodBThreshold.amount=new L(d.target.value);let l=f.foodB,u=f.foodBThreshold;f.foodB=void 0,f.foodBThreshold=void 0,et(),Ye(f,l,u),Q(),ie()}}),document.querySelectorAll("[data-action]").forEach(d=>{d.addEventListener("click",l=>{let u=l.target.getAttribute("data-action");if(f)switch(u){case"toggle-food-a-solid":f.foodA.type!=="SOLID"&&ht(!1);break;case"toggle-food-a-liquid":f.foodA.type!=="LIQUID"&&ht(!1);break;case"toggle-food-b-solid":f.foodB&&f.foodB.type!=="SOLID"&&ht(!0);break;case"toggle-food-b-liquid":f.foodB&&f.foodB.type!=="LIQUID"&&ht(!0);break;case"food-a-strategy-initial":f.foodAStrategy="DILUTE_INITIAL",Ge(),De();break;case"food-a-strategy-all":f.foodAStrategy="DILUTE_ALL",Ge(),De();break;case"food-a-strategy-none":f.foodAStrategy="DILUTE_NONE",Ge(),De();break}})})}function Ri(){document.querySelectorAll("input.editable").forEach(n=>{n.addEventListener("blur",e=>{let t=e.target,i=parseInt(t.getAttribute("data-step")),o=t.getAttribute("data-field"),r=parseFloat(t.value);isNaN(r)||(r<0&&(r=0,t.value=r.toString()),o==="targetMg"?Di(i,r):o==="dailyAmount"?Mi(i,r):o==="mixFoodAmount"&&xi(i,r))}),n.addEventListener("keydown",e=>{e.key==="Enter"&&e.target.blur()})}),document.querySelectorAll(".btn-add-step").forEach(n=>{n.addEventListener("click",e=>{let t=parseInt(e.target.getAttribute("data-step"));Fi(t)})}),document.querySelectorAll(".btn-remove-step").forEach(n=>{n.addEventListener("click",e=>{let t=parseInt(e.target.getAttribute("data-step"));Ni(t)})})}function Hi(){let n=document.getElementById("export-ascii");n&&n.addEventListener("click",Wi);let e=document.getElementById("export-pdf");e&&e.addEventListener("click",async()=>{let t=document.getElementById("export-pdf");t&&(t.textContent="Generating...",t.setAttribute("disabled","true"));try{let{jsPDF:i}=await import("./chunks/jspdf.es.min-UZJMZOSM.js"),{applyPlugin:o}=await import("./chunks/jspdf.plugin.autotable-HWF2UTYE.js");o(i),ki(i)}catch(i){console.error("Failed to load PDF libraries or generate PDF: ",i),alert("Error generating PDF. Please check the console for details.")}finally{t&&(t.textContent="Export PDF",t.removeAttribute("disabled"))}})}function $i(){let n=document.getElementById("custom-note");if(!n)return;n.value=Le;let e=null;n.addEventListener("input",t=>{e!==null&&clearTimeout(e),e=window.setTimeout(()=>{let i=t.target.value,o=document.createElement("div");o.textContent=i,Le=o.textContent||""},300)})}function ki(n){if(!f)return;let e=new n({unit:"pt",format:"letter"}),t=40;e.setFontSize(18),e.setFont("helvetica","bold"),e.text("Oral Immunotherapy Protocol",40,t),t+=30;let i=f.foodA.type==="SOLID"?"g":"ml",o=Sn(f),r=f.steps.length;if(o>0){let u=[];for(let c=0;c<o;c++){let g=f.steps[c],v=f.foodA,M=`${ne(g.dailyAmount,g.dailyAmountUnit)} ${g.dailyAmountUnit}`,T="N/A";if(g.method==="DILUTE"){let G=v.type==="SOLID"?"g":"ml";T=`${ne(g.mixFoodAmount,G)} ${G} food + ${ne(g.mixWaterAmount,"ml")} ml water`}c===r-1?u.push([g.stepIndex,`${O(g.targetMg,1)} mg`,g.method,T,M,"Continue long term"]):u.push([g.stepIndex,`${O(g.targetMg,1)} mg`,g.method,T,M,"2-4 weeks"])}e.setFontSize(14),e.setFont("helvetica","bold"),e.text(`${f.foodA.name}`,40,t),t+=20,e.setFontSize(10),e.setFont("helvetica","normal"),e.text(`Protein: ${O(f.foodA.gramsInServing,2)} g per ${f.foodA.servingSize} ${i} serving.`,40,t),t+=15,e.autoTable({startY:t,head:[["Step","Protein","Method","How to make mix","Daily Amount","Interval"]],body:u,theme:"striped",headStyles:{fillColor:[220,220,220],textColor:[0,0,0],fontStyle:"bold"},styles:{fontSize:9,cellPadding:6,overflow:"linebreak",valign:"middle",halign:"left"},columnStyles:{0:{halign:"center"},1:{halign:"center"},2:{halign:"center"}},margin:{left:40,right:40}}),t=e.lastAutoTable.finalY+20}if(f.foodB&&o<r){let u=f.foodB.type==="SOLID"?"g":"ml",c=[];for(let g=o;g<r;g++){let v=f.steps[g],M=`${ne(v.dailyAmount,v.dailyAmountUnit)} ${v.dailyAmountUnit}`,T="N/A";v.method==="DILUTE"&&console.log("A step for food B should never be diluted by design.",v),g===r-1?c.push([v.stepIndex,`${O(v.targetMg,1)} mg`,v.method,T,M,"Continue long term"]):c.push([v.stepIndex,`${O(v.targetMg,1)} mg`,v.method,T,M,"2-4 weeks"])}t>650&&(e.addPage(),t=40),t+=10,e.setFontSize(14),e.setFont("helvetica","bold"),e.text(`${f.foodB.name}`,40,t),t+=20,e.setFontSize(10),e.setFont("helvetica","normal"),e.text(`Protein: ${O(f.foodB.gramsInServing,2)} g per ${f.foodB.servingSize} ${u} serving`,40,t),t+=15,e.autoTable({startY:t,head:[["Step","Protein","Method","How to make mix","Daily Amount","Interval"]],body:c,theme:"striped",headStyles:{fillColor:[220,220,220],textColor:[0,0,0],fontStyle:"bold"},styles:{fontSize:9,cellPadding:6,overflow:"linebreak",valign:"middle",halign:"left"},columnStyles:{0:{halign:"center"},1:{halign:"center"},2:{halign:"center"}},margin:{left:40,right:40}}),t=e.lastAutoTable.finalY+20}if(Le&&Le.trim()){t>650&&(e.addPage(),t=40),e.setFontSize(14),e.setFont("helvetica","bold"),e.text("Notes",40,t),t+=15,e.setFontSize(10),e.setFont("helvetica","normal");let c=e.splitTextToSize(Le.trim(),520);for(let g of c)t>730&&(e.addPage(),t=40),e.text(g,40,t),t+=14}let s=e.internal.getNumberOfPages();for(let u=1;u<=s;u++)e.setPage(u),e.setFontSize(8),e.setFont("helvetica","italic"),e.setTextColor(100),e.text("",40,760),e.text("Always verify calculations before clinical use.",40,772),e.setTextColor(0);let a=/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)||window.matchMedia&&window.matchMedia("(pointer: coarse)").matches||("ontouchstart"in window||navigator.maxTouchPoints>0)&&window.innerWidth<=1024,d=e.output("blob"),l=URL.createObjectURL(d);if(a){let u=document.createElement("a");u.href=l,u.download="protocol.pdf",u.style.display="none",document.body.appendChild(u),u.click(),document.body.removeChild(u),setTimeout(()=>{URL.revokeObjectURL(l)},100)}else{if(!window.open(l,"_blank")){let c=document.createElement("a");c.href=l,c.download="protocol.pdf",c.style.display="none",document.body.appendChild(c),c.click(),document.body.removeChild(c)}setTimeout(()=>{URL.revokeObjectURL(l)},1e3)}}function Wi(){if(!f)return;let n="",e="",t="",i=f.foodA.type==="SOLID"?"Solid":"Liquid",o=f.foodA.type==="SOLID"?"g":"ml";if(e+=`${f.foodA.name} (${i}). Protein: ${O(f.foodA.getMgPerUnit(),1)} mg/${o}`,f.foodB){let l=f.foodB.type==="SOLID"?"Solid":"Liquid",u=f.foodB.type==="SOLID"?"g":"ml";t+=`${f.foodB.name} (${l}). Protein: ${O(f.foodB.getMgPerUnit(),1)} mg/${u}`}let r=f.steps.length,s=Sn(f),a=new Bt.AsciiTable3(f.foodA.name),d=new Bt.AsciiTable3(f.foodB?.name);a.setHeading("Step","Protein","Method","Daily Amount","Mix Details"),d.setHeading("Step","Protein","Method","Daily Amount","Mix Details");for(let l of f.steps){let u=l.food==="B",c=u?f.foodB:f.foodA,g;u?g=d:g=a;let v=`${ne(l.dailyAmount,l.dailyAmountUnit)} ${l.dailyAmountUnit}`,M="N/A";if(l.method==="DILUTE"){let T=c.type==="SOLID"?"g":"ml";M=`${ne(l.mixFoodAmount,T)} ${T} food + ${ne(l.mixWaterAmount,"ml")} ml water`}g.addRow(l.stepIndex,`${O(l.targetMg,1)} mg`,l.method,M,v)}f.foodB?n+=e+`
`+t+`

`:n+=e+`

`,s>0&&(n+=a.toString()),s<r&&(n+=`--- TRANSITION TO: ---
`,n+=d.toString()),Le&&Le.trim()&&(n+=`========================================
`,n+=`NOTES
`,n+=`========================================
`,n+=`${Le.trim()}`),navigator.clipboard.writeText(n).catch(()=>{alert(`Failed to copy to clipboard. Please copy manually:

`+n)})}async function qi(){try{let n=await fetch("/tool_assets/typed_foods_rough.json"),e=await fetch("/tool_assets/custom_foods.json"),t=await n.json(),i=await e.json(),o=[...t,...i];_t=o.map(s=>({...s,prepared:Ze.default.prepare(s.Food)})),Nt=await(await fetch("/tool_assets/oit_protocols.json")).json(),wn=Nt.map(s=>({...s,prepared:Ze.default.prepare(s.name)})),console.log(`Loaded ${o.length} foods and ${Nt.length} protocols`)}catch(n){console.error("Error loading databases:",n),alert("Error loading food and protocol databases. Some features may not work.")}}async function mn(){await qi();let n=document.getElementById("url-container");n&&(yn=n.dataset.targetUrl);let e=document.getElementById("food-a-search");e&&(e.addEventListener("input",o=>{let r=o.target.value;Ve&&clearTimeout(Ve),Ve=window.setTimeout(()=>{let s=cn(r,"protocol");fn("food-a-search",s,r)},150)}),e.addEventListener("keydown",o=>{e.parentElement?.querySelector(".search-dropdown")&&(o.key==="ArrowDown"?(o.preventDefault(),pt("down")):o.key==="ArrowUp"?(o.preventDefault(),pt("up")):o.key==="Enter"?(o.preventDefault(),gn()):o.key==="Escape"&&We("food-a-search"))}),e.addEventListener("blur",()=>{setTimeout(()=>We("food-a-search"),200)}));let t=document.getElementById("food-b-search");t&&(t.addEventListener("input",o=>{let r=o.target.value;Ve&&clearTimeout(Ve),Ve=window.setTimeout(()=>{let s=cn(r,"food");fn("food-b-search",s,r)},150)}),t.addEventListener("keydown",o=>{t.parentElement?.querySelector(".search-dropdown")&&(o.key==="ArrowDown"?(o.preventDefault(),pt("down")):o.key==="ArrowUp"?(o.preventDefault(),pt("up")):o.key==="Enter"?(o.preventDefault(),gn()):o.key==="Escape"&&We("food-b-search"))}),t.addEventListener("blur",()=>{setTimeout(()=>We("food-b-search"),200)}));let i=document.getElementById("clear-food-b");i&&i.addEventListener("click",Ui),console.log("OIT Calculator initialized")}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",mn):mn();
/*! Bundled license information:

ascii-table3/src/ascii-table3.js:
  (*!
   * Module exports.
   *)

decimal.js/decimal.mjs:
  (*!
   *  decimal.js v10.6.0
   *  An arbitrary-precision Decimal type for JavaScript.
   *  https://github.com/MikeMcl/decimal.js
   *  Copyright (c) 2025 Michael Mclaughlin <M8ch88l@gmail.com>
   *  MIT Licence
   *)
*/

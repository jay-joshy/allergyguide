"use strict";(()=>{var cn=Object.create;var vt=Object.defineProperty,mn=Object.defineProperties,gn=Object.getOwnPropertyDescriptor,pn=Object.getOwnPropertyDescriptors,hn=Object.getOwnPropertyNames,_t=Object.getOwnPropertySymbols,vn=Object.getPrototypeOf,Bt=Object.prototype.hasOwnProperty,yn=Object.prototype.propertyIsEnumerable;var Nt=(e,t,n)=>t in e?vt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,yt=(e,t)=>{for(var n in t||(t={}))Bt.call(t,n)&&Nt(e,n,t[n]);if(_t)for(var n of _t(t))yn.call(t,n)&&Nt(e,n,t[n]);return e},wt=(e,t)=>mn(e,pn(t));var wn=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var Tn=(e,t,n,i)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of hn(t))!Bt.call(e,o)&&o!==n&&vt(e,o,{get:()=>t[o],enumerable:!(i=gn(t,o))||i.enumerable});return e};var In=(e,t,n)=>(n=e!=null?cn(vn(e)):{},Tn(t||!e||!e.__esModule?vt(n,"default",{value:e,enumerable:!0}):n,e));var Xt=wn((Qt,lt)=>{((e,t)=>{typeof define=="function"&&define.amd?define([],t):typeof lt=="object"&&lt.exports?lt.exports=t():e.fuzzysort=t()})(Qt,e=>{"use strict";var t=(h,g)=>{if(!h||!g)return j;var y=v(h);Z(g)||(g=m(g));var A=y.bitflags;return(A&g._bitflags)!==A?j:T(y,g)},n=(h,g,y)=>{if(!h)return y!=null&&y.all?D(g,y):pt;var A=v(h),S=A.bitflags,I=A.containsSpace,w=u((y==null?void 0:y.threshold)||0),x=(y==null?void 0:y.limit)||$,L=0,N=0,B=g.length;function de(ke){L<x?(Ke.add(ke),++L):(++N,ke._score>Ke.peek()._score&&Ke.replaceTop(ke))}if(y!=null&&y.key)for(var te=y.key,O=0;O<B;++O){var se=g[O],H=_e(se,te);if(H&&(Z(H)||(H=m(H)),(S&H._bitflags)===S)){var q=T(A,H);q!==j&&(q._score<w||(q.obj=se,de(q)))}}else if(y!=null&&y.keys){var Ne=y.keys,he=Ne.length;e:for(var O=0;O<B;++O){var se=g[O];{for(var ne=0,P=0;P<he;++P){var te=Ne[P],H=_e(se,te);if(!H){Me[P]=ze;continue}Z(H)||(H=m(H)),Me[P]=H,ne|=H._bitflags}if((S&ne)!==S)continue}if(I)for(let R=0;R<A.spaceSearches.length;R++)me[R]=ge;for(var P=0;P<he;++P){if(H=Me[P],H===ze){we[P]=ze;continue}if(we[P]=T(A,H,!1,I),we[P]===j){we[P]=ze;continue}if(I)for(let W=0;W<A.spaceSearches.length;W++){if(Y[W]>-1e3&&me[W]>ge){var J=(me[W]+Y[W])/4;J>me[W]&&(me[W]=J)}Y[W]>me[W]&&(me[W]=Y[W])}}if(I){for(let R=0;R<A.spaceSearches.length;R++)if(me[R]===ge)continue e}else{var _=!1;for(let R=0;R<he;R++)if(we[R]._score!==ge){_=!0;break}if(!_)continue}var pe=new a(he);for(let R=0;R<he;R++)pe[R]=we[R];if(I){var Q=0;for(let R=0;R<A.spaceSearches.length;R++)Q+=me[R]}else{var Q=ge;for(let W=0;W<he;W++){var q=pe[W];if(q._score>-1e3&&Q>ge){var J=(Q+q._score)/4;J>Q&&(Q=J)}q._score>Q&&(Q=q._score)}}if(pe.obj=se,pe._score=Q,y!=null&&y.scoreFn){if(Q=y.scoreFn(pe),!Q)continue;Q=u(Q),pe._score=Q}Q<w||de(pe)}}else for(var O=0;O<B;++O){var H=g[O];if(H&&(Z(H)||(H=m(H)),(S&H._bitflags)===S)){var q=T(A,H);q!==j&&(q._score<w||de(q))}}if(L===0)return pt;for(var Be=new Array(L),O=L-1;O>=0;--O)Be[O]=Ke.poll();return Be.total=L+N,Be},i=(h,g="<b>",y="</b>")=>{for(var A=typeof g=="function"?g:void 0,S=h.target,I=S.length,w=h.indexes,x="",L=0,N=0,B=!1,de=[],te=0;te<I;++te){var O=S[te];if(w[N]===te){if(++N,B||(B=!0,A?(de.push(x),x=""):x+=g),N===w.length){A?(x+=O,de.push(A(x,L++)),x="",de.push(S.substr(te+1))):x+=O+y+S.substr(te+1);break}}else B&&(B=!1,A?(de.push(A(x,L++)),x=""):x+=y);x+=O}return A?de:x},o=h=>{typeof h=="number"?h=""+h:typeof h!="string"&&(h="");var g=re(h);return d(h,{_targetLower:g._lower,_targetLowerCodes:g.lowerCodes,_bitflags:g.bitflags})},r=()=>{Fe.clear(),fe.clear()};class s{get indexes(){return this._indexes.slice(0,this._indexes.len).sort((g,y)=>g-y)}set indexes(g){return this._indexes=g}highlight(g,y){return i(this,g,y)}get score(){return l(this._score)}set score(g){this._score=u(g)}}class a extends Array{get score(){return l(this._score)}set score(g){this._score=u(g)}}var d=(h,g)=>{var A,S,I,w,x,L,N;let y=new s;return y.target=h,y.obj=(A=g.obj)!=null?A:j,y._score=(S=g._score)!=null?S:ge,y._indexes=(I=g._indexes)!=null?I:[],y._targetLower=(w=g._targetLower)!=null?w:"",y._targetLowerCodes=(x=g._targetLowerCodes)!=null?x:j,y._nextBeginningIndexes=(L=g._nextBeginningIndexes)!=null?L:j,y._bitflags=(N=g._bitflags)!=null?N:0,y},l=h=>h===ge?0:h>1?h:Math.E**(((-h+1)**.04307-1)*-2),u=h=>h===0?ge:h>1?h:1-Math.pow(Math.log(h)/-2+1,1/.04307),f=h=>{typeof h=="number"?h=""+h:typeof h!="string"&&(h=""),h=h.trim();var g=re(h),y=[];if(g.containsSpace){var A=h.split(/\s+/);A=[...new Set(A)];for(var S=0;S<A.length;S++)if(A[S]!==""){var I=re(A[S]);y.push({lowerCodes:I.lowerCodes,_lower:A[S].toLowerCase(),containsSpace:!1})}}return{lowerCodes:g.lowerCodes,_lower:g._lower,containsSpace:g.containsSpace,bitflags:g.bitflags,spaceSearches:y}},m=h=>{if(h.length>999)return o(h);var g=Fe.get(h);return g!==void 0||(g=o(h),Fe.set(h,g)),g},v=h=>{if(h.length>999)return f(h);var g=fe.get(h);return g!==void 0||(g=f(h),fe.set(h,g)),g},D=(h,g)=>{var y=[];y.total=h.length;var A=(g==null?void 0:g.limit)||$;if(g!=null&&g.key)for(var S=0;S<h.length;S++){var I=h[S],w=_e(I,g.key);if(w!=j){Z(w)||(w=m(w));var x=d(w.target,{_score:w._score,obj:I});if(y.push(x),y.length>=A)return y}}else if(g!=null&&g.keys)for(var S=0;S<h.length;S++){for(var I=h[S],L=new a(g.keys.length),N=g.keys.length-1;N>=0;--N){var w=_e(I,g.keys[N]);if(!w){L[N]=ze;continue}Z(w)||(w=m(w)),w._score=ge,w._indexes.len=0,L[N]=w}if(L.obj=I,L._score=ge,y.push(L),y.length>=A)return y}else for(var S=0;S<h.length;S++){var w=h[S];if(w!=j&&(Z(w)||(w=m(w)),w._score=ge,w._indexes.len=0,y.push(w),y.length>=A))return y}return y},T=(h,g,y=!1,A=!1)=>{if(y===!1&&h.containsSpace)return z(h,g,A);for(var S=h._lower,I=h.lowerCodes,w=I[0],x=g._targetLowerCodes,L=I.length,N=x.length,O=0,B=0,de=0;;){var te=w===x[B];if(te){if(ce[de++]=B,++O,O===L)break;w=I[O]}if(++B,B>=N)return j}var O=0,se=!1,H=0,q=g._nextBeginningIndexes;q===j&&(q=g._nextBeginningIndexes=G(g.target)),B=ce[0]===0?0:q[ce[0]-1];var Ne=0;if(B!==N)for(;;)if(B>=N){if(O<=0||(++Ne,Ne>200))break;--O;var he=Ee[--H];B=q[he]}else{var te=I[O]===x[B];if(te){if(Ee[H++]=B,++O,O===L){se=!0;break}++B}else B=q[B]}var ne=L<=1?-1:g._targetLower.indexOf(S,ce[0]),P=!!~ne,J=P?ne===0||g._nextBeginningIndexes[ne-1]===ne:!1;if(P&&!J){for(var _=0;_<q.length;_=q[_])if(!(_<=ne)){for(var pe=0;pe<L&&I[pe]===g._targetLowerCodes[_+pe];pe++);if(pe===L){ne=_,J=!0;break}}}var Q=R=>{for(var W=0,Mt=0,xe=1;xe<L;++xe)R[xe]-R[xe-1]!==1&&(W-=R[xe],++Mt);var fn=R[L-1]-R[0]-(L-1);if(W-=(12+fn)*Mt,R[0]!==0&&(W-=R[0]*R[0]*.2),!se)W*=1e3;else{for(var ht=1,xe=q[0];xe<N;xe=q[xe])++ht;ht>24&&(W*=(ht-24)*10)}return W-=(N-L)/2,P&&(W/=1+L*L*1),J&&(W/=1+L*L*1),W-=(N-L)/2,W};if(se)if(J){for(var _=0;_<L;++_)ce[_]=ne+_;var Be=ce,ke=Q(ce)}else var Be=Ee,ke=Q(Ee);else{if(P)for(var _=0;_<L;++_)ce[_]=ne+_;var Be=ce,ke=Q(Be)}g._score=ke;for(var _=0;_<L;++_)g._indexes[_]=Be[_];g._indexes.len=L;let Je=new s;return Je.target=g.target,Je._score=g._score,Je._indexes=g._indexes,Je},z=(h,g,y)=>{for(var A=new Set,S=0,I=j,w=0,x=h.spaceSearches,L=x.length,N=0,B=()=>{for(let J=N-1;J>=0;J--)g._nextBeginningIndexes[Ie[J*2+0]]=Ie[J*2+1]},de=!1,P=0;P<L;++P){Y[P]=ge;var te=x[P];if(I=T(te,g),y){if(I===j)continue;de=!0}else if(I===j)return B(),j;var O=P===L-1;if(!O){var se=I._indexes,H=!0;for(let _=0;_<se.len-1;_++)if(se[_+1]-se[_]!==1){H=!1;break}if(H){var q=se[se.len-1]+1,Ne=g._nextBeginningIndexes[q-1];for(let _=q-1;_>=0&&Ne===g._nextBeginningIndexes[_];_--)g._nextBeginningIndexes[_]=q,Ie[N*2+0]=_,Ie[N*2+1]=Ne,N++}}S+=I._score/L,Y[P]=I._score/L,I._indexes[0]<w&&(S-=(w-I._indexes[0])*2),w=I._indexes[0];for(var he=0;he<I._indexes.len;++he)A.add(I._indexes[he])}if(y&&!de)return j;B();var ne=T(h,g,!0);if(ne!==j&&ne._score>S){if(y)for(var P=0;P<L;++P)Y[P]=ne._score/L;return ne}y&&(I=g),I._score=S;var P=0;for(let J of A)I._indexes[P++]=J;return I._indexes.len=P,I},C=h=>h.replace(new RegExp("\\p{Script=Latin}+","gu"),g=>g.normalize("NFD")).replace(/[\u0300-\u036f]/g,""),re=h=>{h=C(h);for(var g=h.length,y=h.toLowerCase(),A=[],S=0,I=!1,w=0;w<g;++w){var x=A[w]=y.charCodeAt(w);if(x===32){I=!0;continue}var L=x>=97&&x<=122?x-97:x>=48&&x<=57?26:x<=127?30:31;S|=1<<L}return{lowerCodes:A,bitflags:S,containsSpace:I,_lower:y}},k=h=>{for(var g=h.length,y=[],A=0,S=!1,I=!1,w=0;w<g;++w){var x=h.charCodeAt(w),L=x>=65&&x<=90,N=L||x>=97&&x<=122||x>=48&&x<=57,B=L&&!S||!I||!N;S=L,I=N,B&&(y[A++]=w)}return y},G=h=>{h=C(h);for(var g=h.length,y=k(h),A=[],S=y[0],I=0,w=0;w<g;++w)S>w?A[w]=S:(S=y[++I],A[w]=S===void 0?g:S);return A},Fe=new Map,fe=new Map,ce=[],Ee=[],Ie=[],me=[],Y=[],Me=[],we=[],_e=(h,g)=>{var y=h[g];if(y!==void 0)return y;if(typeof g=="function")return g(h);var A=g;Array.isArray(g)||(A=g.split("."));for(var S=A.length,I=-1;h&&++I<S;)h=h[A[I]];return h},Z=h=>typeof h=="object"&&typeof h._bitflags=="number",$=1/0,ge=-$,pt=[];pt.total=0;var j=null,ze=o(""),un=h=>{var g=[],y=0,A={},S=I=>{for(var w=0,x=g[w],L=1;L<y;){var N=L+1;w=L,N<y&&g[N]._score<g[L]._score&&(w=N),g[w-1>>1]=g[w],L=1+(w<<1)}for(var B=w-1>>1;w>0&&x._score<g[B]._score;B=(w=B)-1>>1)g[w]=g[B];g[w]=x};return A.add=(I=>{var w=y;g[y++]=I;for(var x=w-1>>1;w>0&&I._score<g[x]._score;x=(w=x)-1>>1)g[w]=g[x];g[w]=I}),A.poll=(I=>{if(y!==0){var w=g[0];return g[0]=g[--y],S(),w}}),A.peek=(I=>{if(y!==0)return g[0]}),A.replaceTop=(I=>{g[0]=I,S()}),A},Ke=un();return{single:t,go:n,prepare:o,cleanup:r}})});var Re=9e15,$e=1e9,Tt="0123456789abcdef",nt="2.3025850929940456840179914546843642076011014886287729760333279009675726096773524802359972050895982983419677840422862486334095254650828067566662873690987816894829072083255546808437998948262331985283935053089653777326288461633662222876982198867465436674744042432743651550489343149393914796194044002221051017141748003688084012647080685567743216228355220114804663715659121373450747856947683463616792101806445070648000277502684916746550586856935673420670581136429224554405758925724208241314695689016758940256776311356919292033376587141660230105703089634572075440370847469940168269282808481184289314848524948644871927809676271275775397027668605952496716674183485704422507197965004714951050492214776567636938662976979522110718264549734772662425709429322582798502585509785265383207606726317164309505995087807523710333101197857547331541421808427543863591778117054309827482385045648019095610299291824318237525357709750539565187697510374970888692180205189339507238539205144634197265287286965110862571492198849978748873771345686209167058",ot="3.1415926535897932384626433832795028841971693993751058209749445923078164062862089986280348253421170679821480865132823066470938446095505822317253594081284811174502841027019385211055596446229489549303819644288109756659334461284756482337867831652712019091456485669234603486104543266482133936072602491412737245870066063155881748815209209628292540917153643678925903600113305305488204665213841469519415116094330572703657595919530921861173819326117931051185480744623799627495673518857527248912279381830119491298336733624406566430860213949463952247371907021798609437027705392171762931767523846748184676694051320005681271452635608277857713427577896091736371787214684409012249534301465495853710507922796892589235420199561121290219608640344181598136297747713099605187072113499999983729780499510597317328160963185950244594553469083026425223082533446850352619311881710100031378387528865875332083814206171776691473035982534904287554687311595628638823537875937519577818577805321712268066130019278766111959092164201989380952572010654858632789",It={precision:20,rounding:4,modulo:1,toExpNeg:-7,toExpPos:21,minE:-Re,maxE:Re,crypto:!1},$t,De,F=!0,rt="[DecimalError] ",Oe=rt+"Invalid argument: ",Ct=rt+"Precision limit exceeded",kt=rt+"crypto unavailable",Ht="[object Decimal]",oe=Math.floor,X=Math.pow,An=/^0b([01]+(\.[01]*)?|\.[01]+)(p[+-]?\d+)?$/i,Sn=/^0x([0-9a-f]+(\.[0-9a-f]*)?|\.[0-9a-f]+)(p[+-]?\d+)?$/i,Ln=/^0o([0-7]+(\.[0-7]*)?|\.[0-7]+)(p[+-]?\d+)?$/i,Rt=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,Te=1e7,E=7,bn=9007199254740991,En=nt.length-1,At=ot.length-1,p={toStringTag:Ht};p.absoluteValue=p.abs=function(){var e=new this.constructor(this);return e.s<0&&(e.s=1),b(e)};p.ceil=function(){return b(new this.constructor(this),this.e+1,2)};p.clampedTo=p.clamp=function(e,t){var n,i=this,o=i.constructor;if(e=new o(e),t=new o(t),!e.s||!t.s)return new o(NaN);if(e.gt(t))throw Error(Oe+t);return n=i.cmp(e),n<0?e:i.cmp(t)>0?t:new o(i)};p.comparedTo=p.cmp=function(e){var t,n,i,o,r=this,s=r.d,a=(e=new r.constructor(e)).d,d=r.s,l=e.s;if(!s||!a)return!d||!l?NaN:d!==l?d:s===a?0:!s^d<0?1:-1;if(!s[0]||!a[0])return s[0]?d:a[0]?-l:0;if(d!==l)return d;if(r.e!==e.e)return r.e>e.e^d<0?1:-1;for(i=s.length,o=a.length,t=0,n=i<o?i:o;t<n;++t)if(s[t]!==a[t])return s[t]>a[t]^d<0?1:-1;return i===o?0:i>o^d<0?1:-1};p.cosine=p.cos=function(){var e,t,n=this,i=n.constructor;return n.d?n.d[0]?(e=i.precision,t=i.rounding,i.precision=e+Math.max(n.e,n.sd())+E,i.rounding=1,n=xn(i,zt(i,n)),i.precision=e,i.rounding=t,b(De==2||De==3?n.neg():n,e,t,!0)):new i(1):new i(NaN)};p.cubeRoot=p.cbrt=function(){var e,t,n,i,o,r,s,a,d,l,u=this,f=u.constructor;if(!u.isFinite()||u.isZero())return new f(u);for(F=!1,r=u.s*X(u.s*u,1/3),!r||Math.abs(r)==1/0?(n=ee(u.d),e=u.e,(r=(e-n.length+1)%3)&&(n+=r==1||r==-2?"0":"00"),r=X(n,1/3),e=oe((e+1)/3)-(e%3==(e<0?-1:2)),r==1/0?n="5e"+e:(n=r.toExponential(),n=n.slice(0,n.indexOf("e")+1)+e),i=new f(n),i.s=u.s):i=new f(r.toString()),s=(e=f.precision)+3;;)if(a=i,d=a.times(a).times(a),l=d.plus(u),i=V(l.plus(u).times(a),l.plus(d),s+2,1),ee(a.d).slice(0,s)===(n=ee(i.d)).slice(0,s))if(n=n.slice(s-3,s+1),n=="9999"||!o&&n=="4999"){if(!o&&(b(a,e+1,0),a.times(a).times(a).eq(u))){i=a;break}s+=4,o=1}else{(!+n||!+n.slice(1)&&n.charAt(0)=="5")&&(b(i,e+1,1),t=!i.times(i).times(i).eq(u));break}return F=!0,b(i,e,f.rounding,t)};p.decimalPlaces=p.dp=function(){var e,t=this.d,n=NaN;if(t){if(e=t.length-1,n=(e-oe(this.e/E))*E,e=t[e],e)for(;e%10==0;e/=10)n--;n<0&&(n=0)}return n};p.dividedBy=p.div=function(e){return V(this,new this.constructor(e))};p.dividedToIntegerBy=p.divToInt=function(e){var t=this,n=t.constructor;return b(V(t,new n(e),0,1,1),n.precision,n.rounding)};p.equals=p.eq=function(e){return this.cmp(e)===0};p.floor=function(){return b(new this.constructor(this),this.e+1,3)};p.greaterThan=p.gt=function(e){return this.cmp(e)>0};p.greaterThanOrEqualTo=p.gte=function(e){var t=this.cmp(e);return t==1||t===0};p.hyperbolicCosine=p.cosh=function(){var e,t,n,i,o,r=this,s=r.constructor,a=new s(1);if(!r.isFinite())return new s(r.s?1/0:NaN);if(r.isZero())return a;n=s.precision,i=s.rounding,s.precision=n+Math.max(r.e,r.sd())+4,s.rounding=1,o=r.d.length,o<32?(e=Math.ceil(o/3),t=(1/at(4,e)).toString()):(e=16,t="2.3283064365386962890625e-10"),r=qe(s,1,r.times(t),new s(1),!0);for(var d,l=e,u=new s(8);l--;)d=r.times(r),r=a.minus(d.times(u.minus(d.times(u))));return b(r,s.precision=n,s.rounding=i,!0)};p.hyperbolicSine=p.sinh=function(){var e,t,n,i,o=this,r=o.constructor;if(!o.isFinite()||o.isZero())return new r(o);if(t=r.precision,n=r.rounding,r.precision=t+Math.max(o.e,o.sd())+4,r.rounding=1,i=o.d.length,i<3)o=qe(r,2,o,o,!0);else{e=1.4*Math.sqrt(i),e=e>16?16:e|0,o=o.times(1/at(5,e)),o=qe(r,2,o,o,!0);for(var s,a=new r(5),d=new r(16),l=new r(20);e--;)s=o.times(o),o=o.times(a.plus(s.times(d.times(s).plus(l))))}return r.precision=t,r.rounding=n,b(o,t,n,!0)};p.hyperbolicTangent=p.tanh=function(){var e,t,n=this,i=n.constructor;return n.isFinite()?n.isZero()?new i(n):(e=i.precision,t=i.rounding,i.precision=e+7,i.rounding=1,V(n.sinh(),n.cosh(),i.precision=e,i.rounding=t)):new i(n.s)};p.inverseCosine=p.acos=function(){var e=this,t=e.constructor,n=e.abs().cmp(1),i=t.precision,o=t.rounding;return n!==-1?n===0?e.isNeg()?Ae(t,i,o):new t(0):new t(NaN):e.isZero()?Ae(t,i+4,o).times(.5):(t.precision=i+6,t.rounding=1,e=new t(1).minus(e).div(e.plus(1)).sqrt().atan(),t.precision=i,t.rounding=o,e.times(2))};p.inverseHyperbolicCosine=p.acosh=function(){var e,t,n=this,i=n.constructor;return n.lte(1)?new i(n.eq(1)?0:NaN):n.isFinite()?(e=i.precision,t=i.rounding,i.precision=e+Math.max(Math.abs(n.e),n.sd())+4,i.rounding=1,F=!1,n=n.times(n).minus(1).sqrt().plus(n),F=!0,i.precision=e,i.rounding=t,n.ln()):new i(n)};p.inverseHyperbolicSine=p.asinh=function(){var e,t,n=this,i=n.constructor;return!n.isFinite()||n.isZero()?new i(n):(e=i.precision,t=i.rounding,i.precision=e+2*Math.max(Math.abs(n.e),n.sd())+6,i.rounding=1,F=!1,n=n.times(n).plus(1).sqrt().plus(n),F=!0,i.precision=e,i.rounding=t,n.ln())};p.inverseHyperbolicTangent=p.atanh=function(){var e,t,n,i,o=this,r=o.constructor;return o.isFinite()?o.e>=0?new r(o.abs().eq(1)?o.s/0:o.isZero()?o:NaN):(e=r.precision,t=r.rounding,i=o.sd(),Math.max(i,e)<2*-o.e-1?b(new r(o),e,t,!0):(r.precision=n=i-o.e,o=V(o.plus(1),new r(1).minus(o),n+e,1),r.precision=e+4,r.rounding=1,o=o.ln(),r.precision=e,r.rounding=t,o.times(.5))):new r(NaN)};p.inverseSine=p.asin=function(){var e,t,n,i,o=this,r=o.constructor;return o.isZero()?new r(o):(t=o.abs().cmp(1),n=r.precision,i=r.rounding,t!==-1?t===0?(e=Ae(r,n+4,i).times(.5),e.s=o.s,e):new r(NaN):(r.precision=n+6,r.rounding=1,o=o.div(new r(1).minus(o.times(o)).sqrt().plus(1)).atan(),r.precision=n,r.rounding=i,o.times(2)))};p.inverseTangent=p.atan=function(){var e,t,n,i,o,r,s,a,d,l=this,u=l.constructor,f=u.precision,m=u.rounding;if(l.isFinite()){if(l.isZero())return new u(l);if(l.abs().eq(1)&&f+4<=At)return s=Ae(u,f+4,m).times(.25),s.s=l.s,s}else{if(!l.s)return new u(NaN);if(f+4<=At)return s=Ae(u,f+4,m).times(.5),s.s=l.s,s}for(u.precision=a=f+10,u.rounding=1,n=Math.min(28,a/E+2|0),e=n;e;--e)l=l.div(l.times(l).plus(1).sqrt().plus(1));for(F=!1,t=Math.ceil(a/E),i=1,d=l.times(l),s=new u(l),o=l;e!==-1;)if(o=o.times(d),r=s.minus(o.div(i+=2)),o=o.times(d),s=r.plus(o.div(i+=2)),s.d[t]!==void 0)for(e=t;s.d[e]===r.d[e]&&e--;);return n&&(s=s.times(2<<n-1)),F=!0,b(s,u.precision=f,u.rounding=m,!0)};p.isFinite=function(){return!!this.d};p.isInteger=p.isInt=function(){return!!this.d&&oe(this.e/E)>this.d.length-2};p.isNaN=function(){return!this.s};p.isNegative=p.isNeg=function(){return this.s<0};p.isPositive=p.isPos=function(){return this.s>0};p.isZero=function(){return!!this.d&&this.d[0]===0};p.lessThan=p.lt=function(e){return this.cmp(e)<0};p.lessThanOrEqualTo=p.lte=function(e){return this.cmp(e)<1};p.logarithm=p.log=function(e){var t,n,i,o,r,s,a,d,l=this,u=l.constructor,f=u.precision,m=u.rounding,v=5;if(e==null)e=new u(10),t=!0;else{if(e=new u(e),n=e.d,e.s<0||!n||!n[0]||e.eq(1))return new u(NaN);t=e.eq(10)}if(n=l.d,l.s<0||!n||!n[0]||l.eq(1))return new u(n&&!n[0]?-1/0:l.s!=1?NaN:n?0:1/0);if(t)if(n.length>1)r=!0;else{for(o=n[0];o%10===0;)o/=10;r=o!==1}if(F=!1,a=f+v,s=Ue(l,a),i=t?it(u,a+10):Ue(e,a),d=V(s,i,a,1),Ye(d.d,o=f,m))do if(a+=10,s=Ue(l,a),i=t?it(u,a+10):Ue(e,a),d=V(s,i,a,1),!r){+ee(d.d).slice(o+1,o+15)+1==1e14&&(d=b(d,f+1,0));break}while(Ye(d.d,o+=10,m));return F=!0,b(d,f,m)};p.minus=p.sub=function(e){var t,n,i,o,r,s,a,d,l,u,f,m,v=this,D=v.constructor;if(e=new D(e),!v.d||!e.d)return!v.s||!e.s?e=new D(NaN):v.d?e.s=-e.s:e=new D(e.d||v.s!==e.s?v:NaN),e;if(v.s!=e.s)return e.s=-e.s,v.plus(e);if(l=v.d,m=e.d,a=D.precision,d=D.rounding,!l[0]||!m[0]){if(m[0])e.s=-e.s;else if(l[0])e=new D(v);else return new D(d===3?-0:0);return F?b(e,a,d):e}if(n=oe(e.e/E),u=oe(v.e/E),l=l.slice(),r=u-n,r){for(f=r<0,f?(t=l,r=-r,s=m.length):(t=m,n=u,s=l.length),i=Math.max(Math.ceil(a/E),s)+2,r>i&&(r=i,t.length=1),t.reverse(),i=r;i--;)t.push(0);t.reverse()}else{for(i=l.length,s=m.length,f=i<s,f&&(s=i),i=0;i<s;i++)if(l[i]!=m[i]){f=l[i]<m[i];break}r=0}for(f&&(t=l,l=m,m=t,e.s=-e.s),s=l.length,i=m.length-s;i>0;--i)l[s++]=0;for(i=m.length;i>r;){if(l[--i]<m[i]){for(o=i;o&&l[--o]===0;)l[o]=Te-1;--l[o],l[i]+=Te}l[i]-=m[i]}for(;l[--s]===0;)l.pop();for(;l[0]===0;l.shift())--n;return l[0]?(e.d=l,e.e=st(l,n),F?b(e,a,d):e):new D(d===3?-0:0)};p.modulo=p.mod=function(e){var t,n=this,i=n.constructor;return e=new i(e),!n.d||!e.s||e.d&&!e.d[0]?new i(NaN):!e.d||n.d&&!n.d[0]?b(new i(n),i.precision,i.rounding):(F=!1,i.modulo==9?(t=V(n,e.abs(),0,3,1),t.s*=e.s):t=V(n,e,0,i.modulo,1),t=t.times(e),F=!0,n.minus(t))};p.naturalExponential=p.exp=function(){return St(this)};p.naturalLogarithm=p.ln=function(){return Ue(this)};p.negated=p.neg=function(){var e=new this.constructor(this);return e.s=-e.s,b(e)};p.plus=p.add=function(e){var t,n,i,o,r,s,a,d,l,u,f=this,m=f.constructor;if(e=new m(e),!f.d||!e.d)return!f.s||!e.s?e=new m(NaN):f.d||(e=new m(e.d||f.s===e.s?f:NaN)),e;if(f.s!=e.s)return e.s=-e.s,f.minus(e);if(l=f.d,u=e.d,a=m.precision,d=m.rounding,!l[0]||!u[0])return u[0]||(e=new m(f)),F?b(e,a,d):e;if(r=oe(f.e/E),i=oe(e.e/E),l=l.slice(),o=r-i,o){for(o<0?(n=l,o=-o,s=u.length):(n=u,i=r,s=l.length),r=Math.ceil(a/E),s=r>s?r+1:s+1,o>s&&(o=s,n.length=1),n.reverse();o--;)n.push(0);n.reverse()}for(s=l.length,o=u.length,s-o<0&&(o=s,n=u,u=l,l=n),t=0;o;)t=(l[--o]=l[o]+u[o]+t)/Te|0,l[o]%=Te;for(t&&(l.unshift(t),++i),s=l.length;l[--s]==0;)l.pop();return e.d=l,e.e=st(l,i),F?b(e,a,d):e};p.precision=p.sd=function(e){var t,n=this;if(e!==void 0&&e!==!!e&&e!==1&&e!==0)throw Error(Oe+e);return n.d?(t=qt(n.d),e&&n.e+1>t&&(t=n.e+1)):t=NaN,t};p.round=function(){var e=this,t=e.constructor;return b(new t(e),e.e+1,t.rounding)};p.sine=p.sin=function(){var e,t,n=this,i=n.constructor;return n.isFinite()?n.isZero()?new i(n):(e=i.precision,t=i.rounding,i.precision=e+Math.max(n.e,n.sd())+E,i.rounding=1,n=Fn(i,zt(i,n)),i.precision=e,i.rounding=t,b(De>2?n.neg():n,e,t,!0)):new i(NaN)};p.squareRoot=p.sqrt=function(){var e,t,n,i,o,r,s=this,a=s.d,d=s.e,l=s.s,u=s.constructor;if(l!==1||!a||!a[0])return new u(!l||l<0&&(!a||a[0])?NaN:a?s:1/0);for(F=!1,l=Math.sqrt(+s),l==0||l==1/0?(t=ee(a),(t.length+d)%2==0&&(t+="0"),l=Math.sqrt(t),d=oe((d+1)/2)-(d<0||d%2),l==1/0?t="5e"+d:(t=l.toExponential(),t=t.slice(0,t.indexOf("e")+1)+d),i=new u(t)):i=new u(l.toString()),n=(d=u.precision)+3;;)if(r=i,i=r.plus(V(s,r,n+2,1)).times(.5),ee(r.d).slice(0,n)===(t=ee(i.d)).slice(0,n))if(t=t.slice(n-3,n+1),t=="9999"||!o&&t=="4999"){if(!o&&(b(r,d+1,0),r.times(r).eq(s))){i=r;break}n+=4,o=1}else{(!+t||!+t.slice(1)&&t.charAt(0)=="5")&&(b(i,d+1,1),e=!i.times(i).eq(s));break}return F=!0,b(i,d,u.rounding,e)};p.tangent=p.tan=function(){var e,t,n=this,i=n.constructor;return n.isFinite()?n.isZero()?new i(n):(e=i.precision,t=i.rounding,i.precision=e+10,i.rounding=1,n=n.sin(),n.s=1,n=V(n,new i(1).minus(n.times(n)).sqrt(),e+10,0),i.precision=e,i.rounding=t,b(De==2||De==4?n.neg():n,e,t,!0)):new i(NaN)};p.times=p.mul=function(e){var t,n,i,o,r,s,a,d,l,u=this,f=u.constructor,m=u.d,v=(e=new f(e)).d;if(e.s*=u.s,!m||!m[0]||!v||!v[0])return new f(!e.s||m&&!m[0]&&!v||v&&!v[0]&&!m?NaN:!m||!v?e.s/0:e.s*0);for(n=oe(u.e/E)+oe(e.e/E),d=m.length,l=v.length,d<l&&(r=m,m=v,v=r,s=d,d=l,l=s),r=[],s=d+l,i=s;i--;)r.push(0);for(i=l;--i>=0;){for(t=0,o=d+i;o>i;)a=r[o]+v[i]*m[o-i-1]+t,r[o--]=a%Te|0,t=a/Te|0;r[o]=(r[o]+t)%Te|0}for(;!r[--s];)r.pop();return t?++n:r.shift(),e.d=r,e.e=st(r,n),F?b(e,f.precision,f.rounding):e};p.toBinary=function(e,t){return Lt(this,2,e,t)};p.toDecimalPlaces=p.toDP=function(e,t){var n=this,i=n.constructor;return n=new i(n),e===void 0?n:(ue(e,0,$e),t===void 0?t=i.rounding:ue(t,0,8),b(n,e+n.e+1,t))};p.toExponential=function(e,t){var n,i=this,o=i.constructor;return e===void 0?n=Se(i,!0):(ue(e,0,$e),t===void 0?t=o.rounding:ue(t,0,8),i=b(new o(i),e+1,t),n=Se(i,!0,e+1)),i.isNeg()&&!i.isZero()?"-"+n:n};p.toFixed=function(e,t){var n,i,o=this,r=o.constructor;return e===void 0?n=Se(o):(ue(e,0,$e),t===void 0?t=r.rounding:ue(t,0,8),i=b(new r(o),e+o.e+1,t),n=Se(i,!1,e+i.e+1)),o.isNeg()&&!o.isZero()?"-"+n:n};p.toFraction=function(e){var t,n,i,o,r,s,a,d,l,u,f,m,v=this,D=v.d,T=v.constructor;if(!D)return new T(v);if(l=n=new T(1),i=d=new T(0),t=new T(i),r=t.e=qt(D)-v.e-1,s=r%E,t.d[0]=X(10,s<0?E+s:s),e==null)e=r>0?t:l;else{if(a=new T(e),!a.isInt()||a.lt(l))throw Error(Oe+a);e=a.gt(t)?r>0?t:l:a}for(F=!1,a=new T(ee(D)),u=T.precision,T.precision=r=D.length*E*2;f=V(a,t,0,1,1),o=n.plus(f.times(i)),o.cmp(e)!=1;)n=i,i=o,o=l,l=d.plus(f.times(o)),d=o,o=t,t=a.minus(f.times(o)),a=o;return o=V(e.minus(n),i,0,1,1),d=d.plus(o.times(l)),n=n.plus(o.times(i)),d.s=l.s=v.s,m=V(l,i,r,1).minus(v).abs().cmp(V(d,n,r,1).minus(v).abs())<1?[l,i]:[d,n],T.precision=u,F=!0,m};p.toHexadecimal=p.toHex=function(e,t){return Lt(this,16,e,t)};p.toNearest=function(e,t){var n=this,i=n.constructor;if(n=new i(n),e==null){if(!n.d)return n;e=new i(1),t=i.rounding}else{if(e=new i(e),t===void 0?t=i.rounding:ue(t,0,8),!n.d)return e.s?n:e;if(!e.d)return e.s&&(e.s=n.s),e}return e.d[0]?(F=!1,n=V(n,e,0,t,1).times(e),F=!0,b(n)):(e.s=n.s,n=e),n};p.toNumber=function(){return+this};p.toOctal=function(e,t){return Lt(this,8,e,t)};p.toPower=p.pow=function(e){var t,n,i,o,r,s,a=this,d=a.constructor,l=+(e=new d(e));if(!a.d||!e.d||!a.d[0]||!e.d[0])return new d(X(+a,l));if(a=new d(a),a.eq(1))return a;if(i=d.precision,r=d.rounding,e.eq(1))return b(a,i,r);if(t=oe(e.e/E),t>=e.d.length-1&&(n=l<0?-l:l)<=bn)return o=Wt(d,a,n,i),e.s<0?new d(1).div(o):b(o,i,r);if(s=a.s,s<0){if(t<e.d.length-1)return new d(NaN);if((e.d[t]&1)==0&&(s=1),a.e==0&&a.d[0]==1&&a.d.length==1)return a.s=s,a}return n=X(+a,l),t=n==0||!isFinite(n)?oe(l*(Math.log("0."+ee(a.d))/Math.LN10+a.e+1)):new d(n+"").e,t>d.maxE+1||t<d.minE-1?new d(t>0?s/0:0):(F=!1,d.rounding=a.s=1,n=Math.min(12,(t+"").length),o=St(e.times(Ue(a,i+n)),i),o.d&&(o=b(o,i+5,1),Ye(o.d,i,r)&&(t=i+10,o=b(St(e.times(Ue(a,t+n)),t),t+5,1),+ee(o.d).slice(i+1,i+15)+1==1e14&&(o=b(o,i+1,0)))),o.s=s,F=!0,d.rounding=r,b(o,i,r))};p.toPrecision=function(e,t){var n,i=this,o=i.constructor;return e===void 0?n=Se(i,i.e<=o.toExpNeg||i.e>=o.toExpPos):(ue(e,1,$e),t===void 0?t=o.rounding:ue(t,0,8),i=b(new o(i),e,t),n=Se(i,e<=i.e||i.e<=o.toExpNeg,e)),i.isNeg()&&!i.isZero()?"-"+n:n};p.toSignificantDigits=p.toSD=function(e,t){var n=this,i=n.constructor;return e===void 0?(e=i.precision,t=i.rounding):(ue(e,1,$e),t===void 0?t=i.rounding:ue(t,0,8)),b(new i(n),e,t)};p.toString=function(){var e=this,t=e.constructor,n=Se(e,e.e<=t.toExpNeg||e.e>=t.toExpPos);return e.isNeg()&&!e.isZero()?"-"+n:n};p.truncated=p.trunc=function(){return b(new this.constructor(this),this.e+1,1)};p.valueOf=p.toJSON=function(){var e=this,t=e.constructor,n=Se(e,e.e<=t.toExpNeg||e.e>=t.toExpPos);return e.isNeg()?"-"+n:n};function ee(e){var t,n,i,o=e.length-1,r="",s=e[0];if(o>0){for(r+=s,t=1;t<o;t++)i=e[t]+"",n=E-i.length,n&&(r+=Pe(n)),r+=i;s=e[t],i=s+"",n=E-i.length,n&&(r+=Pe(n))}else if(s===0)return"0";for(;s%10===0;)s/=10;return r+s}function ue(e,t,n){if(e!==~~e||e<t||e>n)throw Error(Oe+e)}function Ye(e,t,n,i){var o,r,s,a;for(r=e[0];r>=10;r/=10)--t;return--t<0?(t+=E,o=0):(o=Math.ceil((t+1)/E),t%=E),r=X(10,E-t),a=e[o]%r|0,i==null?t<3?(t==0?a=a/100|0:t==1&&(a=a/10|0),s=n<4&&a==99999||n>3&&a==49999||a==5e4||a==0):s=(n<4&&a+1==r||n>3&&a+1==r/2)&&(e[o+1]/r/100|0)==X(10,t-2)-1||(a==r/2||a==0)&&(e[o+1]/r/100|0)==0:t<4?(t==0?a=a/1e3|0:t==1?a=a/100|0:t==2&&(a=a/10|0),s=(i||n<4)&&a==9999||!i&&n>3&&a==4999):s=((i||n<4)&&a+1==r||!i&&n>3&&a+1==r/2)&&(e[o+1]/r/1e3|0)==X(10,t-3)-1,s}function et(e,t,n){for(var i,o=[0],r,s=0,a=e.length;s<a;){for(r=o.length;r--;)o[r]*=t;for(o[0]+=Tt.indexOf(e.charAt(s++)),i=0;i<o.length;i++)o[i]>n-1&&(o[i+1]===void 0&&(o[i+1]=0),o[i+1]+=o[i]/n|0,o[i]%=n)}return o.reverse()}function xn(e,t){var n,i,o;if(t.isZero())return t;i=t.d.length,i<32?(n=Math.ceil(i/3),o=(1/at(4,n)).toString()):(n=16,o="2.3283064365386962890625e-10"),e.precision+=n,t=qe(e,1,t.times(o),new e(1));for(var r=n;r--;){var s=t.times(t);t=s.times(s).minus(s).times(8).plus(1)}return e.precision-=n,t}var V=(function(){function e(i,o,r){var s,a=0,d=i.length;for(i=i.slice();d--;)s=i[d]*o+a,i[d]=s%r|0,a=s/r|0;return a&&i.unshift(a),i}function t(i,o,r,s){var a,d;if(r!=s)d=r>s?1:-1;else for(a=d=0;a<r;a++)if(i[a]!=o[a]){d=i[a]>o[a]?1:-1;break}return d}function n(i,o,r,s){for(var a=0;r--;)i[r]-=a,a=i[r]<o[r]?1:0,i[r]=a*s+i[r]-o[r];for(;!i[0]&&i.length>1;)i.shift()}return function(i,o,r,s,a,d){var l,u,f,m,v,D,T,z,C,re,k,G,Fe,fe,ce,Ee,Ie,me,Y,Me,we=i.constructor,_e=i.s==o.s?1:-1,Z=i.d,$=o.d;if(!Z||!Z[0]||!$||!$[0])return new we(!i.s||!o.s||(Z?$&&Z[0]==$[0]:!$)?NaN:Z&&Z[0]==0||!$?_e*0:_e/0);for(d?(v=1,u=i.e-o.e):(d=Te,v=E,u=oe(i.e/v)-oe(o.e/v)),Y=$.length,Ie=Z.length,C=new we(_e),re=C.d=[],f=0;$[f]==(Z[f]||0);f++);if($[f]>(Z[f]||0)&&u--,r==null?(fe=r=we.precision,s=we.rounding):a?fe=r+(i.e-o.e)+1:fe=r,fe<0)re.push(1),D=!0;else{if(fe=fe/v+2|0,f=0,Y==1){for(m=0,$=$[0],fe++;(f<Ie||m)&&fe--;f++)ce=m*d+(Z[f]||0),re[f]=ce/$|0,m=ce%$|0;D=m||f<Ie}else{for(m=d/($[0]+1)|0,m>1&&($=e($,m,d),Z=e(Z,m,d),Y=$.length,Ie=Z.length),Ee=Y,k=Z.slice(0,Y),G=k.length;G<Y;)k[G++]=0;Me=$.slice(),Me.unshift(0),me=$[0],$[1]>=d/2&&++me;do m=0,l=t($,k,Y,G),l<0?(Fe=k[0],Y!=G&&(Fe=Fe*d+(k[1]||0)),m=Fe/me|0,m>1?(m>=d&&(m=d-1),T=e($,m,d),z=T.length,G=k.length,l=t(T,k,z,G),l==1&&(m--,n(T,Y<z?Me:$,z,d))):(m==0&&(l=m=1),T=$.slice()),z=T.length,z<G&&T.unshift(0),n(k,T,G,d),l==-1&&(G=k.length,l=t($,k,Y,G),l<1&&(m++,n(k,Y<G?Me:$,G,d))),G=k.length):l===0&&(m++,k=[0]),re[f++]=m,l&&k[0]?k[G++]=Z[Ee]||0:(k=[Z[Ee]],G=1);while((Ee++<Ie||k[0]!==void 0)&&fe--);D=k[0]!==void 0}re[0]||re.shift()}if(v==1)C.e=u,$t=D;else{for(f=1,m=re[0];m>=10;m/=10)f++;C.e=f+u*v-1,b(C,a?r+C.e+1:r,s,D)}return C}})();function b(e,t,n,i){var o,r,s,a,d,l,u,f,m,v=e.constructor;e:if(t!=null){if(f=e.d,!f)return e;for(o=1,a=f[0];a>=10;a/=10)o++;if(r=t-o,r<0)r+=E,s=t,u=f[m=0],d=u/X(10,o-s-1)%10|0;else if(m=Math.ceil((r+1)/E),a=f.length,m>=a)if(i){for(;a++<=m;)f.push(0);u=d=0,o=1,r%=E,s=r-E+1}else break e;else{for(u=a=f[m],o=1;a>=10;a/=10)o++;r%=E,s=r-E+o,d=s<0?0:u/X(10,o-s-1)%10|0}if(i=i||t<0||f[m+1]!==void 0||(s<0?u:u%X(10,o-s-1)),l=n<4?(d||i)&&(n==0||n==(e.s<0?3:2)):d>5||d==5&&(n==4||i||n==6&&(r>0?s>0?u/X(10,o-s):0:f[m-1])%10&1||n==(e.s<0?8:7)),t<1||!f[0])return f.length=0,l?(t-=e.e+1,f[0]=X(10,(E-t%E)%E),e.e=-t||0):f[0]=e.e=0,e;if(r==0?(f.length=m,a=1,m--):(f.length=m+1,a=X(10,E-r),f[m]=s>0?(u/X(10,o-s)%X(10,s)|0)*a:0),l)for(;;)if(m==0){for(r=1,s=f[0];s>=10;s/=10)r++;for(s=f[0]+=a,a=1;s>=10;s/=10)a++;r!=a&&(e.e++,f[0]==Te&&(f[0]=1));break}else{if(f[m]+=a,f[m]!=Te)break;f[m--]=0,a=1}for(r=f.length;f[--r]===0;)f.pop()}return F&&(e.e>v.maxE?(e.d=null,e.e=NaN):e.e<v.minE&&(e.e=0,e.d=[0])),e}function Se(e,t,n){if(!e.isFinite())return Zt(e);var i,o=e.e,r=ee(e.d),s=r.length;return t?(n&&(i=n-s)>0?r=r.charAt(0)+"."+r.slice(1)+Pe(i):s>1&&(r=r.charAt(0)+"."+r.slice(1)),r=r+(e.e<0?"e":"e+")+e.e):o<0?(r="0."+Pe(-o-1)+r,n&&(i=n-s)>0&&(r+=Pe(i))):o>=s?(r+=Pe(o+1-s),n&&(i=n-o-1)>0&&(r=r+"."+Pe(i))):((i=o+1)<s&&(r=r.slice(0,i)+"."+r.slice(i)),n&&(i=n-s)>0&&(o+1===s&&(r+="."),r+=Pe(i))),r}function st(e,t){var n=e[0];for(t*=E;n>=10;n/=10)t++;return t}function it(e,t,n){if(t>En)throw F=!0,n&&(e.precision=n),Error(Ct);return b(new e(nt),t,1,!0)}function Ae(e,t,n){if(t>At)throw Error(Ct);return b(new e(ot),t,n,!0)}function qt(e){var t=e.length-1,n=t*E+1;if(t=e[t],t){for(;t%10==0;t/=10)n--;for(t=e[0];t>=10;t/=10)n++}return n}function Pe(e){for(var t="";e--;)t+="0";return t}function Wt(e,t,n,i){var o,r=new e(1),s=Math.ceil(i/E+4);for(F=!1;;){if(n%2&&(r=r.times(t),Ut(r.d,s)&&(o=!0)),n=oe(n/2),n===0){n=r.d.length-1,o&&r.d[n]===0&&++r.d[n];break}t=t.times(t),Ut(t.d,s)}return F=!0,r}function Pt(e){return e.d[e.d.length-1]&1}function Vt(e,t,n){for(var i,o,r=new e(t[0]),s=0;++s<t.length;){if(o=new e(t[s]),!o.s){r=o;break}i=r.cmp(o),(i===n||i===0&&r.s===n)&&(r=o)}return r}function St(e,t){var n,i,o,r,s,a,d,l=0,u=0,f=0,m=e.constructor,v=m.rounding,D=m.precision;if(!e.d||!e.d[0]||e.e>17)return new m(e.d?e.d[0]?e.s<0?0:1/0:1:e.s?e.s<0?0:e:NaN);for(t==null?(F=!1,d=D):d=t,a=new m(.03125);e.e>-2;)e=e.times(a),f+=5;for(i=Math.log(X(2,f))/Math.LN10*2+5|0,d+=i,n=r=s=new m(1),m.precision=d;;){if(r=b(r.times(e),d,1),n=n.times(++u),a=s.plus(V(r,n,d,1)),ee(a.d).slice(0,d)===ee(s.d).slice(0,d)){for(o=f;o--;)s=b(s.times(s),d,1);if(t==null)if(l<3&&Ye(s.d,d-i,v,l))m.precision=d+=10,n=r=a=new m(1),u=0,l++;else return b(s,m.precision=D,v,F=!0);else return m.precision=D,s}s=a}}function Ue(e,t){var n,i,o,r,s,a,d,l,u,f,m,v=1,D=10,T=e,z=T.d,C=T.constructor,re=C.rounding,k=C.precision;if(T.s<0||!z||!z[0]||!T.e&&z[0]==1&&z.length==1)return new C(z&&!z[0]?-1/0:T.s!=1?NaN:z?0:T);if(t==null?(F=!1,u=k):u=t,C.precision=u+=D,n=ee(z),i=n.charAt(0),Math.abs(r=T.e)<15e14){for(;i<7&&i!=1||i==1&&n.charAt(1)>3;)T=T.times(e),n=ee(T.d),i=n.charAt(0),v++;r=T.e,i>1?(T=new C("0."+n),r++):T=new C(i+"."+n.slice(1))}else return l=it(C,u+2,k).times(r+""),T=Ue(new C(i+"."+n.slice(1)),u-D).plus(l),C.precision=k,t==null?b(T,k,re,F=!0):T;for(f=T,d=s=T=V(T.minus(1),T.plus(1),u,1),m=b(T.times(T),u,1),o=3;;){if(s=b(s.times(m),u,1),l=d.plus(V(s,new C(o),u,1)),ee(l.d).slice(0,u)===ee(d.d).slice(0,u))if(d=d.times(2),r!==0&&(d=d.plus(it(C,u+2,k).times(r+""))),d=V(d,new C(v),u,1),t==null)if(Ye(d.d,u-D,re,a))C.precision=u+=D,l=s=T=V(f.minus(1),f.plus(1),u,1),m=b(T.times(T),u,1),o=a=1;else return b(d,C.precision=k,re,F=!0);else return C.precision=k,d;d=l,o+=2}}function Zt(e){return String(e.s*e.s/0)}function tt(e,t){var n,i,o;for((n=t.indexOf("."))>-1&&(t=t.replace(".","")),(i=t.search(/e/i))>0?(n<0&&(n=i),n+=+t.slice(i+1),t=t.substring(0,i)):n<0&&(n=t.length),i=0;t.charCodeAt(i)===48;i++);for(o=t.length;t.charCodeAt(o-1)===48;--o);if(t=t.slice(i,o),t){if(o-=i,e.e=n=n-i-1,e.d=[],i=(n+1)%E,n<0&&(i+=E),i<o){for(i&&e.d.push(+t.slice(0,i)),o-=E;i<o;)e.d.push(+t.slice(i,i+=E));t=t.slice(i),i=E-t.length}else i-=o;for(;i--;)t+="0";e.d.push(+t),F&&(e.e>e.constructor.maxE?(e.d=null,e.e=NaN):e.e<e.constructor.minE&&(e.e=0,e.d=[0]))}else e.e=0,e.d=[0];return e}function Dn(e,t){var n,i,o,r,s,a,d,l,u;if(t.indexOf("_")>-1){if(t=t.replace(/(\d)_(?=\d)/g,"$1"),Rt.test(t))return tt(e,t)}else if(t==="Infinity"||t==="NaN")return+t||(e.s=NaN),e.e=NaN,e.d=null,e;if(Sn.test(t))n=16,t=t.toLowerCase();else if(An.test(t))n=2;else if(Ln.test(t))n=8;else throw Error(Oe+t);for(r=t.search(/p/i),r>0?(d=+t.slice(r+1),t=t.substring(2,r)):t=t.slice(2),r=t.indexOf("."),s=r>=0,i=e.constructor,s&&(t=t.replace(".",""),a=t.length,r=a-r,o=Wt(i,new i(n),r,r*2)),l=et(t,n,Te),u=l.length-1,r=u;l[r]===0;--r)l.pop();return r<0?new i(e.s*0):(e.e=st(l,u),e.d=l,F=!1,s&&(e=V(e,o,a*4)),d&&(e=e.times(Math.abs(d)<54?X(2,d):Qe.pow(2,d))),F=!0,e)}function Fn(e,t){var n,i=t.d.length;if(i<3)return t.isZero()?t:qe(e,2,t,t);n=1.4*Math.sqrt(i),n=n>16?16:n|0,t=t.times(1/at(5,n)),t=qe(e,2,t,t);for(var o,r=new e(5),s=new e(16),a=new e(20);n--;)o=t.times(t),t=t.times(r.plus(o.times(s.times(o).minus(a))));return t}function qe(e,t,n,i,o){var r,s,a,d,l=1,u=e.precision,f=Math.ceil(u/E);for(F=!1,d=n.times(n),a=new e(i);;){if(s=V(a.times(d),new e(t++*t++),u,1),a=o?i.plus(s):i.minus(s),i=V(s.times(d),new e(t++*t++),u,1),s=a.plus(i),s.d[f]!==void 0){for(r=f;s.d[r]===a.d[r]&&r--;);if(r==-1)break}r=a,a=i,i=s,s=r,l++}return F=!0,s.d.length=f+1,s}function at(e,t){for(var n=e;--t;)n*=e;return n}function zt(e,t){var n,i=t.s<0,o=Ae(e,e.precision,1),r=o.times(.5);if(t=t.abs(),t.lte(r))return De=i?4:1,t;if(n=t.divToInt(o),n.isZero())De=i?3:2;else{if(t=t.minus(n.times(o)),t.lte(r))return De=Pt(n)?i?2:3:i?4:1,t;De=Pt(n)?i?1:4:i?3:2}return t.minus(o).abs()}function Lt(e,t,n,i){var o,r,s,a,d,l,u,f,m,v=e.constructor,D=n!==void 0;if(D?(ue(n,1,$e),i===void 0?i=v.rounding:ue(i,0,8)):(n=v.precision,i=v.rounding),!e.isFinite())u=Zt(e);else{for(u=Se(e),s=u.indexOf("."),D?(o=2,t==16?n=n*4-3:t==8&&(n=n*3-2)):o=t,s>=0&&(u=u.replace(".",""),m=new v(1),m.e=u.length-s,m.d=et(Se(m),10,o),m.e=m.d.length),f=et(u,10,o),r=d=f.length;f[--d]==0;)f.pop();if(!f[0])u=D?"0p+0":"0";else{if(s<0?r--:(e=new v(e),e.d=f,e.e=r,e=V(e,m,n,i,0,o),f=e.d,r=e.e,l=$t),s=f[n],a=o/2,l=l||f[n+1]!==void 0,l=i<4?(s!==void 0||l)&&(i===0||i===(e.s<0?3:2)):s>a||s===a&&(i===4||l||i===6&&f[n-1]&1||i===(e.s<0?8:7)),f.length=n,l)for(;++f[--n]>o-1;)f[n]=0,n||(++r,f.unshift(1));for(d=f.length;!f[d-1];--d);for(s=0,u="";s<d;s++)u+=Tt.charAt(f[s]);if(D){if(d>1)if(t==16||t==8){for(s=t==16?4:3,--d;d%s;d++)u+="0";for(f=et(u,o,t),d=f.length;!f[d-1];--d);for(s=1,u="1.";s<d;s++)u+=Tt.charAt(f[s])}else u=u.charAt(0)+"."+u.slice(1);u=u+(r<0?"p":"p+")+r}else if(r<0){for(;++r;)u="0"+u;u="0."+u}else if(++r>d)for(r-=d;r--;)u+="0";else r<d&&(u=u.slice(0,r)+"."+u.slice(r))}u=(t==16?"0x":t==2?"0b":t==8?"0o":"")+u}return e.s<0?"-"+u:u}function Ut(e,t){if(e.length>t)return e.length=t,!0}function Mn(e){return new this(e).abs()}function _n(e){return new this(e).acos()}function Nn(e){return new this(e).acosh()}function Bn(e,t){return new this(e).plus(t)}function Pn(e){return new this(e).asin()}function Un(e){return new this(e).asinh()}function On(e){return new this(e).atan()}function $n(e){return new this(e).atanh()}function Cn(e,t){e=new this(e),t=new this(t);var n,i=this.precision,o=this.rounding,r=i+4;return!e.s||!t.s?n=new this(NaN):!e.d&&!t.d?(n=Ae(this,r,1).times(t.s>0?.25:.75),n.s=e.s):!t.d||e.isZero()?(n=t.s<0?Ae(this,i,o):new this(0),n.s=e.s):!e.d||t.isZero()?(n=Ae(this,r,1).times(.5),n.s=e.s):t.s<0?(this.precision=r,this.rounding=1,n=this.atan(V(e,t,r,1)),t=Ae(this,r,1),this.precision=i,this.rounding=o,n=e.s<0?n.minus(t):n.plus(t)):n=this.atan(V(e,t,r,1)),n}function kn(e){return new this(e).cbrt()}function Hn(e){return b(e=new this(e),e.e+1,2)}function Rn(e,t,n){return new this(e).clamp(t,n)}function qn(e){if(!e||typeof e!="object")throw Error(rt+"Object expected");var t,n,i,o=e.defaults===!0,r=["precision",1,$e,"rounding",0,8,"toExpNeg",-Re,0,"toExpPos",0,Re,"maxE",0,Re,"minE",-Re,0,"modulo",0,9];for(t=0;t<r.length;t+=3)if(n=r[t],o&&(this[n]=It[n]),(i=e[n])!==void 0)if(oe(i)===i&&i>=r[t+1]&&i<=r[t+2])this[n]=i;else throw Error(Oe+n+": "+i);if(n="crypto",o&&(this[n]=It[n]),(i=e[n])!==void 0)if(i===!0||i===!1||i===0||i===1)if(i)if(typeof crypto!="undefined"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))this[n]=!0;else throw Error(kt);else this[n]=!1;else throw Error(Oe+n+": "+i);return this}function Wn(e){return new this(e).cos()}function Vn(e){return new this(e).cosh()}function Yt(e){var t,n,i;function o(r){var s,a,d,l=this;if(!(l instanceof o))return new o(r);if(l.constructor=o,Ot(r)){l.s=r.s,F?!r.d||r.e>o.maxE?(l.e=NaN,l.d=null):r.e<o.minE?(l.e=0,l.d=[0]):(l.e=r.e,l.d=r.d.slice()):(l.e=r.e,l.d=r.d?r.d.slice():r.d);return}if(d=typeof r,d==="number"){if(r===0){l.s=1/r<0?-1:1,l.e=0,l.d=[0];return}if(r<0?(r=-r,l.s=-1):l.s=1,r===~~r&&r<1e7){for(s=0,a=r;a>=10;a/=10)s++;F?s>o.maxE?(l.e=NaN,l.d=null):s<o.minE?(l.e=0,l.d=[0]):(l.e=s,l.d=[r]):(l.e=s,l.d=[r]);return}if(r*0!==0){r||(l.s=NaN),l.e=NaN,l.d=null;return}return tt(l,r.toString())}if(d==="string")return(a=r.charCodeAt(0))===45?(r=r.slice(1),l.s=-1):(a===43&&(r=r.slice(1)),l.s=1),Rt.test(r)?tt(l,r):Dn(l,r);if(d==="bigint")return r<0?(r=-r,l.s=-1):l.s=1,tt(l,r.toString());throw Error(Oe+r)}if(o.prototype=p,o.ROUND_UP=0,o.ROUND_DOWN=1,o.ROUND_CEIL=2,o.ROUND_FLOOR=3,o.ROUND_HALF_UP=4,o.ROUND_HALF_DOWN=5,o.ROUND_HALF_EVEN=6,o.ROUND_HALF_CEIL=7,o.ROUND_HALF_FLOOR=8,o.EUCLID=9,o.config=o.set=qn,o.clone=Yt,o.isDecimal=Ot,o.abs=Mn,o.acos=_n,o.acosh=Nn,o.add=Bn,o.asin=Pn,o.asinh=Un,o.atan=On,o.atanh=$n,o.atan2=Cn,o.cbrt=kn,o.ceil=Hn,o.clamp=Rn,o.cos=Wn,o.cosh=Vn,o.div=Zn,o.exp=zn,o.floor=Yn,o.hypot=Qn,o.ln=Xn,o.log=Gn,o.log10=Kn,o.log2=jn,o.max=Jn,o.min=eo,o.mod=to,o.mul=no,o.pow=oo,o.random=io,o.round=ro,o.sign=so,o.sin=ao,o.sinh=lo,o.sqrt=uo,o.sub=fo,o.sum=co,o.tan=mo,o.tanh=go,o.trunc=po,e===void 0&&(e={}),e&&e.defaults!==!0)for(i=["precision","rounding","toExpNeg","toExpPos","maxE","minE","modulo","crypto"],t=0;t<i.length;)e.hasOwnProperty(n=i[t++])||(e[n]=this[n]);return o.config(e),o}function Zn(e,t){return new this(e).div(t)}function zn(e){return new this(e).exp()}function Yn(e){return b(e=new this(e),e.e+1,3)}function Qn(){var e,t,n=new this(0);for(F=!1,e=0;e<arguments.length;)if(t=new this(arguments[e++]),t.d)n.d&&(n=n.plus(t.times(t)));else{if(t.s)return F=!0,new this(1/0);n=t}return F=!0,n.sqrt()}function Ot(e){return e instanceof Qe||e&&e.toStringTag===Ht||!1}function Xn(e){return new this(e).ln()}function Gn(e,t){return new this(e).log(t)}function jn(e){return new this(e).log(2)}function Kn(e){return new this(e).log(10)}function Jn(){return Vt(this,arguments,-1)}function eo(){return Vt(this,arguments,1)}function to(e,t){return new this(e).mod(t)}function no(e,t){return new this(e).mul(t)}function oo(e,t){return new this(e).pow(t)}function io(e){var t,n,i,o,r=0,s=new this(1),a=[];if(e===void 0?e=this.precision:ue(e,1,$e),i=Math.ceil(e/E),this.crypto)if(crypto.getRandomValues)for(t=crypto.getRandomValues(new Uint32Array(i));r<i;)o=t[r],o>=429e7?t[r]=crypto.getRandomValues(new Uint32Array(1))[0]:a[r++]=o%1e7;else if(crypto.randomBytes){for(t=crypto.randomBytes(i*=4);r<i;)o=t[r]+(t[r+1]<<8)+(t[r+2]<<16)+((t[r+3]&127)<<24),o>=214e7?crypto.randomBytes(4).copy(t,r):(a.push(o%1e7),r+=4);r=i/4}else throw Error(kt);else for(;r<i;)a[r++]=Math.random()*1e7|0;for(i=a[--r],e%=E,i&&e&&(o=X(10,E-e),a[r]=(i/o|0)*o);a[r]===0;r--)a.pop();if(r<0)n=0,a=[0];else{for(n=-1;a[0]===0;n-=E)a.shift();for(i=1,o=a[0];o>=10;o/=10)i++;i<E&&(n-=E-i)}return s.e=n,s.d=a,s}function ro(e){return b(e=new this(e),e.e+1,this.rounding)}function so(e){return e=new this(e),e.d?e.d[0]?e.s:0*e.s:e.s||NaN}function ao(e){return new this(e).sin()}function lo(e){return new this(e).sinh()}function uo(e){return new this(e).sqrt()}function fo(e,t){return new this(e).sub(t)}function co(){var e=0,t=arguments,n=new this(t[e]);for(F=!1;n.s&&++e<t.length;)n=n.plus(t[e]);return F=!0,b(n,this.precision,this.rounding)}function mo(e){return new this(e).tan()}function go(e){return new this(e).tanh()}function po(e){return b(e=new this(e),e.e+1,1)}p[Symbol.for("nodejs.util.inspect.custom")]=p.toString;p[Symbol.toStringTag]="Decimal";var Qe=p.constructor=Yt(It);nt=new Qe(nt);ot=new Qe(ot);var M=Qe;var Ve=In(Xt());M.set({precision:20,rounding:M.ROUND_HALF_UP});var nn=(i=>(i.STANDARD="STANDARD",i.SLOW="SLOW",i.RAPID="RAPID",i))(nn||{});var on=(i=>(i.DILUTE_INITIAL="DILUTE_INITIAL",i.DILUTE_ALL="DILUTE_ALL",i.DILUTE_NONE="DILUTE_NONE",i))(on||{}),ft=2,Ce=1,rn={STANDARD:[1,2.5,5,10,20,40,80,120,160,240,300].map(e=>new M(e)),SLOW:[.5,1,1.5,2.5,5,10,20,30,40,60,80,100,120,140,160,190,220,260,300].map(e=>new M(e)),RAPID:[5,10,20,40,80,160,300].map(e=>new M(e))},ho=[.2,.25,.3,.35,.4,.45,.5,1,2,5,10].map(e=>new M(e)),vo=[.5,1,1.5,2,2.5,3,3.5,4,4.5,5,6,7,8,9,10].map(e=>new M(e)),yo=[.5,1,1.5,2,2.5,3,4,5,7,9,10,11,12].map(e=>new M(e)),Gt=new M(500),ve;ve={minMeasurableMass:new M(.2),minMeasurableVolume:new M(.2),minServingsForMix:new M(3),PROTEIN_TOLERANCE:new M(.05),DEFAULT_FOOD_A_DILUTION_THRESHOLD:new M(.2),DEFAULT_FOOD_B_THRESHOLD:new M(.2),MAX_SOLID_CONCENTRATION:new M(.05)};var c=null,bt=[],Et=[],Dt=[],sn=[],Le="",We=null,ae=-1,Ze="";function ye(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}function Ge(e){return new M(e).times(10)}function jt(e){return e.dividedBy(10).toNumber()}function U(e,t){return e==null?"":(typeof e=="number"?e:e.toNumber()).toFixed(t)}function le(e,t){if(e==null)return"";let n=typeof e=="number"?e:e.toNumber();return t==="g"?n.toFixed(ft):n%1===0?n.toFixed(0):n.toFixed(Ce)}function xt(e){return e.type==="LIQUID"?"ml":"g"}function wo(e,t,n){let i=[],o=t.type==="SOLID"?ho:vo,r=t.type==="SOLID"?e.dividedBy(n.MAX_SOLID_CONCENTRATION.times(t.mgPerUnit)):null;for(let s of o){let a=s;for(let d of yo){let l=d;if(t.type==="SOLID"){let u=a.times(t.mgPerUnit),f=u.dividedBy(e);if(f.lessThan(n.minServingsForMix))continue;let m=l.times(f),v=m;if(a.lessThan(n.minMeasurableMass)||l.lessThan(n.minMeasurableVolume)||v.greaterThan(Gt)||v.lessThan(n.minMeasurableVolume)||u.dividedBy(m).times(l).dividedBy(e).minus(1).abs().greaterThan(n.PROTEIN_TOLERANCE))continue;i.push({mixFoodAmount:a,mixWaterAmount:v,dailyAmount:l,mixTotalVolume:m,servings:f})}else{let u=a.times(t.mgPerUnit),f=u.dividedBy(e);if(f.lessThan(n.minServingsForMix))continue;let m=l.times(f),v=m.minus(a);if(v.lessThan(0)||a.lessThan(n.minMeasurableVolume)||l.lessThan(n.minMeasurableVolume)||v.greaterThan(Gt)||v.lessThan(n.minMeasurableVolume)||u.dividedBy(m).times(l).dividedBy(e).minus(1).abs().greaterThan(n.PROTEIN_TOLERANCE))continue;i.push({mixFoodAmount:a,mixWaterAmount:v,dailyAmount:l,mixTotalVolume:m,servings:f})}}}return i.sort((s,a)=>{if(t.type==="SOLID"&&r){let l=s.dailyAmount.greaterThanOrEqualTo(r),u=a.dailyAmount.greaterThanOrEqualTo(r);if(l&&!u)return-1;if(!l&&u)return 1}let d=s.mixFoodAmount.comparedTo(a.mixFoodAmount);return d!==0||(d=s.dailyAmount.comparedTo(a.dailyAmount),d!==0)||(d=s.mixTotalVolume.comparedTo(a.mixTotalVolume),d!==0)?d:s.mixWaterAmount.comparedTo(a.mixWaterAmount)}),i}function Ft(e,t,n,i,o,r){let s=e,a=s.dividedBy(n.mgPerUnit),d=n.type==="SOLID"?"g":"ml",l=!1;if(i==="DILUTE_INITIAL"?l=a.lessThan(o):i==="DILUTE_ALL"?l=!0:l=!1,l){let u=wo(s,n,r);if(u.length===0)return null;let f=u[0];return{stepIndex:t,targetMg:s,method:"DILUTE",dailyAmount:f.dailyAmount,dailyAmountUnit:"ml",mixFoodAmount:f.mixFoodAmount,mixWaterAmount:f.mixWaterAmount,servings:f.servings,food:"A"}}else return{stepIndex:t,targetMg:s,method:"DIRECT",dailyAmount:a,dailyAmountUnit:d,food:"A"}}function an(e,t){let n="STANDARD",i="DILUTE_INITIAL",o=e.type==="SOLID"?"g":"ml",r=ve.DEFAULT_FOOD_A_DILUTION_THRESHOLD,s=rn[n],a=[];for(let d=0;d<s.length;d++){let l=Ft(s[d],d+1,e,i,r,t);if(l)a.push(l);else{let u=s[d],f=u.dividedBy(e.mgPerUnit);a.push({stepIndex:d+1,targetMg:u,method:"DIRECT",dailyAmount:f,dailyAmountUnit:o,food:"A"})}}return{dosingStrategy:n,foodA:e,foodAStrategy:i,diThreshold:r,steps:a,config:t}}function ln(e){if(!e.foodB)return e.steps.length;for(let t=0;t<e.steps.length;t++)if(e.steps[t].food==="B")return t;return e.steps.length}function je(e,t,n){let i=n.amount.times(t.mgPerUnit);e.foodB=t,e.foodBThreshold=n;let o=-1;for(let f=0;f<e.steps.length;f++)if(e.steps[f].targetMg.greaterThanOrEqualTo(i)){o=f;break}if(o===-1){console.warn("No transition point found for Food B");return}let r=[];for(let f=o+1;f<e.steps.length;f++)r.push(e.steps[f].targetMg);let s=e.steps[o].targetMg,a=[],d=t.type==="SOLID"?"g":"ml",l=s,u=l.dividedBy(t.mgPerUnit);a.push({stepIndex:o+2,targetMg:l,method:"DIRECT",dailyAmount:u,dailyAmountUnit:d,food:"B"});for(let f of r){let m=f.dividedBy(t.mgPerUnit);a.push({stepIndex:0,targetMg:f,method:"DIRECT",dailyAmount:m,dailyAmountUnit:d,food:"B"})}e.steps=e.steps.slice(0,o+1),e.steps.push(...a);for(let f=0;f<e.steps.length;f++)e.steps[f].stepIndex=f+1}function dn(e){var n,i;let t=[];if(e.steps.length<5&&t.push({severity:"red",code:"R1",message:"Protocol < 5 steps, which is quite rapid for a full OIT protocol."}),e.foodA.mgPerUnit.lessThanOrEqualTo(new M(0))&&t.push({severity:"red",code:"R7",message:`${ye(e.foodA.name)} protein concentration must be > 0 to be considered for OIT`}),(n=e.foodB)!=null&&n.mgPerUnit.lessThanOrEqualTo(new M(0))&&t.push({severity:"red",code:"R7",message:`${ye(((i=e.foodB)==null?void 0:i.name)||"")} protein concentration must be > 0 to be considered for OIT`}),e.foodB){let o=!1;for(let r of e.steps)r.food==="B"&&(o=!0);o===!1&&t.push({severity:"yellow",code:"Y5",message:`${ye(e.foodB.name)} has no transition point. Decrease the threshold if you want to transition.`})}for(let o of e.steps){let s=o.food==="B"?e.foodB:e.foodA;if(o.targetMg.lessThanOrEqualTo(new M(0))&&t.push({severity:"red",code:"R8",message:`Step ${o.stepIndex}: A target protein of ${U(o.targetMg,1)} mg is NOT valid. It must be >0.`,stepIndex:o.stepIndex}),o.method==="DILUTE"){let a=o.mixFoodAmount.times(s.mgPerUnit),d=s.type==="SOLID"?o.mixWaterAmount:o.mixFoodAmount.plus(o.mixWaterAmount),l=a.times(o.dailyAmount).dividedBy(d),u=l.dividedBy(o.targetMg).minus(1).abs();if(u.greaterThan(ve.PROTEIN_TOLERANCE)&&t.push({severity:"red",code:"R2",message:`Step ${o.stepIndex}: Protein mismatch. Target ${U(o.targetMg,1)} mg but calculated ${U(l,1)} mg: ${U(u.times(100),0)}% difference.`,stepIndex:o.stepIndex}),o.servings.lessThan(new M(1))){let f=o.mixFoodAmount.times(s.mgPerUnit);t.push({severity:"red",code:"R5",message:`Step ${o.stepIndex}: ${le(o.mixFoodAmount,xt(s))} ${xt(s)} of food only makes ${U(f,1)} mg of total protein. However, target protein is ${U(o.targetMg,1)} mg.`,stepIndex:o.stepIndex})}d.lessThan(o.dailyAmount)&&t.push({severity:"red",code:"R6",message:`Step ${o.stepIndex}: Total volume of dilution is ${U(d,Ce)} ml; however, daily amount is ${U(o.dailyAmount,Ce)} ml, which is impossible`,stepIndex:o.stepIndex}),o.dailyAmount.lessThanOrEqualTo(0)&&t.push({severity:"red",code:"R9",message:`Step ${o.stepIndex}: Daily amount cannot be <= 0 ml`,stepIndex:o.stepIndex}),o.mixFoodAmount.lessThanOrEqualTo(0)&&t.push({severity:"red",code:"R9",message:`Step ${o.stepIndex}: Amount of food to mix cannot be <= 0 ${xt(s)}`,stepIndex:o.stepIndex}),o.mixWaterAmount.lessThan(0)&&t.push({severity:"red",code:"R9",message:`Step ${o.stepIndex}: Amount of water to mix cannot be < 0 ml`,stepIndex:o.stepIndex}),s.type==="SOLID"&&o.mixFoodAmount.lessThan(e.config.minMeasurableMass)&&t.push({severity:"yellow",code:"Y3",message:`Step ${o.stepIndex}: Measuring ${U(o.mixFoodAmount,ft)} g of food is impractical. Aim for value \u2265 ${e.config.minMeasurableMass} g`,stepIndex:o.stepIndex}),s.type==="LIQUID"&&o.mixFoodAmount.lessThan(e.config.minMeasurableVolume)&&t.push({severity:"yellow",code:"Y3",message:`Step ${o.stepIndex}: Measuring ${U(o.mixFoodAmount,Ce)} ml of food is impractical. Aim for value \u2265 ${e.config.minMeasurableVolume} ml`,stepIndex:o.stepIndex}),o.dailyAmount.lessThan(e.config.minMeasurableVolume)&&t.push({severity:"yellow",code:"Y3",message:`Step ${o.stepIndex}: Measuring a daily amount of ${U(o.dailyAmount,Ce)} ml is impractical. Aim for value \u2265 ${e.config.minMeasurableVolume} ml`,stepIndex:o.stepIndex}),o.mixWaterAmount.lessThan(e.config.minMeasurableVolume)&&t.push({severity:"yellow",code:"Y3",message:`Step ${o.stepIndex}: Measuring ${U(o.mixWaterAmount,Ce)} ml of water is impractical. Aim for value \u2265 ${e.config.minMeasurableVolume} ml`,stepIndex:o.stepIndex}),o.servings.lessThan(e.config.minServingsForMix)&&o.servings.greaterThan(new M(1))&&t.push({severity:"yellow",code:"Y1",message:`Step ${o.stepIndex}: Only ${U(o.servings,1)} servings (< ${ve.minServingsForMix} - impractical). Consider increasing mix amounts.`,stepIndex:o.stepIndex}),s.type==="SOLID"&&o.mixFoodAmount.dividedBy(o.mixWaterAmount).greaterThan(new M(ve.MAX_SOLID_CONCENTRATION))&&t.push({severity:"yellow",code:"Y4",message:`Step ${o.stepIndex}: at ${U(o.mixFoodAmount,ft)} g of food in ${U(o.mixWaterAmount,Ce)} ml of water, the w/v is > ${U(ve.MAX_SOLID_CONCENTRATION.times(100),0)}%. The assumption that the food contributes non-negligibly to the total volume of dilution is likely violated. Consider increasing the Daily Amount`,stepIndex:o.stepIndex})}else if(o.method==="DIRECT"){let a=o.dailyAmount.times(s.mgPerUnit),d=a.dividedBy(o.targetMg).minus(1).abs();d.greaterThan(ve.PROTEIN_TOLERANCE)&&t.push({severity:"red",code:"R2",message:`Step ${o.stepIndex}: Protein mismatch. Target ${U(o.targetMg,1)} mg but calculated ${U(a,1)} mg: ${U(d.times(100),0)}% difference.`,stepIndex:o.stepIndex}),s.type==="SOLID"&&o.dailyAmount.lessThan(e.config.minMeasurableMass)&&t.push({severity:"yellow",code:"Y3",message:`Step ${o.stepIndex}: Measuring ${U(o.dailyAmount,ft)} g of food is impractical. Aim for \u2265 ${e.config.minMeasurableMass} g`,stepIndex:o.stepIndex}),s.type==="LIQUID"&&o.dailyAmount.lessThan(e.config.minMeasurableVolume)&&t.push({severity:"yellow",code:"Y3",message:`Step ${o.stepIndex}: Measuring ${U(o.dailyAmount,Ce)} ml of food is impractical. Aim for \u2265 ${e.config.minMeasurableVolume} ml`,stepIndex:o.stepIndex})}}for(let o=1;o<e.steps.length;o++)e.steps[o].targetMg.lessThan(e.steps[o-1].targetMg)&&t.push({severity:"yellow",code:"Y2",message:`Steps must be ascending or equal \u2014 check step ${e.steps[o].stepIndex} vs step ${e.steps[o-1].stepIndex}.`,stepIndex:e.steps[o].stepIndex});return t}function ct(){if(!c)return;let e=rn[c.dosingStrategy],t=[];for(let n=0;n<e.length;n++){let i=Ft(e[n],n+1,c.foodA,c.foodAStrategy,c.diThreshold,c.config);i&&t.push(i)}c.steps=t,c.foodB&&c.foodBThreshold&&je(c,c.foodB,c.foodBThreshold),K(),ie()}function Xe(){if(!c)return;let e=c.steps.map(i=>i.targetMg),t=c.steps.map(i=>i.food),n=[];for(let i=0;i<e.length;i++){let o=e[i],r=t[i]==="B",s=r?c.foodB:c.foodA,a=r?"DILUTE_NONE":c.foodAStrategy,d=Ft(o,i+1,s,a,c.diThreshold,c.config);d&&(d.food=t[i],n.push(d))}c.steps=n,K(),ie()}function To(e,t){if(!c)return;let n=c.steps[e-1];if(!n)return;n.targetMg=new M(t);let o=n.food==="B"?c.foodB:c.foodA;if(n.method==="DIRECT")n.dailyAmount=n.targetMg.dividedBy(o.mgPerUnit);else{let r=n.mixFoodAmount.times(o.mgPerUnit);if(n.servings=r.dividedBy(n.targetMg),o.type==="SOLID"){let s=n.dailyAmount.times(n.servings);n.mixWaterAmount=s}else{let s=n.dailyAmount.times(n.servings);n.mixWaterAmount=s.minus(n.mixFoodAmount)}}K(),ie()}function Io(e,t){if(!c)return;let n=c.steps[e-1];if(!n)return;n.dailyAmount=new M(t);let o=n.food==="B"?c.foodB:c.foodA;if(n.method==="DIRECT")n.targetMg=n.dailyAmount.times(o.mgPerUnit);else{let r=n.mixFoodAmount.times(o.mgPerUnit);if(n.servings=r.dividedBy(n.targetMg),o.type==="SOLID"){let s=n.dailyAmount.times(n.servings);n.mixWaterAmount=s}else{let s=n.dailyAmount.times(n.servings);n.mixWaterAmount=s.minus(n.mixFoodAmount)}}K(),ie()}function Ao(e,t){if(!c)return;let n=c.steps[e-1];if(!n||n.method!=="DILUTE")return;n.mixFoodAmount=new M(t);let o=n.food==="B"?c.foodB:c.foodA,r=n.mixFoodAmount.times(o.mgPerUnit);if(n.servings=r.dividedBy(n.targetMg),o.type==="SOLID"){let s=n.dailyAmount.times(n.servings);n.mixWaterAmount=s}else{let s=n.dailyAmount.times(n.servings);n.mixWaterAmount=s.minus(n.mixFoodAmount)}K(),ie()}function So(e){if(!c)return;let t=c.steps[e-1];if(!t)return;let n={stepIndex:t.stepIndex+1,targetMg:t.targetMg,method:t.method,dailyAmount:t.dailyAmount,dailyAmountUnit:t.dailyAmountUnit,food:t.food};t.method==="DILUTE"&&(n.mixFoodAmount=t.mixFoodAmount,n.mixWaterAmount=t.mixWaterAmount,n.servings=t.servings),c.steps.splice(e,0,n);for(let i=0;i<c.steps.length;i++)c.steps[i].stepIndex=i+1;K(),ie()}function Lo(e){if(c&&!(c.steps.length<=1)){c.steps.splice(e-1,1);for(let t=0;t<c.steps.length;t++)c.steps[t].stepIndex=t+1;K(),ie()}}function dt(e){if(!c)return;let t=e?c.foodB:c.foodA;t.type=t.type==="SOLID"?"LIQUID":"SOLID";for(let n of c.steps)if(n.food==="B"===e)if(n.method==="DILUTE"){n.dailyAmountUnit="ml";let o=n.mixFoodAmount.times(t.mgPerUnit);if(n.servings=o.dividedBy(n.targetMg),t.type==="SOLID"){let r=n.dailyAmount.times(n.servings);n.mixWaterAmount=r}else{let r=n.dailyAmount.times(n.servings);n.mixWaterAmount=r.minus(n.mixFoodAmount)}}else n.dailyAmountUnit=t.type==="SOLID"?"g":"ml";be(),K(),ie()}function be(){if(!c)return;let e=document.querySelector(".food-a-container"),t=document.querySelector(".food-b-container"),n=`
    <div class="food-a-settings">
      <input
        type="text"
        class="food-name-input"
        id="food-a-name"
        value="${ye(c.foodA.name)}"
      />
      <div class="setting-row">
        <label>Protein:</label>
        <input
          type="number"
          min="0"
          max="150"
          id="food-a-protein"
          value="${jt(c.foodA.mgPerUnit).toFixed(1)}"
          step="0.1"
        />
        <span>g per 100 ${c.foodA.type==="SOLID"?"g":"ml"}</span>
      </div>
      <div class="setting-row">
        <label>Form:</label>
        <div class="toggle-group">
          <button class="toggle-btn ${c.foodA.type==="SOLID"?"active":""}" data-action="toggle-food-a-solid">Solid</button>
          <button class="toggle-btn ${c.foodA.type==="LIQUID"?"active":""}" data-action="toggle-food-a-liquid">Liquid</button>
        </div>
      </div>
      <div class="setting-row">
        <label>Dilution strategy:</label>
        <div class="toggle-group">
          <button class="toggle-btn ${c.foodAStrategy==="DILUTE_INITIAL"?"active":""}" data-action="food-a-strategy-initial">Initial dilution</button>
          <button class="toggle-btn ${c.foodAStrategy==="DILUTE_ALL"?"active":""}" data-action="food-a-strategy-all">Dilution throughout</button>
          <button class="toggle-btn ${c.foodAStrategy==="DILUTE_NONE"?"active":""}" data-action="food-a-strategy-none">No dilutions</button>
        </div>
      </div>
      ${c.foodAStrategy==="DILUTE_INITIAL"?`
      <div class="setting-row threshold-setting">
        <label>Directly dose when neat amount \u2265</label>
        <input
          type="number"
          id="food-a-threshold"
          min="0"
          value="${le(c.diThreshold,c.foodA.type==="SOLID"?"g":"ml")}"
          step="0.1"
        />
        <span>${c.foodA.type==="SOLID"?"g":"ml"}</span>
      </div>
      `:""}
    </div>
  `,i=e.querySelector(".food-a-settings");if(i?i.outerHTML=n:e.insertAdjacentHTML("beforeend",n),c.foodB){let o=`
      <div class="food-b-settings">
        <input
          type="text"
          class="food-name-input"
          id="food-b-name"
          value="${ye(c.foodB.name)}"
        />
        <div class="setting-row">
          <label>Protein:</label>
          <input
            type="number"
            id="food-b-protein"
            min="0"
            max="150"
            value="${jt(c.foodB.mgPerUnit).toFixed(1)}"
            step="0.1"
          />
          <span>g per 100 ${c.foodB.type==="SOLID"?"g":"ml"}</span>
        </div>
        <div class="setting-row">
          <label>Form:</label>
          <div class="toggle-group">
            <button class="toggle-btn ${c.foodB.type==="SOLID"?"active":""}" data-action="toggle-food-b-solid">Solid</button>
            <button class="toggle-btn ${c.foodB.type==="LIQUID"?"active":""}" data-action="toggle-food-b-liquid">Liquid</button>
          </div>
        </div>
        <div class="setting-row threshold-setting">
          <label>Transition when daily amount \u2265</label>
          <input
            type="number"
            id="food-b-threshold"
            value="${le(c.foodBThreshold.amount,c.foodBThreshold.unit)}"
            step="0.1"
            min="0"
          />
          <span>${c.foodBThreshold.unit}</span>
        </div>
      </div>
    `,r=t.querySelector(".food-b-settings");r?r.outerHTML=o:t.insertAdjacentHTML("beforeend",o)}else{let o=t.querySelector(".food-b-settings");o&&o.remove()}Mo()}function mt(){if(!c)return;let e=document.querySelector(".dosing-strategy-container"),t=`
    <h3>Dosing Strategy (resets all steps on change)</h3>
    <div class="setting-row">
      <div class="toggle-group">
        <button class="toggle-btn ${c.dosingStrategy==="STANDARD"?"active":""}" data-strategy="STANDARD">Standard</button>
        <button class="toggle-btn ${c.dosingStrategy==="SLOW"?"active":""}" data-strategy="SLOW">Slow</button>
        <button class="toggle-btn ${c.dosingStrategy==="RAPID"?"active":""}" data-strategy="RAPID">Rapid</button>
      </div>
    </div>
  `;e.innerHTML=t,e.querySelectorAll("[data-strategy]").forEach(n=>{n.addEventListener("click",i=>{let o=i.target.getAttribute("data-strategy");c&&o!==c.dosingStrategy&&(c.dosingStrategy=o,ct(),mt())})})}function K(){if(!c)return;let e=document.querySelector(".output-container table"),t=`
    <thead>
      <tr>
        <th>Step</th>
        <th>Protein (mg)</th>
        <th>Method</th>
        <th>Daily amount</th>
        <th>Amount for mixture</th>
        <th>Water for mixture</th>
      </tr>
    </thead>
    <tbody>
  `,n=!0,i=dn(c),o=new Map;for(let a of i)if(a.stepIndex!==void 0){let d=o.get(a.stepIndex);(!d||a.severity==="red"&&d==="yellow")&&o.set(a.stepIndex,a.severity)}for(let a of c.steps){let d=a.food==="B",l=d?c.foodB:c.foodA;d&&n?(t+=`
        <tr class="food-section-header">
          <td colspan="6">${ye(c.foodB.name)}</td>
        </tr>
      `,n=!1):!d&&a.stepIndex===1&&(t+=`
        <tr class="food-section-header">
          <td colspan="6">${ye(c.foodA.name)}</td>
        </tr>
      `);let u=o.get(a.stepIndex),f=u?`warning-highlight-${u}`:"";if(t+=`<tr class="${f}">`,t+=`
      <td class="actions-cell">
        <button class="btn-add-step" data-step="${a.stepIndex}">+</button>
        <button class="btn-remove-step" data-step="${a.stepIndex}">\u2212</button>
        <span class="step-number">${a.stepIndex}</span>
      </td>
    `,t+=`
      <td>
        <input
          class="editable"
          type="number"
          data-step="${a.stepIndex}"
          data-field="targetMg"
          value="${U(a.targetMg,1)}"
          step="0.1"
          min="0"
        />
      </td>
    `,t+=`
      <td class="method-cell">${a.method}</td>
    `,t+=`
      <td>
        <input
          class="editable"
          type="number"
          data-step="${a.stepIndex}"
          data-field="dailyAmount"
          value="${le(a.dailyAmount,a.dailyAmountUnit)}"
          step="0.1"
          min="0"
        />
        <span> ${a.dailyAmountUnit}</span>
      </td>
    `,a.method==="DILUTE"){let m=l.type==="SOLID"?"g":"ml";t+=`
        <td>
          <input
            class="editable"
            type="number"
            data-step="${a.stepIndex}"
            data-field="mixFoodAmount"
            min="0"
            value="${le(a.mixFoodAmount,m)}"
            step="0.01"
          />
          <span> ${m}</span>
        </td>
      `}else t+='<td class="na-cell">n/a</td>';a.method==="DILUTE"?t+=`
        <td class="non-editable">
          ${le(a.mixWaterAmount,"ml")} ml
          <span style="color: var(--oit-text-secondary); font-size: 0.85rem;"> (${U(a.servings,1)} servings)</span>
        </td>
      `:t+='<td class="na-cell">n/a</td>',t+="</tr>"}t+="</tbody>",e.innerHTML=t;let r=document.querySelector(".bottom-section");if(!r.querySelector(".export-container")){let a=`
      <div class="export-container">
        <div class="export-buttons">
          <button class="btn-export" id="export-ascii">Copy ASCII</button>
          <button class="btn-export" id="export-pdf">Export PDF</button>
        </div>
        <div class="custom-note-container">
          <label for="custom-note">Notes:</label>
          <textarea
            id="custom-note"
            class="custom-note-textarea"
            placeholder="Add any custom notes or instructions ..."
            rows="8"
          >${ye(Le)}</textarea>
        </div>
      </div>
    `;r.insertAdjacentHTML("afterbegin",a)}_o(),No(),Bo()}function ie(){if(!c)return;let e=dn(c),t=document.querySelector(".warnings-container");if(e.length===0){t.innerHTML=`
      <div class="no-warnings">\u2713 Protocol valid. See here for the issues we check for.<br></div>
    `;return}let n=e.filter(r=>r.severity==="red"),i=e.filter(r=>r.severity==="yellow"),o="";n.length>0&&(o+=`
      <div class="warning-section red-warnings">
        <h4>Critical Issues (Red)</h4>
        <ul>
          ${n.map(r=>`<li><strong>${r.message}</strong></li>`).join("")}
        </ul>
      </div>
    `),i.length>0&&(o+=`
      <div class="warning-section yellow-warnings">
        <h4>Cautions (Yellow)</h4>
        <ul>
          ${i.map(r=>`<li>${r.message}</li>`).join("")}
        </ul>
      </div>
    `),t.innerHTML=o}function Kt(e,t){if(!e.trim())return[];if(t==="protocol")return[...Ve.default.go(e,Dt,{key:"Food",limit:50,threshold:-1e4})];{let n=Ve.default.go(e,Dt,{key:"Food",limit:25,threshold:-1e4});return[...Ve.default.go(e,sn,{key:"name",limit:25,threshold:-1e4}),...n]}}function Jt(e,t,n){let o=document.getElementById(e).parentElement,r=o.querySelector(".search-dropdown");if(r&&r.remove(),t.length===0&&!n.trim())return;let s=document.createElement("div");s.className="search-dropdown",ae=-1,Ze=e;let a=document.createElement("div");a.className="search-result-item",a.setAttribute("data-index","0"),a.innerHTML=`<strong>Custom:</strong> ${ye(n||"New food")}`,a.addEventListener("click",()=>{xo(n||"New Food",e),He(e)}),s.appendChild(a);let d=t.slice(0,50);for(let l=0;l<d.length;l++){let u=d[l],f=document.createElement("div");if(f.className="search-result-item",f.setAttribute("data-index",String(l+1)),u.obj.name)f.innerHTML=`<strong>Protocol:</strong> ${ye(u.obj.name)}`,f.addEventListener("click",()=>{Do(u.obj),He(e)});else{let m=u.obj;f.innerHTML=`
        ${ye(m.Food)}
        <span class="food-type"> - ${ye(m.Type)} - Protein: ${m["Mean value in 100g"].toFixed(1)} g/100 ${m.Type==="Solid"?"g":"ml"}</span>
      `,f.addEventListener("click",()=>{e==="food-a-search"?bo(m):Eo(m),He(e)})}s.appendChild(f)}o.appendChild(s)}function He(e){let i=document.getElementById(e).parentElement.querySelector(".search-dropdown");i&&i.remove(),ae=-1,Ze=""}function ut(e){if(!Ze)return;let t=document.getElementById(Ze);if(!t)return;let i=t.parentElement.querySelector(".search-dropdown");if(!i)return;let o=Array.from(i.querySelectorAll(".search-result-item"));o.length!==0&&(ae>=0&&ae<o.length&&o[ae].classList.remove("highlighted"),e==="down"?ae=(ae+1)%o.length:ae=ae<=0?o.length-1:ae-1,o[ae].classList.add("highlighted"),o[ae].scrollIntoView({block:"nearest",behavior:"smooth"}))}function en(){if(!Ze||ae<0)return;let e=document.getElementById(Ze);if(!e)return;let n=e.parentElement.querySelector(".search-dropdown");if(!n)return;let i=Array.from(n.querySelectorAll(".search-result-item"));ae<i.length&&i[ae].click()}function bo(e){let t={name:e.Food,type:e.Type==="Solid"?"SOLID":"LIQUID",mgPerUnit:Ge(e["Mean value in 100g"])};c=an(t,ve),be(),mt(),K(),ie(),gt(),document.getElementById("food-a-search").value=""}function Eo(e){if(!c)return;let t={name:e.Food,type:e.Type==="Solid"?"SOLID":"LIQUID",mgPerUnit:Ge(e["Mean value in 100g"])},n={unit:t.type==="SOLID"?"g":"ml",amount:ve.DEFAULT_FOOD_B_THRESHOLD};je(c,t,n),be(),K(),ie(),document.getElementById("food-b-search").value=""}function xo(e,t){let n={name:e||"Custom Food",type:"SOLID",mgPerUnit:Ge(10)};if(t==="food-a-search")c=an(n,ve),be(),mt(),K(),ie(),gt();else{if(!c)return;let i={unit:"g",amount:ve.DEFAULT_FOOD_B_THRESHOLD};je(c,n,i),be(),K(),ie()}document.getElementById(t).value=""}function Do(e){let t={name:e.food_a.name,type:e.food_a.type==="SOLID"?"SOLID":"LIQUID",mgPerUnit:new M(e.food_a.mgPerUnit)},n={dosingStrategy:nn[e.dosing_strategy],foodA:t,foodAStrategy:on[e.food_a_strategy],diThreshold:new M(e.di_threshold),steps:[],config:ve};e.custom_note&&(Le=e.custom_note);let i=[];n.foodAStrategy==="DILUTE_INITIAL"?i=e.table_di:n.foodAStrategy==="DILUTE_NONE"?i=e.table_dn:n.foodAStrategy==="DILUTE_ALL"&&(i=e.table_da);for(let o=0;o<i.length;o++){let r=i[o],s={stepIndex:o+1,targetMg:new M(r.protein),method:r.method==="DILUTE"?"DILUTE":"DIRECT",dailyAmount:new M(r.daily_amount),dailyAmountUnit:r.method==="DILUTE"?"ml":r.food===t.name?t.type==="SOLID"?"g":"ml":"g",food:r.food===t.name?"A":"B"};if(r.method==="DILUTE"){s.mixFoodAmount=new M(r.mix_amount),s.mixWaterAmount=new M(r.water_amount);let a=r.food===t.name?t:n.foodB,d=s.mixFoodAmount.times(a.mgPerUnit);s.servings=d.dividedBy(s.targetMg)}n.steps.push(s)}e.food_b&&(n.foodB={name:e.food_b.name,type:e.food_b.type==="SOLID"?"SOLID":"LIQUID",mgPerUnit:new M(e.food_b.mgPerUnit)},e.food_b_threshold&&(n.foodBThreshold={unit:n.foodB.type==="SOLID"?"g":"ml",amount:new M(e.food_b_threshold)})),c=n,be(),mt(),K(),ie(),gt(),document.getElementById("food-a-search").value=""}function Fo(){c&&(c.foodB=void 0,c.foodBThreshold=void 0,ct(),be(),K(),ie())}function gt(){let e=document.querySelector(".food-b-container");if(!e)return;if(c&&c.foodA){e.classList.remove("disabled");let n=document.getElementById("food-b-search"),i=document.getElementById("clear-food-b");n&&(n.disabled=!1),i&&(i.disabled=!1)}else{e.classList.add("disabled");let n=document.getElementById("food-b-search"),i=document.getElementById("clear-food-b");n&&(n.disabled=!0,n.value=""),i&&(i.disabled=!0)}}function Mo(){let e=document.getElementById("food-a-name");e&&e.addEventListener("input",s=>{c&&(c.foodA.name=s.target.value,K())});let t=document.getElementById("food-a-protein");t&&t.addEventListener("change",s=>{if(c){let a=parseFloat(s.target.value);a<0&&(a=0),a>150&&(a=150),Number.isNaN(a)&&(a=0),s.target.value=a.toFixed(1),c.foodA.mgPerUnit=Ge(a),Xe()}});let n=document.getElementById("food-a-threshold");n&&n.addEventListener("change",s=>{c&&(c.diThreshold=new M(s.target.value),Xe())});let i=document.getElementById("food-b-name");i&&i.addEventListener("input",s=>{c&&c.foodB&&(c.foodB.name=s.target.value,K())});let o=document.getElementById("food-b-protein");o&&o.addEventListener("change",s=>{if(c&&c.foodB){let a=parseFloat(s.target.value);if(a<0&&(a=0),a>150&&(a=150),Number.isNaN(a)&&(a=0),s.target.value=a.toFixed(1),c.foodB.mgPerUnit=Ge(a),c.foodBThreshold){let d=c.foodB,l=c.foodBThreshold;c.foodB=void 0,c.foodBThreshold=void 0,ct(),je(c,d,l),K(),ie()}}});let r=document.getElementById("food-b-threshold");r&&r.addEventListener("change",s=>{if(c&&c.foodB&&c.foodBThreshold){c.foodBThreshold.amount=new M(s.target.value);let a=c.foodB,d=c.foodBThreshold;c.foodB=void 0,c.foodBThreshold=void 0,ct(),je(c,a,d),K(),ie()}}),document.querySelectorAll("[data-action]").forEach(s=>{s.addEventListener("click",a=>{let d=a.target.getAttribute("data-action");if(c)switch(d){case"toggle-food-a-solid":c.foodA.type!=="SOLID"&&dt(!1);break;case"toggle-food-a-liquid":c.foodA.type!=="LIQUID"&&dt(!1);break;case"toggle-food-b-solid":c.foodB&&c.foodB.type!=="SOLID"&&dt(!0);break;case"toggle-food-b-liquid":c.foodB&&c.foodB.type!=="LIQUID"&&dt(!0);break;case"food-a-strategy-initial":c.foodAStrategy="DILUTE_INITIAL",Xe(),be();break;case"food-a-strategy-all":c.foodAStrategy="DILUTE_ALL",Xe(),be();break;case"food-a-strategy-none":c.foodAStrategy="DILUTE_NONE",Xe(),be();break}})})}function _o(){document.querySelectorAll("input.editable").forEach(e=>{e.addEventListener("blur",t=>{let n=t.target,i=parseInt(n.getAttribute("data-step")),o=n.getAttribute("data-field"),r=parseFloat(n.value);isNaN(r)||(r<0&&(r=0,n.value=r.toString()),o==="targetMg"?To(i,r):o==="dailyAmount"?Io(i,r):o==="mixFoodAmount"&&Ao(i,r))}),e.addEventListener("keydown",t=>{t.key==="Enter"&&t.target.blur()})}),document.querySelectorAll(".btn-add-step").forEach(e=>{e.addEventListener("click",t=>{let n=parseInt(t.target.getAttribute("data-step"));So(n)})}),document.querySelectorAll(".btn-remove-step").forEach(e=>{e.addEventListener("click",t=>{let n=parseInt(t.target.getAttribute("data-step"));Lo(n)})})}function No(){let e=document.getElementById("export-ascii");e&&e.addEventListener("click",Uo);let t=document.getElementById("export-pdf");t&&t.addEventListener("click",Po)}function Bo(){let e=document.getElementById("custom-note");if(!e)return;e.value=Le;let t=null;e.addEventListener("input",n=>{t!==null&&clearTimeout(t),t=window.setTimeout(()=>{let i=n.target.value,o=document.createElement("div");o.textContent=i,Le=o.textContent||""},300)})}function Po(){if(!c)return;let{jsPDF:e}=jspdf,t=new e({unit:"pt",format:"letter"}),n=40;t.setFontSize(18),t.setFont("helvetica","bold"),t.text("Oral Immunotherapy Protocol",40,n),n+=30;let i=c.foodA.type==="SOLID"?"g":"ml",o=ln(c),r=c.steps.length,s=[];for(let u=0;u<o;u++){let f=c.steps[u],m=c.foodA,v=`${le(f.dailyAmount,f.dailyAmountUnit)} ${f.dailyAmountUnit}`,D="N/A";if(f.method==="DILUTE"){let T=m.type==="SOLID"?"g":"ml";D=`${le(f.mixFoodAmount,T)} ${T} food + ${le(f.mixWaterAmount,"ml")} ml water`}u===r-1?s.push([f.stepIndex,`${U(f.targetMg,1)} mg`,f.method,v,D,"Continue long term"]):s.push([f.stepIndex,`${U(f.targetMg,1)} mg`,f.method,v,D,"2-4 weeks"])}if(t.setFontSize(14),t.setFont("helvetica","bold"),t.text(`${c.foodA.name}`,40,n),n+=20,t.setFontSize(10),t.setFont("helvetica","normal"),t.text(`Protein: ${U(c.foodA.mgPerUnit.dividedBy(new M(10)),2)} g per 100 ${i} serving.`,40,n),n+=15,t.autoTable({startY:n,head:[["Step","Protein","Method","Daily Amount","How to make mix","Interval"]],body:s,theme:"grid",headStyles:{fillColor:[66,139,202],fontStyle:"bold"},margin:{left:40,right:40},styles:{fontSize:9,cellPadding:5},columnStyles:{0:{cellWidth:40},1:{cellWidth:70},2:{cellWidth:60},3:{cellWidth:90},4:{cellWidth:180},5:{cellWidth:80}}}),n=t.lastAutoTable.finalY+20,c.foodB&&o<r){let u=c.foodB.type==="SOLID"?"g":"ml",f=[];for(let m=o;m<r;m++){let v=c.steps[m],D=c.foodB,T=`${le(v.dailyAmount,v.dailyAmountUnit)} ${v.dailyAmountUnit}`,z="N/A";if(v.method==="DILUTE"){let C=D.type==="SOLID"?"g":"ml";z=`${le(v.mixFoodAmount,C)} ${C} food + ${le(v.mixWaterAmount,"ml")} ml water`}m===r-1?f.push([v.stepIndex,`${U(v.targetMg,1)} mg`,v.method,T,z,"Continue long term"]):f.push([v.stepIndex,`${U(v.targetMg,1)} mg`,v.method,T,z,"2-4 weeks"])}n>650&&(t.addPage(),n=40),n+=10,t.setFontSize(14),t.setFont("helvetica","bold"),t.text(`${c.foodB.name}`,40,n),n+=20,t.setFontSize(10),t.setFont("helvetica","normal"),t.text(`Protein: ${U(c.foodB.mgPerUnit.dividedBy(new M(10)),2)} g per 100 ${u} serving`,40,n),n+=15,t.autoTable({startY:n,head:[["Step","Protein","Method","Daily Amount","How to make mix","Interval"]],body:f,theme:"grid",headStyles:{fillColor:[66,139,202],fontStyle:"bold"},margin:{left:40,right:40},styles:{fontSize:9,cellPadding:5},columnStyles:{0:{cellWidth:40},1:{cellWidth:70},2:{cellWidth:60},3:{cellWidth:90},4:{cellWidth:180},5:{cellWidth:80}}}),n=t.lastAutoTable.finalY+20}if(Le&&Le.trim()){n>650&&(t.addPage(),n=40),t.setFontSize(14),t.setFont("helvetica","bold"),t.text("Notes",40,n),n+=15,t.setFontSize(10),t.setFont("helvetica","normal");let f=t.splitTextToSize(Le.trim(),520);for(let m of f)n>730&&(t.addPage(),n=40),t.text(m,40,n),n+=14}let a=t.internal.getNumberOfPages();for(let u=1;u<=a;u++)t.setPage(u),t.setFontSize(8),t.setFont("helvetica","italic"),t.setTextColor(100),t.text("",40,760),t.text("Always verify calculations before clinical use.",40,772),t.setTextColor(0);let d=t.output("dataurlstring"),l=window.open("","_blank");l?l.document.write(`<iframe src="${d}" style="width:100%; height:100%; border:none;"></iframe>`):alert("Popup blocked. Please allow popups to view the PDF.")}function Uo(){if(!c)return;let e="",t="",n="",i=c.foodA.type==="SOLID"?"Solid":"Liquid",o=c.foodA.type==="SOLID"?"g":"ml";if(t+=`${c.foodA.name} (${i}). Protein: ${U(c.foodA.mgPerUnit,1)} mg/${o}`,c.foodB){let l=c.foodB.type==="SOLID"?"Solid":"Liquid",u=c.foodB.type==="SOLID"?"g":"ml";n+=`${c.foodB.name} (${l}). Protein: ${U(c.foodB.mgPerUnit,1)} mg/${u}`}let r=c.steps.length,s=ln(c),a=new AsciiTable(t),d=new AsciiTable(n);a.setHeading("Step","Protein","Method","Daily Amount","Mix Details"),d.setHeading("Step","Protein","Method","Daily Amount","Mix Details");for(let l of c.steps){let u=l.food==="B",f=u?c.foodB:c.foodA,m;u?m=d:m=a;let v=`${le(l.dailyAmount,l.dailyAmountUnit)} ${l.dailyAmountUnit}`,D="N/A";if(l.method==="DILUTE"){let T=f.type==="SOLID"?"g":"ml";D=`${le(l.mixFoodAmount,T)} ${T} food + ${le(l.mixWaterAmount,"ml")} ml water`}m.addRow(l.stepIndex,`${U(l.targetMg,1)} mg`,l.method,v,D)}s>0&&(e+=a.toString()+`

`),s<r&&(e+=`--- TRANSITION TO: ---
`,e+=d.toString()+`

`),Le&&Le.trim()&&(e+=`========================================
`,e+=`NOTES
`,e+=`========================================
`,e+=`${Le.trim()}`),navigator.clipboard.writeText(e).catch(()=>{alert(`Failed to copy to clipboard. Please copy manually:

`+e)})}async function Oo(){try{bt=await(await fetch("/tool_assets/typed_foods_rough.json")).json(),Dt=bt.map(n=>wt(yt({},n),{prepared:Ve.default.prepare(n.Food)})),Et=await(await fetch("/tool_assets/oit_protocols.json")).json(),sn=Et.map(n=>wt(yt({},n),{prepared:Ve.default.prepare(n.name)})),console.log(`Loaded ${bt.length} foods and ${Et.length} protocols`)}catch(e){console.error("Error loading databases:",e),alert("Error loading food and protocol databases. Some features may not work.")}}async function tn(){await Oo();let e=document.getElementById("food-a-search");e&&(e.addEventListener("input",i=>{let o=i.target.value;We&&clearTimeout(We),We=window.setTimeout(()=>{let r=Kt(o,"food");Jt("food-a-search",r,o)},150)}),e.addEventListener("keydown",i=>{var r;(r=e.parentElement)!=null&&r.querySelector(".search-dropdown")&&(i.key==="ArrowDown"?(i.preventDefault(),ut("down")):i.key==="ArrowUp"?(i.preventDefault(),ut("up")):i.key==="Enter"?(i.preventDefault(),en()):i.key==="Escape"&&He("food-a-search"))}),e.addEventListener("blur",()=>{setTimeout(()=>He("food-a-search"),200)}));let t=document.getElementById("food-b-search");t&&(t.addEventListener("input",i=>{let o=i.target.value;We&&clearTimeout(We),We=window.setTimeout(()=>{let r=Kt(o,"protocol");Jt("food-b-search",r,o)},150)}),t.addEventListener("keydown",i=>{var r;(r=t.parentElement)!=null&&r.querySelector(".search-dropdown")&&(i.key==="ArrowDown"?(i.preventDefault(),ut("down")):i.key==="ArrowUp"?(i.preventDefault(),ut("up")):i.key==="Enter"?(i.preventDefault(),en()):i.key==="Escape"&&He("food-b-search"))}),t.addEventListener("blur",()=>{setTimeout(()=>He("food-b-search"),200)}));let n=document.getElementById("clear-food-b");n&&n.addEventListener("click",Fo),gt(),console.log("OIT Calculator initialized")}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",tn):tn();})();
/*! Bundled license information:

decimal.js/decimal.mjs:
  (*!
   *  decimal.js v10.6.0
   *  An arbitrary-precision Decimal type for JavaScript.
   *  https://github.com/MikeMcl/decimal.js
   *  Copyright (c) 2025 Michael Mclaughlin <M8ch88l@gmail.com>
   *  MIT Licence
   *)
*/
